/*!CK:513938847!*//*1444359604,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["PgPNG"]); }

__d('BingMaps',['confine','mod'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(){}Object.assign(j,{MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:10,BING_MAP_ZOOM_LEVEL_REGION:6,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function(k,l){var m=l-k;if(!j.pows[m])j.pows[m]=Math.pow(2,m);return j.pows[m];},mapSize:function(k){return 512*j.scale(1,k);},latLongToXY:function(k,l){var m=h(k.latitude,j.MIN_LATITUDE,j.MAX_LATITUDE),n=(k.longitude+180)/360,o=Math.sin(m*Math.PI/180),p=.5-Math.log((1+o)/(1-o))/(4*Math.PI),q=j.mapSize(l);return {x:Math.floor(n*(q-1)+.5),y:Math.floor(p*(q-1)+.5)};},xyToLatLong:function(k,l){var m=j.mapSize(l),n=i(k.x,m)/m-.5,o=.5-h(k.y,0,m-1)/m,p=90-360*Math.atan(Math.exp(-o*2*Math.PI))/Math.PI,q=360*n;return {latitude:p,longitude:q};},getViewForLatLongs:function(k,l,m,n,o,p){if(!m.length)throw new Error('the proper view for zero point(s) is completely ambiguous');n=n||{t:0,r:0,b:0,l:0};o=o||1;p=p||Infinity;var q=j._getBoundingBox(m),r=n.l+n.r,s=n.t+n.b,t=j.MAX_ZOOM,u;if(m.length>1){u=j.mapSize(t);while(t>o&&(j._getWidth(q,u)>k-r||q.b-q.t>l-s)||t>p){q=j._rectScale(q,1,2);t--;u=j.mapSize(t);}}else while(t!==j.BING_MAP_ZOOM_LEVEL_CITY){t--;q=j._rectScale(q,1,2);}var v=q.l-n.l,w=q.r+n.r;if(w<v)w+=j.mapSize(t);var x={t:q.t-n.t,r:w,b:q.b+n.b,l:v};u=j.mapSize(t);var y={x:(x.l+x.r)/2,y:(x.t+x.b)/2},z=j.xyToLatLong(y,t);return {center:z,width:k,height:l,zoom:t};},_getWidth:function(k,l){return j._calculateRightDistanceAToB(k.l,k.r,l);},_getBoundingBox:function(k){var l=[],m=j.mapSize(j.MAX_ZOOM);for(var n=0;n<k.length;n++){var o=k[n];l.push(j.latLongToXY(o,j.MAX_ZOOM));}l.sort(function(x,y){return x.x-y.x;});var p=l.length-1,q=j._calculateRightDistanceAToB(l[p].x,l[0].x,m),r=0,s=p,t=[l[0].y],u;for(var v=1;v<l.length;v++){t.push(l[v].y);var w=j._calculateRightDistanceAToB(l[v-1].x,l[v].x,m);if(w>q){q=w;r=v;s=v-1;}}u={t:Math.min.apply(null,t),r:l[s].x,b:Math.max.apply(null,t),l:l[r].x};return u;},_calculateRightDistanceAToB:function(k,l,m){if(!m)throw new Error('zero or null map width not allowed');return (m+l-k)%m;},_rectScale:function(k,l,m){return {t:k.t*l/m,r:k.r*l/m,b:k.b*l/m,l:k.l*l/m};}});f.exports=j;},null);
__d('randomShuffle',['randomInt'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){for(var k=j.length-1;k>0;k--){var l=h.call(this,k+1);if(l!=k){var m=j[l];j[l]=j[k];j[k]=m;}}return j;}f.exports=i;},null);
__d('AggregatedMapCalloutOrientation',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};Object.assign(h,{TOP:'fbMapCalloutUseArrowTop',LEFT:'fbMapCalloutUseArrowLeft',RIGHT:'fbMapCalloutUseArrowRight',BOTTOM:'fbMapCalloutUseArrowBottom',ALWAYS_ON_MAP:'alwaysOnMap'});f.exports=h;},null);
__d('AggregatedMapCallout',['AggregatedMapCalloutOrientation','CSS','DOM','Style','Vector'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=16,n=10,o=10;function p(q,r,s){this.map=q;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=h.RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=r;this.contentContainer=j.find(this.border,'.fbMapCalloutContent');this.arrowWrap=j.find(this.border,'.fbMapCalloutArrowWrap');this.arrowL=j.find(this.border,'.fbMapCalloutArrowLeft');this.arrowR=j.find(this.border,'.fbMapCalloutArrowRight');this.arrowT=j.find(this.border,'.fbMapCalloutArrowTop');this.arrowB=j.find(this.border,'.fbMapCalloutArrowBottom');this._updateDimensions();}Object.assign(p.prototype,{setOrientation:function(q){this.orientation=q;},getOrientation:function(){return this.orientation;},getRoot:function(){return this.border;},getAnchor:function(){return this.anchor;},close:function(){this.anchor=null;this._map_updatePosition();},updateAnchor:function(q){this.anchor=q;this._map_updatePosition();},setContent:function(q){j.setContent(this.contentContainer,q);this._updateDimensions();},getContent:function(){return this.contentContainer;},recalculateArrowYOffset:function(q){if(!this.anchor)return;var r=this.map._callout_determineArrowYOffset(this,q,this.width,this.height);this.setArrowYOffset(r);this._map_updatePosition();},_updateDimensions:function(){i.show(this.border);this.width=l.getElementDimensions(this.border).x;this.height=l.getElementDimensions(this.border).y;this.setArrowXOffset(this.width/2);this.setArrowYOffset(this.height/2);i.hide(this.border);},_map_moveTo:function(q,r){this.anchor=q;this.map._callout_panTo(q,this,r);this._map_updatePosition();},_map_updatePosition:function(){var q=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(q===null){i.hide(this.border);return;}var r,s,t,u,v=n,w=this.orientation;if(this.orientation===h.ALWAYS_ON_MAP){var x=q.getCenter().x,y=q.getCenter().y;if(x<0&&y<0){s=o;r=o;}else if(x>this.map.ww&&y<0){t=o;r=o;}else if(x>this.map.ww&&y>this.map.hh){t=o;u=o;}else if(x<0&&y>this.map.hh){s=o;u=o;}else if(x<0){w=h.RIGHT;s=o;r=q.calloutY-this.arrowYOffset;}else if(x>this.map.ww){w=h.LEFT;t=o;r=q.calloutY-this.arrowYOffset;}else if(y<0){w=h.BOTTOM;r=o;s=(q.l+q.r)/2-this.arrowXOffset;}else if(y>this.map.hh){w=h.TOP;u=o;s=(q.l+q.r)/2-this.arrowXOffset;}else{r=q.calloutY-this.arrowYOffset;if(x<this.map.ww/2){s=q.r+v;w=h.RIGHT;}else{s=q.l-v-this.width;w=h.LEFT;}}}switch(this.orientation){case h.LEFT:s=q.l-v-this.width;r=q.calloutY-this.arrowYOffset;break;case h.RIGHT:s=q.r+v;r=q.calloutY-this.arrowYOffset;break;case h.TOP:u=this.map._getH()-q.t+v;s=(q.l+q.r)/2-this.arrowXOffset;break;case h.BOTTOM:r=q.b+v;s=(q.l+q.r)/2-this.arrowXOffset;break;}i.setClass(this.arrowWrap,w);this._setPosition('top',r);this._setPosition('right',t);this._setPosition('bottom',u);this._setPosition('left',s);i.show(this.border);},_setPosition:function(q,r){if(r!==undefined){r+='px';}else r='auto';k.set(this.border,q,r);},setArrowXOffset:function(q){this.arrowXOffset=q;q-=Math.round(m/2);k.set(this.arrowT,'left',q+'px');k.set(this.arrowB,'left',q+'px');},setArrowYOffset:function(q){this.arrowYOffset=q;q-=Math.round(m/2);k.set(this.arrowL,'top',q+'px');k.set(this.arrowR,'top',q+'px');}});Object.assign(p,{throbber:function(q){q=q||this.DEFAULT_CALLOUT_WIDTH;var r=j.create('div',{}),s=j.create('img',{src:'/images/loaders/indicator_blue_small.gif'});i.setClass(r,'fbAggregatedMapCalloutThrobberDiv');k.set(r,'width',q+'px');i.setClass(s,'fbAggregatedMapCalloutThrobber');j.setContent(r,s);return r;},ARROW_HEIGHT_PLUS_PADDING:n,ARROW_WIDTH:m});f.exports=p;},null);
__d('AggregatedMapMarker',['DOM','Style'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l){this._root=k;this._sprite=l;}Object.assign(j.prototype,{setPosition:function(k){var l=k.y-this._sprite.getAnchorY(),m=k.x-this._sprite.getAnchorX();i.set(this._root,'top',Math.round(l)+'px');i.set(this._root,'left',Math.round(m)+'px');},setOnClick:function(k){this._root.onclick=k;},setOnMouseover:function(k){this._root.onmouseover=k;},setOnMouseout:function(k){this._root.onmouseout=k;},remove:function(){h.remove(this._root);},getElement:function(){return this._root;}});f.exports=j;},null);
__d("AggregatedMapZIndex",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};Object.assign(h,{DEFAULT_PIN_BASE_Z_INDEX:1000,PIN_Z_INDEX_MAXIUMUM_ADD:4000,DEFAULT_PIN_MAX_Z_INDEX:5000,CONTROLS_Z_INDEX:7000,CALLOUT_Z_INDEX:9000,TOOLTIP_Z_INDEX:9100});f.exports=h;},null);
__d('BingMapCoordinate',['BingMaps','Vector','mod'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){this.absoluteX=null;this.absoluteY=null;this.latitude=null;this.longitude=null;}Object.assign(k,{MAX_ZOOM:18,MIN_ZOOM:1,fromAbsolute:function(l,m){if(m===undefined){m=l.y;l=l.x;}var n=new k();n.absoluteX=l;n.absoluteY=m;var o=h.xyToLatLong(new i(l,m),k.MAX_ZOOM);n.latitude=o.latitude;n.longitude=o.longitude;return n;},fromLatLong:function(l,m){if(m===undefined){m=l.longitude;l=l.latitude;}var n=new k();n.latitude=l;n.longitude=m;var o=h.latLongToXY({latitude:l,longitude:m},k.MAX_ZOOM);n.absoluteX=o.x;n.absoluteY=o.y;return n;},fromMap:function(l,m,n){var o=h.scale(n,k.MAX_ZOOM);return k.fromAbsolute(l*o,m*o);}});Object.assign(k.prototype,{getLatitude:function(){return this.latitude;},getLongitude:function(){return this.longitude;},getAbsoluteX:function(){return this.absoluteX;},getAbsoluteY:function(){return this.absoluteY;},getAbsoluteXY:function(){return new i(this.absoluteX,this.absoluteY);},getMapX:function(l){return this.getMapXY(l).x;},getMapY:function(l){return this.getMapXY(l).y;},getMapXY:function(l){var m=h.scale(k.MAX_ZOOM,l),n=this.absoluteX*m,o=this.absoluteY*m;return new i(n,o);},add:function(l,m){var n=this.getMapXY(l);return k.fromMap(n.x+m.x,n.y+m.y,l);},calculateDistanceSq:function(l,m){var n=this.calculateDistanceX(l,m),o=this.calculateDistanceY(l,m);return n*n+o*o;},calculateDistanceX:function(l,m){var n=h.mapSize(l),o=j(m.getMapX(l)-this.getMapX(l),n);return Math.min(o,n-o);},calculateDistanceY:function(l,m){return Math.abs(m.getMapY(l)-this.getMapY(l));}});f.exports=k;},null);
__d('AggregatedMapGroup',['AggregatedMapMarker','AggregatedMapZIndex','BingMapCoordinate','DOM','Rect','Style','confine'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(p,q,r,s){this._boundingBox=q;this._sprite=r;this._marker=null;this._mapToPixel=s;this.pins=p;this.deleted=false;}Object.assign(o.prototype,{getType:function(){return 'AggregatedMapGroup';},getCenter:function(){return this._mapToPixel(this._boundingBox.getCenter());},getCenterLatLong:function(p){var q=this._boundingBox.getCenter(),r=j.fromMap(q.x,q.y,p);return {latitude:r.getLatitude(),longitude:r.getLongitude()};},hasMarker:function(){return !!this._marker;},dismissMarker:function(){if(this._marker){this._marker.remove();this._marker=null;}},getMarker:function(){return this._marker&&this._marker.getElement();},getSprite:function(){return this._sprite;},updatePosition:function(p){if(!this._marker)return;var q=this.getCenter();this._marker.setPosition(q);},getSpriteBounds:function(){var p=this._sprite,q=this.getCenter().y-p.getAnchorY(),r=this.getCenter().x-p.getAnchorX(),s=r+p.getWidth(),t=q+p.getHeight(),u=new l(q,s,t,r);u.calloutY=q+p.getCalloutY();return u;},isSinglePin:function(){return this.pins.length==1;},renderMarker:function(p){if(!this._marker){var q=this._sprite,r=q.render();this._marker=new h(r,this._sprite);if(this.isSinglePin()){var s=q.getBaseZIndex&&q.getBaseZIndex()||i.DEFAULT_PIN_BASE_Z_INDEX;s+=n(Math.floor(this.getCenter().y),0,i.PIN_Z_INDEX_MAXIUMUM_ADD);if(q.setZIndex){q.setZIndex(Math.floor(s));}else m.set(r,'z-index',Math.floor(s));}k.appendContent(p,r);}return this._marker;},add:function(p,q){return this._boundingBox.add(p,q);}});f.exports=o;},null);
__d('MapAggregation',['removeFromArray'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(){this.combine=null;this.iterations=0;this.candidates=null;this.loners=null;}Object.assign(i.prototype,{aggregate:function(j,k,l){this.overlap=l?l:this._overlap;this.candidates=j;this.combine=k;this.loners=[];while(this.candidates.length>0){var m=this.candidates[this.candidates.length-1],n;do{var o=m.center;this._group(m,Number.MAX_VALUE);n=o!==m.center;}while(!this._isDeleted(m)&&n);if(!this._isDeleted(m)){h(this.candidates,m);this.loners.push(m);}}return this.loners;},_isDeleted:function(j){return j.center===null;},_delete:function(j){h(this.candidates,j);h(this.loners,j);j.center=null;},_group:function(j,k){while(true){this.iterations++;if(this.iterations>=10000){this.iterations%10000===0&&0;return;}var l=this._nearest(j),m=l.nearest,n=l.distanceSquared;if(!m||n>k||!this.overlap(j,m))return;var o=m.center,p=j.center;this._group(m,n-1);if(this._isDeleted(j))return;var q=m.center!==o,r=j.center!==p;if(!q&&!r){this.combine(j,m);this._delete(m);return;}}},_nearest:function(j){var k,l,m,n=null,o=Number.MAX_VALUE;for(k=0;k<this.candidates.length;k++){m=this.candidates[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}for(k=0;k<this.loners.length;k++){m=this.loners[k];if(m===j)continue;l=this._distanceSquared(j,m);if(l<o){n=m;o=l;}}return {nearest:n,distanceSquared:o};},_overlap:function(j,k){var l=j.radius+k.radius;return this._distanceSquared(j,k)<l*l;},_distanceSquared:function(j,k){var l=j.center.x-k.center.x,m=j.center.y-k.center.y;return l*l+m*m;}});f.exports=i;},null);
__d('MapRects',['Rect','Vector','confine'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(){}Object.assign(k,{containsPoint:function(l,m,n){if(n===undefined)n=0;return l.t<=m.y+n&&l.r>=m.x-n&&l.b>=m.y-n&&l.l<=m.x+n;},pad:function(l,m){return k.padXY(l,m,m);},padX:function(l,m){return k.padXY(l,m,0);},padY:function(l,m){return k.padXY(l,0,m);},padXY:function(l,m,n){return new h(l.t-n,l.r+m,l.b+n,l.l-m,l.domain);},collides:function(l,m){return (l.t<m.b&&l.b>m.t&&l.l<m.r&&l.r>m.l);},boundPoint:function(l,m){var n=new i(0,0);n.x=j(m.x,l.l,l.r);n.y=j(m.y,l.t,l.b);return n;},boundingBox:function(l,m){return new h(Math.min(l.t,m.t),Math.max(l.r,m.r),Math.max(l.b,m.b),Math.min(l.l,m.l));},scale:function(l,m,n){return new h(l.t*m/n,l.r*m/n,l.b*m/n,l.l*m/n);}});f.exports=k;},null);
__d('AggregatedMap',['Event','AggregatedMapCallout','AggregatedMapCalloutOrientation','AggregatedMapGroup','AggregatedMapZIndex','Arbiter','BingMapCoordinate','BingMaps','CSS','DOM','GeoRectangle','MapAggregation','MapRects','Rect','Run','Style','Vector','confine','csx','$'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=10,ca=7,da=100,ea=50,fa=500,ga=409,ha=90,ia=90,ja=.15,ka=10,la=10,ma=10,na=new u(50,50,50,50);function oa(pa,qa,ra,sa,ta,ua,va){this.mapReady=false;this.lastZoom=null;this.initialView=null;this.lastRender=null;this.visiblePins=[];this.groups=[];this.callouts=[];this.zoomStack=[];this.initialPinsToHide=[];this.arrowYOffset=ia;this.padding=da+ea;this.topLeft=n.fromLatLong(0,0);this.dynamicMap=pa;this.canvas=qa;this.instanceid=ra;this.logger=ua;this.maxZoom=sa.maxZoom;this.minZoom=sa.minZoom;this.maxCalloutWidth=sa.maxCalloutWidth||sa.width-ba;this.maxCalloutHeight=sa.maxCalloutHeight||sa.height-ba;this.pad={};this.setViewportPadding(sa.paddingTop,sa.paddingRight,sa.paddingBottom,sa.paddingLeft);this.listeners=[];this.bingMapEvents=[];v.onLeave(this._onBeforeLeave.bind(this));this.dynamicMap.onInit(this._onInit.bind(this,ta,va));}Object.assign(oa.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function(pa){return this._noPan.bind(this,pa);},leftRightNoPanningStrategy:function(){return this._leftRightNoPan.bind(this);},anchoredPanningStrategy:function(pa,qa){return this._anchoredPan.bind(this,pa,qa);},smartPanningStrategy:function(pa,qa){return this._smartPan.bind(this,pa,qa);},getMap:function(){this._assertInitialized();return this.map;},getMicrosoftMaps:function(){this._assertInitialized();return this.microsoftMaps;},setPins:function(pa){this._assertInitialized();this.visiblePins=pa;this.calloutAnchor=null;this._setZoomButtonVisibility();this._aggregate();},getGroups:function(){return this.groups;},getWidth:function(){return this._getW()-this.pad.l-this.pad.r;},getAbsoluteWidth:function(){return this._getW();},getHeight:function(){return this._getH()-this.pad.t-this.pad.b;},getAbsoluteHeight:function(){return this._getH();},getBounds:function(){var pa=o.xyToLatLong(this.dynamicMap.pixelToMap(new x(this.pad.l,this.pad.t)),this.getZoom()),qa=o.xyToLatLong(this.dynamicMap.pixelToMap(new x(this._getW()-this.pad.r,this._getH()-this.pad.b)),this.getZoom());return new r(pa.latitude,pa.longitude,qa.latitude,qa.longitude);},pushView:function(){this._assertInitialized();this.zoomStack.push(this._getMapView());},invalidateSize:function(){this.dynamicMap.invalidateSize();},zoomIntoOne:function(pa,qa){this._assertInitialized();this.pushView();this.zoomToOne(pa,qa);},zoomToOne:function(pa,qa,ra){this.zoomToOneTight(pa,qa,0,ra);},zoomToOneTight:function(pa,qa,ra,sa){this._assertInitialized();qa=qa||new x(0,0);ra=ra||0;sa=sa||false;ra=Math.max(this._findMinZoomWherePinIsAlone(pa),ra,this.getZoom());pa.setZoom(ra);var ta=pa.anchor.add(ra,qa.mul(-1));this._setMapView({zoom:ra,center:{latitude:ta.getLatitude(),longitude:ta.getLongitude()},animate:sa},m.BEHAVIOR_PERSISTENT);},zoomInto:function(pa){this._assertInitialized();this.pushView();this.zoomTo(pa);},removePin:function(pa){this._assertInitialized();this.removePins([pa]);},removePins:function(pa){this._assertInitialized();for(var qa=0;qa<pa.length;qa++)pa[qa]._aggregated_map_remove=true;var ra=[];for(var sa=0;sa<this.visiblePins.length;sa++)if(!this.visiblePins[sa]._aggregated_map_remove)ra.push(this.visiblePins[sa]);for(var ta=0;ta<pa.length;ta++)delete pa[ta]._aggregated_map_remove;this.visiblePins=ra;this._aggregate();},addPins:function(pa){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var qa=0;qa<pa.length;qa++)this.visiblePins.push(pa[qa]);this._aggregate();},addPin:function(pa){this._assertInitialized();this.addPins([pa]);},zoomOut:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-out');this.zoomDelta(-1,true);},zoomIn:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-in');this.zoomDelta(1,true);},zoomBack:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('snap-back');var pa;if(this.zoomStack.length){pa=this.zoomStack.pop();}else{pa={};Object.assign(pa,this.initialView);pa.zoom=Math.min(pa.zoom,this.getZoom());}this._setMapView(pa);},setInitialView:function(){this._assertInitialized();this.initialView=this._getMapView();var pa=q.scry(this.canvas,"span.__0")[0];pa&&p.hide(pa);},closeCalloutAndZoomBack:function(){this._assertInitialized();this.hideCallout();this.zoomBack();},onAddPin:function(pa,qa){var ra=qa.pin,sa=qa.content;this.hideCallout();this.addPin(ra);this.zoomIntoOne(ra);this.openCallout(ra,sa);},zoomDelta:function(pa,qa){pa=y(this.getZoom()+pa,this.minZoom,this.maxZoom)-this.getZoom();if(!pa)return;var ra=null;if(qa&&this._getPrimaryCalloutAnchorGroup()){ra=this._getPrimaryCalloutAnchorGroup().getCenter();var sa=!t.containsPoint(new u(0,this._getW(),this._getH(),0),ra);if(sa)ra=null;}if(ra===null)ra={x:this._getW()/2+this._getCenterOffset().x,y:this._getH()/2+this._getCenterOffset().y};var ta=this.map.tryPixelToLocation(new this.microsoftMaps.Point(ra.x,ra.y),this.microsoftMaps.PixelReference.control),ua=new this.microsoftMaps.Point(ra.x-this.map.getWidth()/2,ra.y-this.map.getHeight()/2);this._zoom(true,pa,ta,ua);},getZoom:function(){return this.map.getZoom();},getCenter:function(){return this.map.getCenter();},getView:function(){return this._getMapView();},setView:function(pa){this._assertInitialized();this._setMapView(pa);},setViewportPadding:function(pa,qa,ra,sa){this.pad.t=pa;this.pad.r=qa;this.pad.b=ra;this.pad.l=sa;},redraw:function(){this._assertInitialized();this._aggregate();},zoomTo:function(pa,qa){this._assertInitialized();if(pa.length<1)return;var ra=this.maxZoom;if(pa.length<ka)while(this._aggregateZoom(pa,ra-1).length==pa.length&&ra>=la)ra--;var sa=[];for(var ta=0;ta<pa.length;ta++){var ua={latitude:pa[ta].getLatitude(),longitude:pa[ta].getLongitude()};sa.push(ua);}var va=o.getViewForLatLongs(this._getW(),this._getH(),sa,na,this.minZoom,ra);delete va.height;delete va.width;va.animate=qa;this._setMapView(va,m.BEHAVIOR_PERSISTENT);},hideCallout:function(pa){this._assertInitialized();var qa=this._getPrimaryCalloutAnchor();this._getInternalCallout().close();if(qa&&!pa)this._inform('calloutHidden');},throbber:function(pa){pa=pa||ga;return i.throbber(pa);},openCallout:function(pa,qa,ra){if(this._getTooltipCallout().getAnchor()===pa)this._getTooltipCallout().close();this._getInternalCallout().setContent(qa);this._getInternalCallout()._map_moveTo(pa,ra);return this._getInternalCallout();},getCallout:function(){return this._getInternalCallout();},setExternalCalloutAnchor:function(pa){this._externalCalloutAnchor=pa;},openTooltip:function(pa,qa,ra){if(this._getInternalCallout().getAnchor()===pa)return;this._getTooltipCallout().setContent(qa);this._getTooltipCallout()._map_moveTo(pa,ra);return this._getTooltipCallout();},getTooltip:function(){return this._getTooltipCallout();},updateCallouts:function(){for(var pa=0;pa<this.callouts.length;pa++)this.callouts[pa]._map_updatePosition();},_onInit:function(pa,qa){this.microsoftMaps=this.dynamicMap.getMicrosoftMaps();this.map=this.dynamicMap.getMap();this.bingMapEvents=[this.microsoftMaps.Events.addHandler(this.map,'viewchange',this._onViewChange.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'dblclick',this._onDoubleClick.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'viewchangeend',this._onViewChangeEnd.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'mouseup',this._onMouseUp.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'mousedown',this._onMouseDown.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'zoomstart',this._onZoomStart.bind(this))];this._onViewChange();this.initialized=true;for(var ra=0;ra<pa.length;ra++)pa[ra].xhp&&this.initialPinsToHide.push(pa[ra].xhp);pa.length&&this.setPins(pa);if(qa){pa[0].setCallout(aa(qa));this._getInternalCallout()._map_moveTo(pa[0],this.noPanningStrategy(j.TOP));}p.hide(q.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0]);for(var sa in oa.Listeners)this._subscribe('AggregatedMap/'+sa,this[sa].bind(this));this._inform(oa.Events.ready,this,m.BEHAVIOR_STATE);},_callout_getAnchorBounds:function(pa){var qa=this._getCalloutAnchorGroup(pa),ra=qa&&qa.getSpriteBounds();return ra;},_callout_panTo:function(pa,qa,ra){var sa=this._callout_getAnchorBounds(pa),ta=ra?ra(qa,sa):null;if(ta){var ua=o.xyToLatLong(this.dynamicMap.pixelToMap(ta),this.getZoom());this._setMapView({center:ua});}},_callout_determineArrowYOffset:function(pa,qa,ra,sa){var ta=this._callout_getAnchorBounds(pa.getAnchor()),ua=new x((ta.l+ta.r)/2,ta.calloutY),va=sa/2,wa=this._getVisibleBounds(),xa=t.containsPoint(this._getNoPanBounds(sa),ua,1),ya=va;if(qa||xa){var za=wa.t+va+this.CALLOUT_MARGIN,ab=wa.b-(sa-va)-this.CALLOUT_MARGIN;ya+=ua.y-y(ua.y,za,ab);}ya=y(ya,i.ARROW_WIDTH/2,sa-i.ARROW_WIDTH/2);return ya;},_createCallout:function(pa){var qa=q.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0],ra=qa.cloneNode(true);q.appendContent(this.canvas,ra);w.set(ra,'z-index',pa);var sa=new i(this,ra);this.callouts.push(sa);return sa;},_getInternalCallout:function(){this.internalCallout=this.internalCallout||this._createCallout(l.CALLOUT_Z_INDEX);return this.internalCallout;},_getTooltipCallout:function(){this.tooltipCallout=this.tooltipCallout||this._createCallout(l.TOOLTIP_Z_INDEX);return this.tooltipCallout;},_assertInitialized:function(){},_guard:function(pa){return (function(qa,ra){if(!(!ra||!ra._instanceid))if(ra._instanceid===this.instanceid)return pa(qa,ra);}).bind(this);},_subscribe:function(pa,qa){this.listeners.push(m.subscribe(pa,this._guard(qa)));},_inform:function(pa,qa,ra){qa=qa||{};qa._instanceid=this.instanceid;m.inform('AggregatedMap/'+pa,qa,ra);},_bubbleClick:function(pa){this._inform(oa.Events.bubbleClick,pa);},_bubbleMouseover:function(pa){this._inform(oa.Events.bubbleMouseover,pa);},_bubbleMouseout:function(pa){this._inform(oa.Events.bubbleMouseout,pa);},_pinClick:function(pa){if(pa._agg_map_callout)if(this.getCallout().getAnchor()===pa){this.hideCallout();}else this.openCallout(pa,pa._agg_map_callout);this._inform(oa.Events.pinClick,pa);},_pinMouseover:function(pa){if(pa.name){var qa=q.create('span');p.addClass(qa,'fbAggregatedMapTooltipText');q.setContent(qa,pa.name);this.openTooltip(pa,qa,this.leftRightNoPanningStrategy());}this._inform(oa.Events.pinMouseover,pa);},_pinMouseout:function(pa){if(this.tooltipCallout&&this.tooltipCallout.getAnchor()===pa&&pa.name)this.tooltipCallout.close();this._inform(oa.Events.pinMouseout,pa);},_getVisibleBounds:function(){return new u(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l);},_getCenterOffset:function(){return {x:(this.pad.l-this.pad.r)/2,y:(this.pad.t-this.pad.b)/2};},_setMapView:function(pa,qa){var ra=this._getCenterOffset();if(pa.centerOffset){ra.x+=pa.centerOffset.x;ra.y+=pa.centerOffset.y;}pa.centerOffset=new this.microsoftMaps.Point(ra.x,ra.y);if(pa.center)pa.center=new this.microsoftMaps.Location(pa.center.latitude,pa.center.longitude);this.map.setView(pa);},_findMinZoomWherePinIsAlone:function(pa){if(this.visiblePins.length<2)return this.minZoom;var qa=Number.MAX_VALUE,ra=null,sa=pa.anchor.getAbsoluteXY();for(var ta=0;ta<this.visiblePins.length;ta++){var ua=this.visiblePins[ta],va=ua.anchor.getAbsoluteXY().distanceTo(sa);if(va<qa&&ua!==pa){qa=va;ra=ua;}}var wa=pa.getAggregationRadius()+ra.getAggregationRadius(),xa=this.maxZoom;while(qa/2>wa&&xa>this.minZoom){xa--;qa/=2;}while(xa<this.maxZoom){var ya=this._aggregateZoom(this.visiblePins,xa),za=false;for(var ab=0;ab<ya.length;ab++){var bb=ya[ab];if(bb.members.length==1&&bb.members[0]===pa)return xa;}xa++;}return xa;},_smartPan:function(pa,qa,ra,sa){pa=pa||this.maxCalloutWidth;qa=qa||this.maxCalloutHeight;var ta=t.pad(this._getNoPanBounds(qa),fa-this.CALLOUT_MARGIN),ua=new x(sa.getCenter().x,sa.calloutY);if(t.containsPoint(ta,ua)){var va=this._getVisibleBounds(),wa=ua.sub(t.boundPoint(this._getNoPanBounds(qa),ua)),xa=sa.w()/2+i.ARROW_HEIGHT_PLUS_PADDING+pa+this.CALLOUT_MARGIN;if(ua.x>va.getCenter().x){ra.setOrientation(j.LEFT);if(!wa.x)wa.x=ua.x-Math.max(ua.x,xa+va.l);}else{ra.setOrientation(j.RIGHT);if(!wa.x)wa.x=ua.x-Math.min(ua.x,va.r-xa);}var ya=null;if(wa.magnitude()>=1)ya=new x(this._getW()/2+wa.x+this._getCenterOffset().x,this._getH()/2+wa.y+this._getCenterOffset().y);return ya;}return this._anchoredPan(oa.Anchor.DEFAULT,j.RIGHT,this._getInternalCallout(),sa);},_leftRightNoPan:function(pa,qa){if(qa.getCenter().x>this._getVisibleBounds().getCenter().x){pa.setOrientation(j.LEFT);}else pa.setOrientation(j.RIGHT);},_noPan:function(pa,qa,ra){qa.setOrientation(pa);},_anchoredPan:function(pa,qa,ra,sa){var ta=this._getVisibleBounds();ra.setOrientation(qa);if(pa===oa.Anchor.DEFAULT)pa=new x(ta.getCenter().x-this.maxCalloutWidth/2-sa.w()/2,ta.getCenter().y-ja*this._getH()-ia+i.ARROW_WIDTH/2);return sa.getCenter().sub(pa).add(new x(this._getW()/2,this._getH()/2));},_renderOverlay:function(){if(!this.mapReady)return;this.lastRender=this.topLeft;var pa,qa=new u(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var ra=0;ra<this.groups.length;ra++){pa=this.groups[ra];var sa=pa.getCenter();if(t.containsPoint(qa,sa)){var ta=pa.renderMarker(this.canvas);if(pa.pins.length>1){ta.setOnClick(this._bubbleClick.bind(this,pa));ta.setOnMouseover(this._bubbleMouseover.bind(this,pa));ta.setOnMouseout(this._bubbleMouseout.bind(this,pa));}else{ta.setOnClick(this._pinClick.bind(this,pa.pins[0]));ta.setOnMouseover(this._pinMouseover.bind(this,pa.pins[0]));ta.setOnMouseout(this._pinMouseout.bind(this,pa.pins[0]));}}else pa.dismissMarker();}this._position();while(this.initialPinsToHide.length)p.hide(this.initialPinsToHide.pop());},_getNoPanBounds:function(pa){var qa=this._getVisibleBounds();return t.pad(new u(qa.t+ha,qa.r,qa.b-ha,qa.l),-this.CALLOUT_MARGIN);},_getCalloutAnchorGroup:function(pa){return pa&&(pa.group||pa);},_getPrimaryCalloutAnchor:function(){return this._getInternalCallout().getAnchor()||this._externalCalloutAnchor;},_getPrimaryCalloutAnchorGroup:function(){return this._getCalloutAnchorGroup(this._getPrimaryCalloutAnchor());},_zoom:function(pa,qa,ra,sa){qa=Math.max(n.MIN_ZOOM,Math.min(this.getZoom()+qa,n.MAX_ZOOM));this.map.setView({animate:pa,zoom:qa,center:ra,centerOffset:sa});},_getMapView:function(){return {center:this.map.getCenter(),zoom:this.map.getZoom(),width:this.map.getWidth(),height:this.map.getHeight()};},_setZoomButtonVisibility:function(){var pa=q.scry(this.canvas,"label.__1")[0],qa=q.scry(this.canvas,"label.__2")[0];pa&&p.conditionClass(pa,"uiButtonDisabled",this.getZoom()>=this.maxZoom);qa&&p.conditionClass(qa,"uiButtonDisabled",this.getZoom()<=this.minZoom);},_aggregate:function(){this.logger&&this.logger.startRun('_aggregate');var pa,qa=this._aggregateZoom(this.visiblePins,this.getZoom()),ra=[];for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];pa=new k(ta.members,ta.rect,ta.sprite,this.dynamicMap.mapToPixel.bind(this.dynamicMap));ra.push(pa);for(var ua=0;ua<ta.members.length;ua++)ta.members[ua].group=pa;}for(var va=0;va<this.groups.length;va++){pa=this.groups[va];pa.dismissMarker();pa.deleted=true;}for(var wa=0;wa<this.callouts.length;wa++)if(this.callouts[wa].getAnchor()&&this.callouts[wa].getAnchor().getType()==='AggregatedMapGroup')this.callouts[wa].close();this.groups=ra;this._renderOverlay();this.logger&&this.logger.endRun('_aggregate');},_combine:function(pa,qa){for(var ra=0;ra<qa.members.length;ra++)pa.members.push(qa.members[ra]);pa.rect=t.boundingBox(pa.rect,qa.rect);pa.sprite=pa.sprite.combine(qa.sprite);pa.radius=pa.sprite.getAggregationRadius();pa.center=pa.rect.getCenter();pa.single=0;return pa;},_overlap:function(pa,qa){var ra=pa.center.y-qa.center.y,sa=pa.center.x-qa.center.x;if(pa.single+qa.single==1)if(pa.single&&ra>ca/2){ra-=ca;}else if(qa.single&&-ra<ca/2)ra+=ca;var ta=pa.radius+qa.radius;return sa*sa+ra*ra<ta*ta;},_aggregateZoom:function(pa,qa){for(var ra=0;ra<pa.length;ra++){pa[ra].setZoom(qa);var sa=pa[ra].center;pa[ra].rect=new u(sa.y,sa.x,sa.y,sa.x);pa[ra].single=1;}var ta=[],ua=[];for(var va=0;va<pa.length;va++){var wa=pa[va],xa={};Object.assign(xa,wa);xa.radius=wa.getAggregationRadius();xa.members=[wa];if(xa.radius){ta.push(xa);}else ua.push(xa);}if(qa<this.maxZoom&&ta.length>1)ta=new s().aggregate(ta,this._combine.bind(this),this._overlap.bind(this));return ta.concat(ua);},_position:function(){this.logger&&this.logger.startRun('_position');var pa=this._getW()/2;for(var qa=0;qa<this.groups.length;qa++)this.groups[qa].updatePosition(pa);this.updateCallouts();this.logger&&this.logger.endRun('_position');},_getDims:function(){return new x(this._getW(),this._getH());},_getH:function(){return this.map.getHeight();},_getW:function(){return this.map.getWidth();},_onMapClick:function(){this._inform(oa.Events.mapClick);},_onViewChangeEnd:function(){this._inform(oa.Events.viewChangeEnd,this._getMapView(),m.BEHAVIOR_STATE);},_onViewChange:function(){this.mapReady=true;this._inform(oa.Events.viewChange,this._getMapView(),m.BEHAVIOR_STATE);this.topLeft=n.fromLatLong(this.getCenter()).add(this.getZoom(),this._getDims().mul(-.5));if(this.lastZoom!==this.getZoom()){this.lastZoom=this.getZoom();while(this.zoomStack.length&&this.getZoom()<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate();}else if(!this.lastRender||this.topLeft.calculateDistanceX(this.getZoom(),this.lastRender)>da||this.topLeft.calculateDistanceY(this.getZoom(),this.lastRender)>da){this._renderOverlay();}else this._position();var pa=q.scry(this.canvas,"span.__0")[0];pa&&p.conditionShow(pa,this._showSnapBack());},_showSnapBack:function(){if(this.zoomStack.length){return true;}else if(this.initialView){var pa=this.initialView;if(this.getZoom()>pa.zoom){return true;}else{var qa=this._getMapView(),ra=ma/o.scale(1,this.getZoom());return Math.abs(qa.center.latitude-pa.center.latitude)>ra||Math.abs(qa.center.longitude-pa.center.longitude)>ra;}}return false;},_onMouseDown:function(pa){this.xDown=pa.pageX;this.yDown=pa.pageY;},_onMouseUp:function(pa){if(this.xDown==pa.pageX&&this.yDown==pa.pageY)this._onMapClick();},_onZoomStart:function(pa){for(var qa=0;qa<this.groups.length;qa++)this.groups[qa].dismissMarker();},_onDoubleClick:function(pa){var qa=this.map.tryPixelToLocation(new this.microsoftMaps.Point(pa.getX(),pa.getY()),null);this._zoom(true,1,qa);pa.handled=true;return false;},_onBeforeLeave:function(){for(var pa=0;pa<this.listeners.length;pa++)this.listeners[pa].unsubscribe();this.bingMapEvents.forEach((function(qa){this.microsoftMaps.Events.removeHandler(qa);}).bind(this));}});Object.assign(oa,{Anchor:{DEFAULT:'default_anchor'},Events:{calloutHidden:'calloutHidden',ready:'ready',mapClick:'mapClick',viewChange:'viewChange',viewChangeEnd:'viewChangeEnd',bubbleClick:'bubbleClick',bubbleMouseover:'bubbleMouseover',bubbleMouseout:'bubbleMouseout',pinClick:'pinClick',pinMouseover:'pinMouseover',pinMouseout:'pinMouseout',onSearchSubmit:'onSearchSubmit'},Listeners:{hideCallout:'hideCallout',zoomDelta:'zoomDelta',zoomIn:'zoomIn',zoomOut:'zoomOut',zoomBack:'zoomBack',closeCalloutAndZoomBack:'closeCalloutAndZoomBack',onAddPin:'onAddPin'},inform:function(pa,event,qa,ra){if(!qa){qa={};qa._instanceid=pa;}m.inform('AggregatedMap/'+event,qa,ra);},listenThenInform:function(pa,qa,ra,sa){h.listen(qa,ra,function(){oa.inform(pa,sa);});},subscribe:function(pa,event,qa){m.subscribe('AggregatedMap/'+event,oa._guard(pa,qa));},subscribeAll:function(pa,qa){for(var ra in oa.Events){var sa=qa['aggregatedMapHandler_'+ra];if(sa){sa=sa.bind(qa);oa.subscribe(pa,ra,sa);}}},_guard:function(pa,qa){return (function(ra,sa,ta){if(!ta._instanceid){throw new Error('aggregated map didnt pass instanceid');}else if(ta._instanceid!==pa)return;return ra(ta);}).bind(this,qa);}});f.exports=oa;},null);
__d('AggregatedMapCircleSprite',['DOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(n,o,p,q){this._size=n;this._radius=o;if(q){this.chooseAggregationRadius=q;this._aggregationRadius=q(this._size);}this._count=p;}function j(){return this._radius;}function k(){return this._radius*2;}function l(n){switch(n){case i.SIZE_SMALL:return 9;case i.SIZE_MEDIUM:return 11;case i.SIZE_LARGE:return 16;}}function m(n){var o;if(this.chooseAggregationRadius){o=this.chooseAggregationRadius;}else o=l;var p=this.getCount()+n.getCount();if(p>=100){return i.large(p,o);}else if(p>=10){return i.medium(p,o);}else return i.small(p,o);}Object.assign(i.prototype,{render:function(){var n=h.create('div',{className:['fbAggregatedMapBubble','fbAggregatedMapBubble'+this._size].join(' ')});h.setContent(n,this._count);var o=h.create('div',{className:['fbAggregatedMapBubbleShell','fbAggregatedMapBubbleShell'+this._size].join(' ')});h.setContent(o,n);this._root=o;return o;},combine:m,getCount:function(){return this._count;},getHeight:k,getWidth:k,getAnchorX:j,getAnchorY:j,getCalloutX:j,getCalloutY:j,getAggregationRadius:function(){return this._aggregationRadius;}});Object.assign(i,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:'Small',SIZE_MEDIUM:'Medium',SIZE_LARGE:'Large',small:function(n,o){return new i(i.SIZE_SMALL,i.RADIUS_SMALL,n,o);},medium:function(n,o){return new i(i.SIZE_MEDIUM,i.RADIUS_MEDIUM,n,o);},large:function(n,o){return new i(i.SIZE_LARGE,i.RADIUS_LARGE,n,o);},combine:m});f.exports=i;},null);
__d('AggregatedMapPin',['BingMapCoordinate'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j,k,l,m,n){this.anchor=h.fromLatLong(j);this.sprite=k;this.name=l||null;this.group=null;this.xhp=m;this.profileID=n;}Object.assign(i.prototype,{getType:function(){return 'AggregatedMapPin';},setZoom:function(j){this.center=this.anchor.getMapXY(j);},getLatitude:function(){return this.anchor.getLatitude();},getLongitude:function(){return this.anchor.getLongitude();},getGroup:function(){return this.group;},getAggregationRadius:function(){return this.sprite.getAggregationRadius();},setSprite:function(j){this.sprite=j;},setCallout:function(j){this._agg_map_callout=j;}});Object.assign(i,{create:function(j,k,l,m){return new i(j,k,l,m);}});f.exports=i;},null);
__d('AggregatedMapRedPinSprite',['AggregatedMapCircleSprite','CSS','DOM'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l,m,n,o,p,q,r,s,t){this.size=l;this.image=m;this.width=n;this.height=o;this.calloutY=p;this.aggregationRadius=q;this.text=s;this.count=r;this.css=t;}Object.assign(k.prototype,{render:function(){var l=j.create('div');i.addClass(l,'fbAggregatedMapPin');i.addClass(l,'fbAggregatedMapPin'+this.size);if(this.css)i.addClass(l,this.css);var m='/images/places/map/'+this.image,n=j.create('img',{src:m});j.appendContent(l,n);var o=null;if(this.text){o=j.create('div');i.addClass(o,'fbAggregatedMapPinText');i.addClass(o,'fbAggregatedMapPinText'+this.size);j.setContent(o,this.count);j.appendContent(l,o);}return l;},combine:h.combine,getCount:function(){return this.count;},getHeight:function(){return this.height;},getWidth:function(){return this.width;},getAnchorX:function(){return this.width/2;},getAnchorY:function(){return this.height;},getCalloutX:function(){return this.width/2;},getCalloutY:function(){return this.calloutY;},getAggregationRadius:function(){return this.aggregationRadius;}});Object.assign(k,{dot:function(l){if(l===undefined)l=1;return new k('Small','small_dot.png',17,22,8,10,l,false);},smallBlank:function(l){return new k('Small','small_blank.png',17,22,8,10,l,true);},mediumBlank:function(l){return new k('Medium','medium_blank.png',25,34,12,14,l,true);},largeBlank:function(l){return new k('Large','large_blank.png',29,43,14,17,l,true);}});f.exports=k;},null);
__d('TimelineMapPlace',['arrayContains'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){this.stories=[];this.creation=false;this.name=null;j.latitude||(j.latitude=0);j.longitude||(j.longitude=0);Object.assign(this,j);if(this.region)this.region=this.region+':'+this.country;this.visibleStories=this.stories;}Object.assign(i.prototype,{setFilters:function(j){var k=[];for(var l=0;l<this.stories.length;l++)if(!j||h(this.stories[l].categories,j))k.push(this.stories[l]);this.visibleStories=k;},getStories:function(j,k){if(j===undefined)j=true;var l=j?this.visibleStories:this.stories;if(!k){return l;}else{var m=[];for(var n=0;n<l.length;n++){var o=l[n];if(k(o))m.push(o);}return m;}},count:function(j,k){var l=this.getStories(j,k).length;if(this.creation)l++;return l;}});Object.assign(i,{Filters:{MLE:function(j){return j&&!j.isEnt;},ALL:null}});f.exports=i;},null);
__d("TimelineMapStory",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){Object.assign(this,i);}f.exports=h;},null);
__d('TimelineMapController',['AggregatedMap','shield','AggregatedMapCalloutOrientation','AggregatedMapPin','AggregatedMapRedPinSprite','Arbiter','AsyncRequest','BingMapCoordinate','CSS','DOM','MapRects','PageEvents','Rect','Style','TimelineMapPlace','TimelineMapStory','Vector','$','isEmpty','mod','randomShuffle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();var ca=198,da=132,ea=108;function fa(ga,ha,ia,ja,ka,la,ma){this.profileID=null;this.viewasID=null;this.places={};this.visiblePins=null;this.stories={};this.hiddenStories={};this.placesByTime=[];this.category=null;this.pending=null;this.waitingOnConfirmation=false;this.highlightedPin=null;this.arbiterListeners=[];this.calloutBeingFetched=null;this.initialized=false;this._lastResizeCalloutAnchor=null;this._lastResizeCalloutStoryHeight=null;this._lastResizeCalloutStory=null;this._scrollableCalloutController=null;this.inCreation=false;this.lastTypeaheadEvent=null;this.initialPosition=null;this.initialPlace=null;this.initialStory=null;this.hh=0;this.ww=0;this.smartPan=null;this.requestID=0;this.asyncRequests={};this.intervals=[];this.groups=[];this.pagerIndex=null;this.categoryCountUnique={};if(ga)this._init(ga,ha,ia,ja,ka,la,ma);}Object.assign(fa.prototype,{HOVER_FETCH_DELAY:100,HOVER_DISMISS_DELAY:300,MAP_BOTTOM_PADDING:40,MIN_MAP_HEIGHT:532,MIN_CALLOUT_STORY_HEIGHT:200,MAX_CALLOUT_HEIGHT:600,RESIZE_CHECK_INTERVAL:50,HOVERCARD_WIDTH:279,HOVERCARD_HEIGHT:251,HOVERCARD_CLOSED:undefined,HOVERCARD_WAITING_TO_FETCH:1,HOVERCARD_BEING_FETCHED:2,HOVERCARD_OPEN:3,HOVERCARD_WAITING_TO_DISMISS:4,TIMELINE_MAP_HOVERCARD_PLACE:'Place',TIMELINE_MAP_HOVERCARD_CITY:'City',TIMELINE_MAP_HOVERCARD_REGION:'Region',TIMELINE_MAP_HOVERCARD_COUNTRY:'Country',HOVERCARD_CITY_REGION_HEURISTIC:3,setCategory:function(ga){this.logger&&this.logger.startRun('set-category');this.map.hideCallout();this.category=ga;this._filter();},setCategoryCountUnique:function(ga){this.categoryCountUnique=ga;},getCategories:function(){var ga={},ha,ia;for(var ja in this.places){var ka=this.places[ja],la={};for(var ma=0;ma<ka.stories.length;ma++){ia=ka.stories[ma];if(ia.categories)for(var na=0;na<ia.categories.length;na++){ha=ia.categories[na];if(!ga[ha])ga[ha]={count:0,name:ha};if(!la[ha])la[ha]=1;ga[ha].count++;}}}return ga;},zoomToVisible:function(){this.map.zoomTo(this.visiblePins);},cleanupCreationCallout:function(ga){this.map.hideCallout(ga);this._cleanUpHighlightedPin();},cancelCreation:function(ga){if(!this.inCreation)return;this.inCreation=false;this.cleanupCreationCallout();},creationFinished:function(ga,ha){var ia=ha.place,ja=ha.story,ka=ha.showCallout;this.inCreation=false;this.waitingOnConfirmation=false;this.cleanupCreationCallout();this.addStories(null,{stories:[ja],places:[ia]});if(ka)this.showCallout(null,{place_id:ia.id,story_id:ja.id});},page:function(ga){var ha=this.map.getGroups();if(!ha)return;var ia=[],ja=true,ka=0;for(var la=0;la<ha.length;la++){var ma=ha[la];if(ma.hasMarker()){var na=ma.getCenter(),oa=new t(0,this.ww,this.hh,0);if(r.containsPoint(oa,na)){ia.push(ma);if(ma===this.groups[ka]){ka++;}else if(ja)ja=false;}}}ja=ja&&ka===this.groups.length;if(!ja){this.groups=ia;this.sortedGroups=ia.concat([]).sort(function(qa,ra){return qa.getCenter().x-ra.getCenter().x;});if(ga>0){this.pagerIndex=0;}else this.pagerIndex=-1;}else this.pagerIndex+=ga>0?1:-1;this.pagerIndex=aa(this.pagerIndex,this.sortedGroups.length);var pa=this.sortedGroups[this.pagerIndex];if(pa.pins.length>1){this._openCallout(pa,this.map.throbber(325),this.map.leftRightNoPanningStrategy());pa.hoverPermanent=true;pa.hoverState=this.HOVERCARD_WAITING_TO_FETCH;this._fetchHovercard(pa);}else this.aggregatedMapHandler_pinClick(null,pa.pins[0]);},hovercard:function(ga,ha){var ia=this._getAsyncContext(ha.requestID);if(ia.deleted||ia.hoverState!==this.HOVERCARD_BEING_FETCHED)return;ia.hoverState=this.HOVERCARD_OPEN;var ja=q.create('div');ja.onmouseover=(function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseover(null,this.map.getCallout().getAnchor());}).bind(this);ja.onmouseout=(function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseout(null,this.map.getCallout().getAnchor());}).bind(this);p.setClass(ja,'fbTimelineMapHovercard');q.setContent(ja,ha.content);if(ia===this.map.getCallout().getAnchor()){this.map.getCallout().setContent(ja);}else this._openCallout(ia,ja,this.map.leftRightNoPanningStrategy());this.map.getCallout().recalculateArrowYOffset(true);this.logger&&this.logger.endRun('load-hovercard');},callout:function(ga,ha){var ia=this._getAsyncContext(ha.requestID);if(this.map.getCallout().getAnchor()!==ia)return;this._openCallout(ia,ha.content);this.logger&&this.logger.endRun('load-callout');},addPending:function(ga,ha){var ia=ha.count;this.pending=this.pending||0;this.pending+=ia;this._checkReady();},hideCallout:function(ga,ha){ha=ha||{};ha._instanceid=this.instanceID;m.inform('AggregatedMap/hideCallout',ha);},addStories:function(ga,ha){var ia=ha.stories,ja=ha.places;if(ha.count)this.pending=(this.pending||0)-ha.count;var ka,la,ma,na;for(na=0;na<ja.length;na++){la=new v(ja[na]);if(!this.places[la.id]){this.places[la.id]=la;this.placesByTime.push(la);}la.mostRecentTimestamp=0;}for(na=0;na<ia.length;na++){ma=new w(ia[na]);this.stories[ma.id]=ma;ka=ma.placeID;la=this.places[ka];la.stories.push(ma);la.mostRecentTimestamp=Math.max(la.mostRecentTimestamp,ma.timestamp);}if(ha.count===undefined){this._refresh();}else this._checkReady();},updateStory:function(ga,ha){var ia=ha.place,ja=ha.story,ka=this.stories[ja.id];if(ka.placeID!=ia.id){var la={};la[ka.id]=true;this._removeStories(ka.placeID,la);this.addStories(null,{stories:[ja],places:[ia]});}this._showCallout(this.places[ia.id].pin,ia.id,ja.id);},deleteStory:function(ga,ha){var ia=this.map.getCallout().getAnchor(),ja=this.stories[ha];if(!ja)return;var ka={};ka[ja.id]=true;this.map.hideCallout();var la=this._removeStories(ja.placeID,ka);la.stories_removed&&this._refresh();!la.place_removed&&this._showCallout(ia,ia.place.id);},hideStory:function(ga,ha){var ia=this.map.getCallout().getAnchor(),ja=this.stories[ha.story_id];if(!ia)return;if(ia.getType()!=='AggregatedMapPin')return;if(!ja||ja.placeID!=ia.place.id)return;var ka=y(ha.story_domid);p.hide(ka);var la=q.insertAfter(ka,ha.undo_html)[0];this.hiddenStories[ja.id]={story_domid:ka.id,undo_domid:la.id};},undoHideStory:function(ga,ha){var ia=this.stories[ha],ja=this.hiddenStories[ia.id];q.remove(ja.undo_domid);p.show(ja.story_domid);delete this.hiddenStories[ia.id];},showCallout:function(ga,ha){var ia=this.places[ha.place_id].pin;this._showCallout(ia,ha.place_id,ha.story_id);},zoomIntoOne:function(ga,ha){var ia=this.places[ha.place_id];this._zoomToPlace(ia);},zoomToArea:function(ga,ha){var ia=ha.type,ja=ha.key,ka=[];for(var la in this.places){var ma=this.places[la],na=ma.pin;if(ma.city===ja&&ia===this.TIMELINE_MAP_HOVERCARD_CITY||ma.region===ja&&ia===this.TIMELINE_MAP_HOVERCARD_REGION||ma.country===ja&&ia===this.TIMELINE_MAP_HOVERCARD_COUNTRY)ka.push(na);}this.map.zoomInto(ka);},creationFlow:function(ga,ha){var ia=ha.place,ja={latitude:ia.latitude,longitude:ia.longitude};this.waitingOnConfirmation=false;this._highlightPlace(ia.id,ja);this._openCallout(this.highlightedPin,ha.content,this.smartPan);this.inCreation=true;},highlightMapPlace:function(ga,ha){if(ha.dismiss&&this.waitingOnConfirmation)return;if(ha.showThrobber){this._openCallout(this.highlightedPin,this.map.throbber(),this.smartPan);return;}this.map.hideCallout();if(ha.dismiss){this._cleanUpHighlightedPin();}else if(ha.selected){this.waitingOnConfirmation=true;}else if(ha.center)this._highlightPlace(ha.placeID,ha.center);this.map.setView(ha);},registerScrollableCallout:function(ga,ha){this._scrollableCalloutController=ha;},_init:function(ga,ha,ia,ja,ka,la,ma){this.profileID=ga;this.viewasID=ha.viewas;this.mapContainer=ia;this.canvas=q.find(this.mapContainer,'.fbAggregatedMapContainer');this.logger=ka;this.instanceID=ja;this._dynamicSize=ha.dynamicSize;if(ha.center)this.initialPosition={latitude:ha.center.lat,longitude:ha.center.long};this.initialPlace=ha.highlightedPlace;this.initialStory=ha.highlightedStory;this.enableHovercards=ha.enableHovercards;this.calloutDiv=la&&y(la);this.maxCalloutHeight=this.MAX_CALLOUT_HEIGHT;if(ha.maxCalloutHeight&&ha.maxCalloutHeight<this.MAX_CALLOUT_HEIGHT)this.maxCalloutHeight=ha.maxCalloutHeight;if(ma){ma.subscribe('next',this.page.bind(this,1));ma.subscribe('previous',this.page.bind(this,-1));}this.border=y('fbTimelineMapBorder');this._subscribe(s.AJAXPIPE_ONUNLOAD,this._onBeforeLeave.bind(this));this._subscribe('AggregatedMap/ready',this._onInit.bind(this));this._subscribe('AggregatedMap/calloutHidden',this.cancelCreation.bind(this));this._subscribe('AggregatedMap/calloutHidden',i(m.inform,null,'reflow'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadFocus',this._handleTypeahead.bind(this,'focus'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadBlur',this._handleTypeahead.bind(this,'blur'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadSelect',this._handleTypeahead.bind(this,'select'));},_onInit:function(ga,ha){this.map=ha;if(this._dynamicSize){this._resizeMap();this.intervals=[setInterval(this._resizeMap.bind(this),this.RESIZE_CHECK_INTERVAL),setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL)];}else{this.hh=this.map.getHeight();this.ww=this.map.getWidth();}this.initialized=true;for(var ia in fa.Listeners)this._subscribe('TimelineMap/'+ia,this[ia].bind(this));for(var ja in h.Events){var ka=this['aggregatedMapHandler_'+ja];if(ka){ka=ka.bind(this);this._subscribe('AggregatedMap/'+ja,ka);}}this.smartPan=this.map.smartPanningStrategy();},_getAsyncContext:function(ga){var ha=this.asyncRequests[ga];delete this.asyncRequests[ga];return ha;},_storeAsyncContext:function(ga){var ha=this.requestID++;this.asyncRequests[ha]=ga;return ha;},_inform:function(ga,ha,ia){ha=ha||{};ha._instanceid=this.instanceID;fa.inform('TimelineMap/'+ga,ha,ia);},_cleanUpHighlightedPin:function(){if(this.highlightedPin){if(this.highlightedPin.isPreview){this.map.removePin(this.highlightedPin);}else{this.highlightedPin.setSprite(this._getPlaceSprite(this.highlightedPin.place));this.map.redraw();}this.highlightedPin=null;p.removeClass(this.canvas,'fbTimelineMapDimPinMode');}},_handleTypeahead:function(ga){!this.inCreation&&ga=='blur'&&this.lastTypeaheadEvent=='focus';this.lastTypeaheadEvent=ga;},_checkReady:function(){if(this.pending!==0)return;this._refresh();if(this.logger){window._cstart&&this.logger.set('flushTTI',Date.now()-window._cstart);for(var ga in this.places){var ha=this.places[ga];this.logger.bump('places');this.logger.bump('stories',ha.count());}this.logger.set('profileID',this.profileID);}if(window.CavalryLogger)window.CavalryLogger.getInstance().measurePageLoad(true);var ia=this.initialPlace,ja=this.initialStory;if(ia){this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();var ka=this.places[ia].pin;if(ka){var la=new x(ca,da);la=la.sub(new x(this.ww/2,this.hh/2));this.map.zoomIntoOne(ka,la);var ma=q.find(this.calloutDiv,'.fbTimelineMapCallout');q.remove(this.calloutDiv);this._openCallout(ka,ma);this.map.getCallout().setArrowYOffset(ea);this.map.updateCallouts();}}else if(this.initialPosition){this.map.setView({center:this.initialPosition});}else{this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();}p.addClass(this.border,'fbTimelineMapContainerLoaded');},_refresh:function(){this.placesByTime=this.placesByTime.sort(function(ga,ha){return ga.mostRecentTimestamp-ha.mostRecentTimestamp;});this._filter();this._inform(fa.Events.updateCategories,null,m.BEHAVIOR_STATE);},_resizeMap:function(){var ga=x.getViewportDimensions().y,ha=x.getElementPosition(this.border).y,ia=x.getElementDimensions(this.border).y,ja=ga-(ha+ia),ka=this.hh+ja-this.MAP_BOTTOM_PADDING;ka=Math.max(this.MIN_MAP_HEIGHT,Math.min(ka,ga));if(Math.abs(this.hh-ka)>1){u.set(this.mapContainer,'height',ka+'px');this.map.invalidateSize();this.hh=ka;this.ww=this.map.ww;this._resizeMap();}},resizeCallout:function(){var ga=this.map.getCallout().getContent(),ha=q.scry(ga,'.fbTimelineMapScrollableStory');for(var ia=ha.length-1;ia>=0;ia--)if(!p.hasClass(ha[ia],'hidden_elem')){var ja=ha[ia],ka=q.find(ja,'.fbTimelineMapCalloutStory');break;}if(!(ga&&ka&&ja))return;var la=x.getElementDimensions(ka).y;if(this.map.getCallout().getAnchor()===this._lastResizeCalloutAnchor&&la===this._lastResizeCalloutStoryHeight&&ka===this._lastResizeCalloutStory)return;var ma=q.find(ga,'.fbTimelineMapCalloutHeader'),na=x.getElementDimensions(ma).y,oa=x.getElementPosition(ja).y,pa=x.getElementPosition(this.mapContainer).y,qa=this.hh-this.map.CALLOUT_MARGIN,ra=Math.max(this.MIN_CALLOUT_STORY_HEIGHT,Math.min(pa+qa-oa,qa-na)),sa=Math.min(la,ra,this.maxCalloutHeight);u.set(ja,'height',sa+'px');this._lastResizeCalloutAnchor=this.map.getCallout().getAnchor();this._lastResizeCalloutStoryHeight=la;this._lastResizeCalloutStory=ka;if(this._scrollableCalloutController)this._scrollableCalloutController.adjustGripper();this.map.getCallout()._updateDimensions();this.map.getCallout().recalculateArrowYOffset();},_filter:function(){var ga=[];for(var ha in this.places){var ia=this.places[ha];ia.setFilters(this.category);if(ia.count()>0){var ja=this._getPlaceSprite(ia),ka=k.create(ia,ja,ia.name);ia.pin=ka;ka.place=ia;ga.push(ka);}}this.visiblePins=ga;if(this.highlightedPin)this.visiblePins.push(this.highlightedPin);this.map.setPins(ga);},_getPlaceSprite:function(ga){var ha=ga.getStories(),ia=ha.length,ja;if(ia>=100){ja=l.largeBlank(ia);}else if(ia>10){ja=l.mediumBlank(ia);}else if(ia>1){ja=l.smallBlank(ia);}else if(ha[0]&&ha[0].pin){ja=l.mediumBlank(1);ja.text=false;ja.image=ha[0].pin+'.png';}else ja=l.dot();return ja;},_getHighlightedSprite:function(){var ga=l.dot();ga.aggregationRadius=0;ga.css='fbTimelineMapHighlighted';return ga;},_highlightPlace:function(ga,ha){this._cleanUpHighlightedPin();var ia;if(ga&&this.places[ga]!==undefined){ia=this.places[ga].pin;ia.setSprite(this._getHighlightedSprite());this.map.redraw();}else{ia=new k(o.fromLatLong(ha),this._getHighlightedSprite());ia.isPreview=true;this.map.addPin(ia);}this.highlightedPin=ia;p.addClass(this.canvas,'fbTimelineMapDimPinMode');return ia;},_showCallout:function(ga,ha,ia){if(this.map.getCallout()&&this.map.getCallout().getOrientation()){var ja=this.map.getCallout().getOrientation()===j.LEFT,ka=new x(ja?200:-200,-100);this.map.zoomIntoOne(ga,ka);}this._openCallout(ga,this.map.throbber(),this.smartPan);this._fetchCallout(ga,ha,ia);},_fetchCallout:function(ga,ha,ia){this.logger&&this.logger.startRun('load-callout');var ja=this._storeAsyncContext(ga),ka=this.places[ha],la=[],ma={},na=ka.getStories();for(var oa=0;oa<na.length;++oa){var pa=na[oa];if(!pa.isEnt){la.push(pa.unitParams);}else{ma[pa.storyType]=ma[pa.storyType]||[];ma[pa.storyType].push(pa.id);}}var qa={profile_id:this.profileID,targetid:ka.id,storyid:ia,unitparams:la,storiesbytype:ma,request_id:ja};if(this.viewasID&&this.viewasID!="0")qa.viewas=this.viewasID;new n().setURI('/ajax/timeline/map/callout.php').setMethod('POST').setData(qa).send();},_openCallout:function(ga,ha,ia){var ja=this.map.getCallout().getAnchor();ja&&this._dismissHovercard(ja);this.map.openCallout(ga,ha,ia);this.resizeCallout();},_zoomToPlace:function(ga){var ha=j.LEFT,ia=j.RIGHT,ja=this.map.getCallout().getOrientation()===ha,ka=new x(ja?200:-200,-100);this.map.zoomIntoOne(ga.pin,ka);this._openCallout(ga.pin,this.map.throbber(),this.map.noPanningStrategy(ja?ha:ia));this._fetchCallout(ga.pin,ga.id);},_fetchHovercard:function(ga){this.logger&&this.logger.startRun('load-hovercard');if(ga.deleted||ga.hoverState!==this.HOVERCARD_WAITING_TO_FETCH)return;if(ga.pins.length<2)throw 'bubble has < 2 pins!';delete ga.timeoutToken;ga.hoverState=this.HOVERCARD_BEING_FETCHED;var ha=[],ia=[],ja={},ka={},la={},ma={},na={},oa={};ga.pins.forEach(function(lb){var mb=lb.place,nb=mb.getStories();oa[mb.id]=true;for(var ob=0;ob<nb.length;ob++)ha.push(nb[ob]);ia.push(mb);if(mb.city){ja[mb.city]=ja[mb.city]||0;ja[mb.city]++;if(mb.region)na[mb.region]=mb.city;if(mb.country)ma[mb.country]=mb.city;}if(mb.region){ka[mb.region]=ka[mb.region]||0;ka[mb.region]++;}if(mb.country){la[mb.country]=la[mb.country]||0;la[mb.country]++;}});var pa=ia.length,qa=this._storeAsyncContext(ga),ra=this._getStoriesByType(ha).TimelineMapStoryPhoto||[],sa=ra.length,ta=ba(ra).slice(0,4),ua={},va=ia.length<=3,wa=ia.sort(function(lb,mb){return mb.getStories().length-lb.getStories().length;}).slice(0,3).map(function(lb){var mb=0,nb={},ob=lb.getStories();for(var pb=0;pb<ob.length;pb++){var qb=ob[pb],rb=qb.visitID;if(rb===0){mb++;}else if(!(rb in nb)){nb[rb]=true;mb++;}}ua[lb.id]=mb;return lb.id;}),xa=false,ya=false,za=false;for(var ab in this.places){var bb=this.places[ab];if(!oa[bb.id]&&(za=za||la[bb.country])&&(ya=ya||ka[bb.region])&&(xa=xa||ja[bb.city]))break;}var cb=null,db=null,eb=null,fb=null,gb=null,hb=function(lb,mb,nb){return lb[nb]-lb[mb];};ja=Object.keys(ja).sort(hb.bind(null,ja));ka=Object.keys(ka).sort(hb.bind(null,ka));la=Object.keys(la).sort(hb.bind(null,la));var ib={};ib[this.TIMELINE_MAP_HOVERCARD_COUNTRY]=la.map(function(lb){return ma[lb];});ib[this.TIMELINE_MAP_HOVERCARD_REGION]=ka.map(function(lb){return na[lb];});ib[this.TIMELINE_MAP_HOVERCARD_CITY]=ja;ib[this.TIMELINE_MAP_HOVERCARD_PLACE]=ia.map(function(lb){return lb.id;});if(la.length>0)if(!za){db=this.TIMELINE_MAP_HOVERCARD_COUNTRY;if(la.length>1){fb=this.TIMELINE_MAP_HOVERCARD_COUNTRY;}else if(ka.length>1){fb=this.TIMELINE_MAP_HOVERCARD_REGION;}else fb=this.TIMELINE_MAP_HOVERCARD_CITY;}if(ka.length>0&&!db){var jb=this.HOVERCARD_CITY_REGION_HEURISTIC;if(!ya||ka.length>1&&ja.length>ka.length*jb){db=this.TIMELINE_MAP_HOVERCARD_REGION;if(ka.length>1){fb=this.TIMELINE_MAP_HOVERCARD_REGION;}else fb=this.TIMELINE_MAP_HOVERCARD_CITY;}}if(ja.length>0&&!db)if(!xa||ja.length>1){db=this.TIMELINE_MAP_HOVERCARD_CITY;if(ja.length>1){fb=this.TIMELINE_MAP_HOVERCARD_CITY;}else gb=ia.length;}if(!db){db=this.TIMELINE_MAP_HOVERCARD_PLACE;gb=-1;}cb=ib[db];if(fb)eb=ib[fb];var kb={profile_id:this.profileID,request_id:qa,target_count:pa,photo_count:sa,photo_ids:ta,place_counts:ua,target_ids:wa,all_places:va,ids:cb,title_type:db,subtitle_count:gb,links:eb,link_type:fb};if(this.viewasID&&this.viewasID!="0")kb.viewas=this.viewasID;new n().setURI('/ajax/timeline/map/hovercard.php').setMethod('POST').setData(kb).send();},_dismissHovercard:function(ga){delete ga.timeoutToken;delete ga.hoverState;delete ga.hoverPermanent;if(this.map.getCallout().getAnchor()===ga)this.map.hideCallout();},_getStoriesByType:function(ga){var ha={};ga.forEach(function(ia){ha[ia.storyType]=ha[ia.storyType]||[];ha[ia.storyType].push(ia.isEnt?ia.id:ia.unitParams);});return ha;},_removeStories:function(ga,ha){var ia=0,ja=false,ka=this.places[ga],la=[],ma;for(ma=0;ma<ka.stories.length;++ma){var na=ka.stories[ma];if(ha[na.id]){delete this.stories[na.id];++ia;}else la.push(na);}if(la.length===0){delete this.places[ga];ja=true;}else ka.stories=la;return {place_removed:ja,stories_removed:ia};},_removeHiddenStories:function(){var ga=this.map.getCallout().getAnchor();if(!ga)return;if(ga.getType()!=='AggregatedMapPin')return;if(z(this.hiddenStories))return;var ha=ga.place.id,ia=this._removeStories(ha,this.hiddenStories);if(ia.stories_removed!==0){this._refresh();this.hiddenStories={};}},_guard:function(ga){return (function(ha,ia){if(!ia||!ia._instanceid||ia._instanceid===this.instanceID)ga(ha,ia);}).bind(this);},_subscribe:function(ga,ha){this.arbiterListeners.push(m.subscribe(ga,this._guard(ha)));},aggregatedMapHandler_mapClick:function(){this._removeHiddenStories();this.map.hideCallout();this._inform(fa.Events.mapClick);},aggregatedMapHandler_pinClick:function(ga,ha){this.logger&&this.logger.bumpTap('pin-click');this._removeHiddenStories();if(this.map.getCallout().getAnchor()===ha){this.map.hideCallout();}else this._showCallout(ha,ha.place.id);},aggregatedMapHandler_bubbleClick:function(ga,ha){this.logger&&this.logger.bumpTap('bubble-click');this.map.hideCallout();this.map.zoomInto(ha.pins);},aggregatedMapHandler_bubbleMouseover:function(ga,ha){if(!this.enableHovercards||ha.hoverPermanent)return;if(!ha.hoverState||ha.hoverState===this.HOVERCARD_CLOSED){ha.hoverState=this.HOVERCARD_WAITING_TO_FETCH;ha.timeoutToken=setTimeout(this._fetchHovercard.bind(this,ha),this.HOVER_FETCH_DELAY);}else if(ha.hoverState===this.HOVERCARD_WAITING_TO_DISMISS){clearTimeout(ha.timeoutToken);delete ha.timeoutToken;ha.hoverState=this.HOVERCARD_OPEN;}},aggregatedMapHandler_bubbleMouseout:function(ga,ha){if(ha.hoverPermanent)return;if(ha.hoverState===this.HOVERCARD_WAITING_TO_FETCH||ha.hoverState===this.HOVERCARD_BEING_FETCHED){clearTimeout(ha.timeoutToken);delete ha.timeoutToken;delete ha.hoverState;}else if(ha.hoverState===this.HOVERCARD_OPEN){ha.timeoutToken=setTimeout(this._dismissHovercard.bind(this,ha),this.HOVER_DISMISS_DELAY);ha.hoverState=this.HOVERCARD_WAITING_TO_DISMISS;}},_onBeforeLeave:function(){for(var ga=0;ga<this.arbiterListeners.length;ga++)this.arbiterListeners[ga].unsubscribe();for(var ha=0;ha<this.intervals.length;ha++)clearInterval(this.intervals[ha]);this.logger=null;this.map=null;this.places=null;}});Object.assign(fa,{Events:{updateCategories:'updateCategories',mapClick:'mapClick'},Listeners:{addStories:'addStories',updateStory:'updateStory',deleteStory:'deleteStory',hideStory:'hideStory',undoHideStory:'undoHideStory',addPending:'addPending',creationFlow:'creationFlow',cleanupCreationCallout:'cleanupCreationCallout',cancelCreation:'cancelCreation',creationFinished:'creationFinished',showCallout:'showCallout',callout:'callout',resizeCallout:'resizeCallout',hovercard:'hovercard',highlightMapPlace:'highlightMapPlace',registerScrollableCallout:'registerScrollableCallout',zoomToVisible:'zoomToVisible',hideCallout:'hideCallout',zoomIntoOne:'zoomIntoOne',zoomToArea:'zoomToArea'},inform:function(ga,ha,ia){if(!ha||!ha._instanceid)return;return m.inform(ga,ha,ia||m.BEHAVIOR_PERSISTENT);}});f.exports=fa;},null);
__d('TimelinePlacesSubCollection',['Arbiter','CSS','Event','TimelineMapController','cx','tidyEvent'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n="_3s-";function o(p){'use strict';this.$TimelinePlacesSubCollection1=p.id;this.$TimelinePlacesSubCollection2=p.parent_collection;this.$TimelinePlacesSubCollection3=p.sub_tab;this.$TimelinePlacesSubCollection4=p.entity_id;this.$TimelinePlacesSubCollection5=p.collection_token;this.$TimelinePlacesSubCollection6=p.profile_id;this.$TimelinePlacesSubCollection7=p.places_filter;this.$TimelinePlacesSubCollection8=p.city_id;this.$TimelinePlacesSubCollection9=null;this.$TimelinePlacesSubCollection10=0;this.$TimelinePlacesSubCollection11=0;}o.prototype.hide=function(){'use strict';this.$TimelinePlacesSubCollection3&&i.hasClass(this.$TimelinePlacesSubCollection3,n)&&i.removeClass(this.$TimelinePlacesSubCollection3,n);var p=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(p!=null)h.inform('TimelineMap/hideCallout',{_instanceid:p},h.BEHAVIOR_PERSISTENT);};o.prototype.show=function(){'use strict';!i.hasClass(this.$TimelinePlacesSubCollection3,n)&&i.addClass(this.$TimelinePlacesSubCollection3,n);this.$TimelinePlacesSubCollection12();h.subscribe('AggregatedMap/ready',this.$TimelinePlacesSubCollection13(this.$TimelinePlacesSubCollection12.bind(this)));};o.prototype.getSubTabNode=function(){'use strict';return this.$TimelinePlacesSubCollection3;};o.prototype.getParentCollection=function(){'use strict';return this.$TimelinePlacesSubCollection2;};o.prototype.getEntityID=function(){'use strict';return this.$TimelinePlacesSubCollection4;};o.prototype.$TimelinePlacesSubCollection12=function(){'use strict';var p=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(p==null)return;h.inform('TimelineMap/zoomToArea',{_instanceid:p,type:k.prototype.TIMELINE_MAP_HOVERCARD_CITY,key:this.$TimelinePlacesSubCollection8},h.BEHAVIOR_PERSISTENT);};o.prototype.$TimelinePlacesSubCollection13=function(p){'use strict';return (function(q,r){if(!r||!r.$TimelinePlacesSubCollection14||r.$TimelinePlacesSubCollection14===this.$TimelinePlacesSubCollection2.getMapInstanceID())p(q,r);}).bind(this);};o.prototype.$TimelinePlacesSubCollection15=function(){'use strict';if(this.getParentCollection().getActiveSubCollection()===this)return true;return false;};o.build=function(p,q,r,s,t,u,v){'use strict';if(p!=null&&q&&r&&r.sub_tab&&r.entity_id!=null&&s&&t!=null&&u!=null&&v!=null){var w={id:p,parent_collection:q,sub_tab:r.sub_tab,entity_id:r.entity_id,collection_token:s,profile_id:t,places_filter:u,city_id:v},x=new o(w);m(j.listen(x.getSubTabNode(),'click',function(y){x.getParentCollection().setActiveSubCollection(x);}));return x;}return null;};f.exports=o;},null);
__d('TimelinePlacesCollection',['CSS','DOM','DOMDimensions','DOMQuery','MenuItem','TimelineAppCollection','TimelinePlacesSubCollection','ProfileOverviewSection','csx','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s,t=820;r=babelHelpers.inherits(u,m);s=r&&r.prototype;function u(v){'use strict';s.constructor.call(this,v);this.$TimelinePlacesCollection1=v.token;this.$TimelinePlacesCollection2=null;this.$TimelinePlacesCollection3=null;this.$TimelinePlacesCollection4=[];this.$TimelinePlacesCollection5=null;this.$TimelinePlacesCollection6=null;}u.prototype.show=function(){'use strict';this.$TimelinePlacesCollection2&&h.show(this.$TimelinePlacesCollection2);};u.prototype.hide=function(){'use strict';this.$TimelinePlacesCollection2&&h.hide(this.$TimelinePlacesCollection2);};u.prototype.setActiveSubCollection=function(v){'use strict';this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.hide();this.$TimelinePlacesCollection3=v;this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.show();};u.prototype.getSubCollectionWithID=function(v){'use strict';if(0<=v&&this.$TimelinePlacesCollection4&&v<this.$TimelinePlacesCollection4.length)return this.$TimelinePlacesCollection4[v];return null;};u.prototype.getMapInstanceID=function(){'use strict';return this.$TimelinePlacesCollection6;};u.prototype.getActiveSubCollection=function(){'use strict';return this.$TimelinePlacesCollection3;};u.prototype.$TimelinePlacesCollection7=function(v){'use strict';if(!v)throw new Error("Don't provide enough information to register sub-collections.");this.$TimelinePlacesCollection8(v);};u.prototype.$TimelinePlacesCollection9=function(v){'use strict';if(!v.sub_collections_filter)throw Error("No sub-collection filter is specified.");if(v.map_instance_id==null)throw Error('No instance id of the map is specified.');this.$TimelinePlacesCollection6=v.map_instance_id;this.$TimelinePlacesCollection8({filter:v.sub_collections_filter});};u.prototype.$TimelinePlacesCollection8=function(v){'use strict';this.$TimelinePlacesCollection5=babelHelpers._extends({},this.$TimelinePlacesCollection5,v);var w=this.$TimelinePlacesCollection5;if(!w.sub_collections||!w.sub_collections.length||!w.filter||!this.$TimelinePlacesCollection1||w.profile_id==null||!w.more_popover_menu||!w.more_menu)return;for(var x=0;x<w.sub_collections.length;x++){var y=null,z=w.sub_collections[x].city_id;if(z&&w.filter[z])y=n.build(this.$TimelinePlacesCollection4.length,this,w.sub_collections[x],this.$TimelinePlacesCollection1,w.profile_id,w.filter[z],z);if(y)this.$TimelinePlacesCollection4.push(y);}if(this.$TimelinePlacesCollection4.length){this.$TimelinePlacesCollection10(this.$TimelinePlacesCollection4,w.more_popover_menu,w.more_menu);setTimeout((function(){this.setActiveSubCollection(this.$TimelinePlacesCollection4[0]);}).bind(this),2000);}};u.prototype.$TimelinePlacesCollection10=function(v,w,x){'use strict';var y=k.find(this.getParentSection().getNode(),"._33hy");if(!y)return;var z=i.create('div',{className:"_33hy"});i.replace(y,z);this.$TimelinePlacesCollection2=z;this.$TimelinePlacesCollection11(z,v,w,x);};u.prototype.$TimelinePlacesCollection11=function(v,w,x,y){'use strict';var z=0;for(var aa=0;aa<w.length;aa++)if(w[aa].getSubTabNode()){i.appendContent(v,w[aa].getSubTabNode());z+=j.getElementDimensions(w[aa].getSubTabNode()).width;}i.appendContent(v,x);z+=j.getElementDimensions(x).width;if(z<=t){h.hide(x);}else{var ba=w.length-1;while(z>t){if(ba<0)return;z-=j.getElementDimensions(w[ba].getSubTabNode()).width;i.remove(w[ba].getSubTabNode());var ca=new l({markup:w[ba].getSubTabNode()});if(y.getItemAt(0)){y.addItemBefore(ca,y.getItemAt(0));}else y.addItem(ca);ba--;}}};u.registerSubCollections=function(v){'use strict';this.checkCollectionID(v.collection_id);o.callWithSection(v.collection_id,function(w){if(w)w.$TimelinePlacesCollection7(v);});};u.registerSubCollectionsFilter=function(v){'use strict';this.checkCollectionID(v.collection_id);o.callWithSection(v.collection_id,function(w){if(w)w.$TimelinePlacesCollection9(v);});};u.checkCollectionID=function(v){'use strict';if(v==null)throw new Error("No collection id is specified when trying to access"+" a static function in TimelinePlacesCollection.");};f.exports=u;},null);
__d('TimelineAppCollectionFactory',['TimelineAppCollection','TimelinePlacesCollection'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j='map';function k(){'use strict';}k.createFromArray=function(l,m){'use strict';return m.map(function(n){if(l===j)return new i(n);return new h(n);});};f.exports=k;},null);
__d('TimelineMonitor',['Arbiter','Event','Run','Vector','ViewportBounds','ge','queryThenMutateDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o={},p={},q=0,r=[],s=null,t=false;function u(){o={};p={};q=0;r.length=0;s&&s.remove();s=null;t=false;}function v(){if(!s)s=i.listen(window,'scroll',aa);if(!t){j.onLeave(u);t=true;}aa();}var w=[],x=[];function y(){r.forEach(function(fa){var ga=ba.getSection(fa);if(ga&&ga!==p[fa.id]){p[fa.id]=ga;w.push({section:ga});}});var ca=l.getTop()+k.getScrollPosition().y;for(var da in o){var ea=o[da];if(ca>=ea.boundary&&q<=ea.boundary||ca<=ea.boundary&&q>=ea.boundary){o[da].fromAbove=q<ca;x.push(o[da]);}}q=ca;}function z(){w.forEach(function(ca){h.inform(ba.SECTION_CHANGE,ca);});x.forEach(function(ca){h.inform(ba.BOUNDARY_PASSED,ca);});w.length=0;x.length=0;}function aa(){n(y,z,'TimelineMonitor/scroll');}var ba={BOUNDARY_PASSED:'TimelineMonitor/boundary',SECTION_CHANGE:'TimelineMonitor/change',getSection:function(ca){var da=l.getTop()+k.getScrollPosition().y,ea=ca.childSections.getHead();while(ea){if(m(ea.nodeID)&&da<k.getElementPosition(ea.getNode()).y+k.getElementDimensions(ea.getNode()).y)return ea;ea=ea.getNext();}},monitorBoundary:function(ca,da){da=da||ca;if(!o[da]||o[da].boundary!==ca){o[da]={boundary:ca,id:da};v();}},monitorSection:function(ca){p[ca.id]=null;r.push(ca);v();return ba.getSection(ca);},poke:function(ca){aa();}};f.exports=ba;},null);
__d('TimelineAppSection',['AppSectionCurationState','Arbiter','CSS','DOM','DOMQuery','DOMScroll','JSLogger','ProfileOverviewDOMID','MedleyPageletRequestData','PageletSet','Style','TidyArbiter','TidyArbiterMixin','TimelineAppCollectionFactory','TimelineAppSectionCuration','TimelineDynamicSection','TimelineMonitor','ProfileOverviewSection','TimelineSmartInsert','TriggerablePageletLoader','ViewportBounds','csx','cx','ge','fbt','mixin','classWithMixins'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){if(c.__markCompiled)c.__markCompiled();var ia,ja,ka=500,la=2,ma=500,na=18,oa="_5bry",pa="_3s-",qa=k.create('div',{className:"_3s_"});function ra(){return k.create('span',{className:"_3s18"},[k.create('a',{className:"_3s19",href:'#'},fa._("More")),k.create('span',{className:"_3s1a"})]);}var sa=n.create('collections'),ta={notes:295,events:345,photos:555,app_quoraapp:569,fitness:619,friends:603,app_foodspotting:621,map:621,favorites:645,app_pinterestapp:699,app_instapp:699,books:699,movies:699,tv:699,music:725};function ua(wa){return ta[wa.replace(o.PREFIX_MEDLEY,'')];}ia=babelHelpers.inherits(va,ha(w,ga(t)));ja=ia&&ia.prototype;function va(wa,xa,ya,za){'use strict';ja.constructor.call(this,va.getIDBySK(xa),wa,ya);this._sk=xa;this._title=za;}va.prototype._createNode=function(){'use strict';var wa=ja._createNode.call(this);wa.setAttribute('aria-labelledby',o.PREFIX_MEDLEY_HEADER+this._sk);wa.setAttribute('aria-role','region');k.prependContent(wa,k.create('div',{className:"_3cz"},[this._title,k.create('div',{className:"_3dc",'aria-role':'tablist'})]));this.resetMinHeight(wa);return wa;};va.prototype.addAuxContent=function(wa){'use strict';var xa=l.scry(this.getNode(),"._6ph")[0];xa&&k.appendContent(xa,wa);this._activeCollection&&this._checkTabDimensions(this._activeCollection);};va.prototype.nullStateCurationContent=function(){'use strict';if(!this._nullStateContent)return;var wa=l.find(this.getNode(),"._1_cb");k.replace(wa.firstChild,this._nullStateContent);};va.prototype.addCurationContent=function(wa,xa,ya,za){'use strict';za=za?za:0;var ab=l.scry(this.getNode(),"._1_cb"),bb=za<ab.length?ab[za]:null;bb&&k.appendContent(bb,wa);if(ya)this._nullStateContent=ya;this.checkCurationContent(xa);};va.prototype.createTriggerLoader=function(wa){'use strict';var xa=(function(ya){this._parentSection._lastLoadedSection=this;this.setIsLoaded(true);z.enable();z.run(this.getNode(),(function(){ya();this.unsetMinHeight();x.poke(this._parentSection.id);}).bind(this),'viewport');}).bind(this);s.subscribe('Medley/requestDataSet',(function(){this._triggerLoader=new aa({controller:this._controller,data:this.getData(),displayCallback:xa,options:{constHeight:true},node:this.getNode()},[{node:this.getNode(),onVisibleBuffer:ka,onVisibleStrict:true,type:wa?aa.TRIGGER_NOW:aa.TRIGGER_ONVISIBLE}]);}).bind(this));};va.prototype.freeze=function(){'use strict';j.addClass(this.getNode(),"_c4e");if(ea(this.nodeID)&&!this.isLoaded())this._triggerLoader&&this._triggerLoader.disableTriggers();this.freezeChildren();};va.prototype.getData=function(){'use strict';if(!this._data)this._data=babelHelpers._extends({sk:this._sk},p.get(),{overview:!this.isActiveAppSection()});return this._data;};va.prototype.isActiveAppSection=function(){'use strict';return this._parentSection._sk===this._sk;};va.prototype.getActiveCollection=function(){'use strict';return this._activeCollection;};va.prototype.remove=function(){'use strict';if(q.hasPagelet(this.id))q.removePagelet(this.id);k.remove(this.getNode());this._parentSection.removeChildSection(this.id);};va.prototype.setActiveCollection=function(wa){'use strict';if(this._activeCollection===wa||!wa._tabNode)return;if(this._activeCollection){i.inform('TimelineSideAds/refresh');sa.log('change_collection',{previous_collection:this._activeCollection.getToken(),new_collection:wa.getToken()});this.hideCollection(this._activeCollection);var xa=k.scry(this._activeCollection._tabNode,"div._3s_"),ya=qa;if(xa.length>0)ya=xa[0];k.appendContent(wa._tabNode,ya.cloneNode(true));xa.forEach(k.remove);}this._activeCollection=wa;this.showCollection(this._activeCollection);};va.prototype.hideCollection=function(wa){'use strict';if(wa){if(wa.getRootClass())j.removeClass(this.getNode(),wa.getRootClass());this.resetMinHeight();wa.disableContentLoader();j.hide(wa.getNode());j.removeClass(wa._tabNode,pa);wa.auxContent&&j.hide(wa.auxContent);wa.curationContent&&j.hide(wa.curationContent);wa._tabNode.setAttribute('aria-selected','false');}};va.prototype.showCollection=function(wa){'use strict';if(wa.getRootClass())j.addClass(this.getNode(),wa.getRootClass());wa.auxContent&&j.show(wa.auxContent);this.checkCurationContent(wa);j.addClass(wa._tabNode,pa);this._checkTabDimensions(wa);va.inform('changeCollection');if(!ea(wa.nodeID))k.appendContent(l.find(this.getNode(),"div._3i9"),wa.getNode());j.show(wa.getNode());wa.isLoaded()&&this.unsetMinHeight();wa._tabNode.setAttribute('aria-selected','true');wa.enableContentLoader();var xa=va.getIDBySK(this._sk),ya=v.getSectionState(xa);if(ya)v.refreshState(ya,xa);};va.prototype.resetMinHeight=function(wa){'use strict';wa||(wa=this.getNode());var xa=ua(this.id)||wa.offsetHeight-la;xa>0&&this._updateScrollAfterHeight(wa,xa);};va.prototype.scrollTo=function(wa,xa){'use strict';var ya=ba.getElementPosition(this.getNode());ya.y-=wa||na;xa&&this._parentSection.toggleScrollLoad(false);m.scrollTo(ya,ma,null,null,0,(function(){ya=ba.getElementPosition(this.getNode());ya.y-=wa||na;m.scrollTo(ya);xa&&this._parentSection.toggleScrollLoad(true);}).bind(this));};va.prototype.thaw=function(){'use strict';j.removeClass(this.getNode(),"_c4e");this._triggerLoader&&this._triggerLoader.enableTriggers();this.thawChildren();};va.prototype.unsetMinHeight=function(){'use strict';this._updateScrollAfterHeight(this.getNode(),0);};va.prototype._updateScrollAfterHeight=function(wa,xa){'use strict';r.set(wa,'min-height',xa+'px');i.inform('reflow');};va.prototype.checkCurationContent=function(wa){'use strict';var xa=l.scry(this.getNode(),"._2zh3")[0];if(xa){j.conditionShow(xa,wa.curationContent);if(wa.curationContent){j.show(wa.curationContent);if(wa.curationContentState&&wa===this._activeCollection)v.informState(wa.curationContentState,this.id,wa.getToken(),wa.curationContentState!=h.hide);}else v.informState(h.hide,this.id,wa.getToken(),true);}};va.prototype._getTabObj=function(){'use strict';if(!this._tabObj){this._tabObj={aux:k.find(this.getNode(),"._6ph"),items:[],nav:k.find(this.getNode(),"._1_ca"),tabs:k.find(this.getNode(),"._3dc"),width:0};j.addClass(this._tabObj.tabs,"_5brz");}return this._tabObj;};va.prototype._checkTabDimensions=function(wa){'use strict';var xa=this._getTabObj(),ya=xa.nav.offsetWidth-xa.aux.offsetWidth;if(ya>=xa.width){if(!xa.hidden&&ya-xa.tabs.offsetWidth>=0)return;j.removeClass(xa.tabs,oa);}if(xa.hidden&&wa._tabNode.parentNode===xa.overflow){k.prependContent(xa.overflow,xa.dropdown.previousSibling);k.insertBefore(xa.dropdown,wa._tabNode);}if(ya-xa.tabs.offsetWidth>=0&&!xa.hidden)return;var za=xa.items.length;if(za&&xa.hidden){for(var ab=0;ab<za;ab++)k.appendContent(xa.tabs,xa.items[ab]);k.remove(xa.dropdown);}j.conditionClass(xa.tabs,oa,ya-xa.tabs.offsetWidth<0);xa.width=ya;xa.hidden=0;if(ya-xa.tabs.offsetWidth>=0)return;if(!xa.dropdown){xa.dropdown=ra();xa.overflow=k.find(xa.dropdown,"._3s1a");xa.items=k.scry(this.getNode(),"._3c_");za=xa.items.length;}k.appendContent(xa.tabs,xa.dropdown);var bb=0;for(ab=za-1;ab>0&&bb<=0;ab--)if(xa.items[ab]!==wa._tabNode){k.prependContent(xa.overflow,xa.items[ab]);bb=ya-xa.tabs.offsetWidth;xa.hidden++;}};va.createFromArray=function(wa){'use strict';return wa.map(function(xa){return new va(xa.controller,xa.sk,xa.label,xa.title);});};va.getIDBySK=function(wa){'use strict';return o.PREFIX_MEDLEY+wa;};va.registerCollections=function(wa,xa,ya){'use strict';y.callWithSection(va.getIDBySK(wa),function(za){za._tabObj=null;if(za.childSections){var ab=za.childSections.getHead();while(ab){ab._resetAuxContent();ab=ab.getNext();}}u.createFromArray(wa,xa).forEach(za.appendSection,za);var bb=za.childSections.get(ya);za.setActiveCollection(bb);bb.setIsLoaded(true);});};va.removeEmptyAppSection=function(wa){'use strict';y.callWithSection(va.getIDBySK(wa),function(xa){xa.remove();});};Object.assign(va,t);f.exports=va;},null);
__d('TimelinePlacesSection',['TimelineAppSection','TimelinePlacesCollection'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;j=babelHelpers.inherits(l,h);k=j&&j.prototype;function l(m,n,o,p){'use strict';k.constructor.call(this,m,n,o,p);}l.prototype.hideCollection=function(m){'use strict';k.hideCollection.call(this,m);if(m instanceof i)m.hide();};l.prototype.showCollection=function(m){'use strict';k.showCollection.call(this,m);if(m instanceof i)m.show();};f.exports=l;},null);
__d('TimelineAppSectionFactory',['TimelineAppSection','TimelinePlacesSection'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j="map";function k(){'use strict';}k.createFromArray=function(l){'use strict';return l.map(function(m){if(m.sk===j)return new i(m.controller,m.sk,m.label,m.title);return new h(m.controller,m.sk,m.label,m.title);});};f.exports=k;},null);
__d('TimelineMedley',['Arbiter','CSS','DOM','DOMQuery','ProfileOverviewDOMID','PageTransitions','ProfileTabUtils','TimelineAppSection','TimelineAppSectionFactory','TimelineMonitor','ProfileOverviewSection','TimelineURI','URI','ViewportBounds','$','csx','cx','ge','getElementPosition'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){if(c.__markCompiled)c.__markCompiled();var aa,ba,ca=2,da=false;aa=babelHelpers.inherits(ea,r);ba=aa&&aa.prototype;function ea(fa,ga,ha){'use strict';ba.constructor.call(this,l.MEDLEY_ROOT);this._sectionBreaker=ha.breaker;p.createFromArray(fa).forEach(this.appendSection,this);q.monitorSection(this);this._lastLoadedSection=this.childSections.get(o.getIDBySK(ga)).setIsLoaded(true);r.setActiveSectionID(this._lastLoadedSection.id);if(da&&this.isOverviewProfileTab())this.addSectionPlaceholders();var ia=t.getNextURI();this._vanity=s.getVanityFromURI(ia);this._sk=s.getTabKeyFromURI(ia);m.registerHandler(this._transitionHandler.bind(this));}ea.prototype.addSectionTeasers=function(){'use strict';if(!this.isOverviewProfileTab()){i.removeClass(this.getNode(),"_c4f");this.thawChildren();this.addSectionPlaceholders();this.addSectionBreak();}};ea.prototype.addUpcomingSectionPlaceholders=function(fa,ga){'use strict';ga=ga||ca;while(fa=fa.getNext())if(!this.addSectionPlaceholder(fa,fa.getPrev())&&--ga<=0)break;};ea.prototype.addSectionPlaceholder=function(fa,ga,ha){'use strict';if(!fa.isLoaded()&&y(fa.nodeID))return false;if(!y(fa.nodeID)){j.insertAfter(ga.getNode(),fa.getNode());fa.createTriggerLoader(ha);return false;}return true;};ea.prototype.addSectionBreak=function(){'use strict';if(this._lastLoadedSection.getNext()){j.insertAfter(this.childSections.getHead().getNode(),this._sectionBreaker);}else j.remove(this._sectionBreaker);};ea.prototype.removeChildSection=function(fa){'use strict';this.childSections.remove(fa);if(this.childSections.getCount()==1)j.remove(this._sectionBreaker);};ea.prototype.addSectionPlaceholders=function(){'use strict';this.addUpcomingSectionPlaceholders(this._lastLoadedSection);};ea.prototype.getNode=function(){'use strict';return v(this.id);};ea.prototype.isOverviewProfileTab=function(){'use strict';return n.isOverviewTab(this._sk);};ea.prototype.toggleScrollLoad=function(fa){'use strict';da=fa;if(fa){this.thawChildren();this.addSectionPlaceholders();}else this.freezeChildren();};ea.prototype._transitionHandler=function(fa){'use strict';if(s.getVanityFromURI(fa)!==this._vanity)return false;var ga=s.getTabKeyFromURI(fa);if(n.isTimelineTab(ga))return false;if(n.isOverviewTab(ga)){return false;}else{var ha=fa.getQueryData();if(!ha.next_cursor)return false;var ia=this.childSections.getHead();while(ia){if(ia._sk===ga){if(!ia._activeCollection||!k.scry(ia._activeCollection.getNode(),"._3t3")[0])return false;h.inform("save_facebar_query",true);setTimeout(this._transitionToSection.bind(this,ia,ha),0);return true;}ia=ia.getNext();}}return false;};ea.prototype._transitionToSection=function(fa,ga){'use strict';var ha=z(fa.getNode()).y-u.getTop();j.scry(fa.getNode(),"._51k9").forEach(function(ka){i.removeClass(ka,"_51k9");});this._sk=fa._sk;r.setActiveSectionID(fa.id);fa.thaw();i.addClass(this.getNode(),"_c4f");this.freezeChildren();var ia=k.find(fa._activeCollection.getNode(),"._3t3");fa._activeCollection.addContentLoader(ia,ga.next_cursor);fa._activeCollection._contentLoader.load({node:ia});var ja=this.childSections.getHead();while(ja&&ja.id!==fa.id){ja.remove();ja=this.childSections.getHead();}r.inform('Medley/transitionToSection',fa.id);fa.scrollTo(ha<0?ha:0);m.transitionComplete();};ea.loadToSection=function(fa,ga){'use strict';r.setActiveSectionID(fa);r.callWithSection(l.MEDLEY_ROOT,function(ha){var ia=ha.childSections.getHead(),ja=0;while(ia&&ia.id!==fa){ja++;ia=ia.getNext();}if(!ja)return ga(ia);ja--;ja&&ha.addUpcomingSectionPlaceholders(ha.childSections.getHead(),ja);ha.addSectionPlaceholder(ia,ia.getPrev(),true);var ka=ia.subscribe('loaded',function(){ga(ia);ka.unsubscribe();});});};ea.scrollToSection=function(fa,ga,ha){'use strict';r.callWithSection(fa,function(ia){ia.scrollTo(ga,ha);});};ea.toggleScrollLoad=function(fa){'use strict';da=fa;r.callWithSection(l.MEDLEY_ROOT,function(ga){ga.toggleScrollLoad(fa);});};f.exports=ea;},null);
__d('PhotosAppSection',['TimelineAppSection','TimelineAppSectionCuration','TidyArbiterMixin'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=babelHelpers._extends({init:function(l){var m=h.getIDBySK(l);i.subscribe('toggle_drawer',function(n,o){if(o.section.id===m)k.inform('toggle_drawer',o);});}},j);f.exports=k;},null);
__d('PhotoCreateButtonsVisibility',['Arbiter','CSS','csx','cx','DOMQuery','Event','Parent','$'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(r){var s=n.byClass(r,"_3cz");return l.find(s,"._69l");}var q={addHideClickListener:function(r){m.listen(r,'click',function(){i.hide(p(r));});},addShowClickListener:function(r){m.listen(r,'click',function(){i.show(p(r));});},hideButtons:function(r){var s=o('pagelet_timeline_medley_photos');i.hide(l.find(s,"._69l"));},showButtonOnTabChange:function(r){h.subscribe('Medley/tab-change',function(s){i.show(r);});}};f.exports=q;},null);