/*!CK:282535058!*//*1443066768,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/aCUp"]); }

__d('P2PSendMoneyButtonImpl.react',['CurrentEnvironment','ImmutableObject','P2PAbstractSendMoneyButton.react','P2PActions','P2PErrorDialog.react','P2PGroupSendDialog.react','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSendMoneyDialog.react','P2PSendMoneySuccessDialog.react','P2PTransferParam','P2PTransferStore','P2PTransferRiskResult','P2PUnderManualReviewDialog.react','P2PUserEligibilityStore','P2PVerificationFlowHelper','React','ReactDOM','ReactLayeredComponentMixin','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){'use strict';if(c.__markCompiled)c.__markCompiled();var ca=x.PropTypes,da=x.createClass({displayName:'P2PSendMoneyButtonImpl',mixins:[z],propTypes:{amount:ca.string,groupThreadFBID:ca.string,flyoutAlignment:ca.string,isNewEmptyLocalThread:ca.bool,isGroupChat:ca.bool,onTrigger:ca.func,participants:ca.arrayOf(ca.object).isRequired,platformData:ca.object,sendMoneyDialogShown:ca.bool,threadID:ca.string,threadFBID:ca.string},getDefaultProps:function(){return {amount:'',groupThreadFBID:'',onTrigger:aa,sendMoneyDialogShown:false};},getInitialState:function(){return {participants:this.props.participants};},componentDidMount:function(){this.userEligibilityStoreSub=v.addListener('change',this.onUserEligibilityChange);this.setEligibilityState();},componentWillUnmount:function(){if(this.userEligibilityStoreSub){this.userEligibilityStoreSub.remove();this.userEligibilityStoreSub=null;}},componentWillReceiveProps:function(ea){if(ea.participants.length!==this.props.participants.length||ea.threadID!==this.props.threadID)this.setState({participants:ea.participants},(function(){this.setEligibilityState();}).bind(this));},setEligibilityState:function(){var ea,fa,ga=this.state.participants;if(!ga.length)return;ea=ga.map(function(ia){return ia.userID;});fa=v.getEligibilityByUserIDs(ea);for(var ha=0;ha<ga.length;ha++)ga[ha]=i.set(ga[ha],{p2p_eligible:fa[ga[ha].userID]});this.setState({participants:ga});},onUserEligibilityChange:function(){this.setEligibilityState();},canShowSendMoneyDialog:function(){if(!this.state.participants.length)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){k.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){k.chatSendViewOpened({threadID:this.props.threadID});},_handleDialogToggle:function(ea){if(!ea){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handleOnSendSuccess:function(ea){this.hideSendMoneyDialog();var fa=ea[r.RISK_RESULT];this.originalCreateTransactionResponse=ea;if(fa===t.REQUIRE_VERIFICATION){w.startVerificationFlow(ea.id,true,this.handlePostSendSteps);}else if(fa===t.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps();},handlePostSendSteps:function(){var ea=this.originalCreateTransactionResponse,fa=ea.passwordProtection===o.NOT_SET;if(ea.isFirstSend){this._passwordNUXPending=fa;this.showSendSuccessDialog();}else if(fa){this.showPasswordProtectionDialog();}else k.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else k.hideDialog();},handleSendError:function(ea){this.showErrorDialog(ea);},getMoneyButtonNode:function(){return y.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat){return this.state.participants[0];}else return this.props.groupSendRecipient;},isRecipientEligible:function(){var ea=this.getRecipient();if(!ea)return false;return !!(ea.p2p_eligible||s.hasReceivedFromSender(ea.userID));},showErrorDialog:function(ea){var fa=ba._("Problem Sending Money");k.showDialog(l,{error:ea,onOKClick:k.hideDialog,title:fa});},showPasswordProtectionDialog:function(){k.showDialog(n,{onComplete:k.hideDialog});},showSendSuccessDialog:function(){k.showDialog(q,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){k.showDialog(u,{onClose:this.handlePostSendSteps});},renderLayers:function(){var ea={},fa='USD',ga='$';if(this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown)if(!this.props.groupSendRecipient&&this.props.isGroupChat&&this.props.threadFBID){ea.groupSendMoneyDialog=x.createElement(m,{amount:this.props.amount,context:this.getMoneyButtonNode(),flyoutAlignment:this.props.flyoutAlignment,currency:fa,onToggle:this._handleDialogToggle,participants:this.state.participants,threadID:this.props.threadID,threadFBID:this.props.threadFBID});}else ea.sendMoneyDialog=x.createElement(p,{amount:this.props.amount,context:this.getMoneyButtonNode(),currency:fa,currencySymbol:ga,groupThreadFBID:this.props.groupThreadFBID,flyoutAlignment:this.props.flyoutAlignment,onToggle:this._handleDialogToggle,onError:this.handleSendError,onSendSuccess:this.handleOnSendSuccess,platformData:this.props.platformData,receiver:this.getRecipient(),ref:'send_money_dialog'});return ea;},render:function(){var ea=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.state.participants.length>1)return null;return (x.createElement(j,{isDialogOpen:this.canShowSendMoneyDialog()&&this.props.sendMoneyDialogShown,isDisabled:!!(ea&&!this.isRecipientEligible()),isMessenger:!!h.messengerdotcom,onClick:this._onButtonClick,recipientName:ea&&ea.short_name,ref:'p2pSendMoneyButton'}));}});f.exports=da;},null);