/*!CK:3129261335!*//*1443409737,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["BRvhT"]); }

__d("SpotlightViewerLoggingEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null,{});
__d("XPhotosetSearchPivotController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null,{});
__d('PhotosetSearchPivotData',['AsyncRequest','PhotoStreamCache','Promise','XPhotosetSearchPivotController'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=/^(perm:)?tag:(\d+)/,m={},n={fetch:function(o,p){if(!(o in m)){var q=k.getURIBuilder().setInt('fbid',o);if(p){var r={};p.fbidList.forEach(function(s){var t=p.getCacheContent(s,i.EXTRA);if(t)Object.keys(t.tagRects).forEach(function(u){if(l.test(u)){var v=RegExp.$2;if(v in r){r[v]++;}else r[v]=1;}});});q.setIntToIntMap('tags',r);}m[o]=new j(function(s,t){new h().setURI(q.getURI()).setHandler(function(u){s(u.getPayload());}).setErrorHandler(t).setAllowCrossPageTransition(true).send();});}return m[o]['catch'](function(s){delete m[o];throw s;});}};f.exports=n;},null);
__d('tickerPhoteSnowLiftOpenStatus',['ArbiterMixin'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='CheckIsOpen',j={registerOpenChecker:function(k){return j.subscribe(i,function(l,m){if(k())m.is_Open=true;});},checkIsOpen:function(){var k={is_Open:false};j.inform(i,k);return k.is_Open;}};Object.assign(j,h);f.exports=j;},null);
__d('PhotoLogger',['Event','BanzaiScuba','SpotlightViewerLoggingEvents','SubscriptionsHandler'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m){'use strict';this.$PhotoLogger1=m;this.$PhotoLogger2={};}l.prototype.log=function(m){'use strict';if(!this.$PhotoLogger2[m]){this.$PhotoLogger3(m);this.$PhotoLogger2[m]=true;}};l.prototype.$PhotoLogger3=function(m){'use strict';this.$PhotoLogger4(j.LOADING,{uri:m});var n=new k(),o=new Image();n.addSubscriptions(h.listen(o,'load',(function(){this.$PhotoLogger4(j.LOADED,{uri:m});n.release();}).bind(this)),h.listen(o,'error',(function(){this.$PhotoLogger4(j.ERROR,{uri:m});n.release();}).bind(this)),h.listen(o,'abort',(function(){this.$PhotoLogger4(j.ABORT,{uri:m});n.release();}).bind(this)));o.src=m;};l.prototype.logEvent=function(m){'use strict';this.$PhotoLogger4(m);};l.prototype.$PhotoLogger4=function(m,n){'use strict';var o=new i('photos_client_loading',null,{addBrowserFields:true});o.addNormal('event',m);o.addNormal('viewer',this.$PhotoLogger1);for(var p in n)o.addNormal(p,n[p]);o.post();};f.exports=l;},null);
__d('PhotosetSearchPivot.react',['LeftRight.react','PhotoTagSearchPivotLogger','PhotosetSearchPivotData','React','XUISpinner.react','XUIText.react','cx','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q=k.PropTypes,r=k.createClass({displayName:'PhotosetSearchPivotItem',propTypes:{normalized:q.string,title:q.object,uri:q.string,images:q.array},onClick:function(){i.logMorePhotosNavigation(this.props.normalized);},render:function(){return (k.createElement('div',{className:"_25r"},k.createElement('a',{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},k.createElement('div',{className:"_25u"},k.createElement('div',{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),k.createElement('div',{className:"_25x"},k.createElement('div',{className:"_25y"},k.createElement('div',{className:"_25z"}),k.createElement('div',{className:"_26r"},k.createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),k.createElement('div',{className:"_274"},k.createElement('div',{className:"_25z"}),k.createElement('div',{className:"_26r"},k.createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),k.createElement(m,{display:'block',className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),s=k.createClass({displayName:'PhotosetSearchPivot',propTypes:{fbid:q.string,endofalbum:q.bool,withBackground:q.bool,linesAroundHeader:q.bool,onclose:q.func},fetchPivots:function(t){j.fetch(t).then((function(u){setTimeout(this.onFetchSuccess.bind(this,t,u.pivots),0);}).bind(this),(function(u){setTimeout(this.onFetchError.bind(this,t),0);}).bind(this));},onFetchSuccess:function(t,u){if(!this.isMounted()||this.props.fbid!==t)return;u=u||[];var v='show';if(u.length===0)v='hide';this.setState({pivots:u,action:v});},onFetchError:function(t){if(!this.isMounted()||this.props.fbid!==t)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(t){if(t.fbid){this.setState({action:'loading'});this.fetchPivots(t.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (k.createElement('div',{className:p(this.props.className,"_27h _2ph_")},k.createElement(l,{size:'large'})));if(this.state.action==='hide')return k.createElement('span',null);var t=this.state.pivots.map(function(x){return (k.createElement(r,{normalized:x.normalized,title:x.title,uri:x.uri,images:x.images}));}),u=this.props.endofalbum?k.createElement('span',{className:"_2pij"},o._("End of album")):null,v="_27m"+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":''),w=k.createElement('span',null,u,k.createElement('span',{className:"_4ptz"},o._("Other photos you may like")));if(this.props.onclose){w=k.createElement(h,{className:v},w,k.createElement('a',{href:'#',onClick:this.onExitClicked,className:"_27n"}));}else w=k.createElement('div',{className:v},w);return (k.createElement('div',{className:p(this.props.className,(this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":''))},k.createElement('div',{className:"_27l"+(this.props.withBackground?' '+"_3-tf":'')},w,k.createElement('div',{className:"_27o _2pi8 clearfix"},t))));}});f.exports=s;},null);
__d('PhotosetPivotSlide.react',['Image.react','Link.react','PhotosetSearchPivot.react','React','XUIText.react','cx','fbt','xuiglyph'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=k.PropTypes,q=k.createClass({displayName:'PhotosetPivotSlide',propTypes:{fbid:p.string,isAlbum:p.bool,albumOwnerName:p.string,visible:p.bool,onReturn:p.func},render:function(){return (k.createElement('div',{className:"_1_ap"+(this.props.visible?' '+"_1_aq":'')},k.createElement('div',{className:"_1_ar"},k.createElement(l,{display:'block'},this._getEndOfAlbumTitle()),k.createElement(i,{className:"_1_as",onClick:this.props.onReturn},k.createElement(h,{className:"_1_at",src:o({name:'arrow-right',shade:'white',size:'small'})}),n._("Return to Beginning"))),k.createElement(j,{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return n._("End of {user_name}'s album",[n.param('user_name',k.createElement(l,{weight:'bold'},this.props.albumOwnerName))]);}else return n._("End of {user_name}'s photos",[n.param('user_name',k.createElement(l,{weight:'bold'},this.props.albumOwnerName))]);}else if(this.props.isAlbum){return n._("End of album");}else return n._("End of photos");}});f.exports=q;},null);
__d('PhotoSnowliftAds',['Arbiter','Event','CSS','csx','DataStore','DOM','PhotoSessionLog','UIPagelet','URI','Vector'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(s,t){if(t)this.adsStatus=s;var u=Date.now();this.adsEvents[s+'_'+u]=u;},init:function(s,t,u,v){this.reset();this.root=s;this.snowlift=t;this.minAds=u.min_ads;this.displayedCallback=v;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(s){this.availableDimensions=s;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(s,t,u){var v={};s.forEach((function(w){var x=w.root.firstChild.offsetHeight;w.units.forEach((function(z){if(!j.hasClass(z,'hidden')&&!this.getIsHoldout(z)&&!this.getIsShadow(z)){var aa=this.getHeight(z.firstChild,t);x-=aa;}}).bind(this));var y={height:x,visible:false};w.units.forEach((function(z){var aa=this.getIsAds(z),ba=this.getHeight(z.firstChild,t),ca=this.getUnitId(z),da=this.getIsHoldout(z);if(da&&u)return;v[ca]={height:ba,visible:false,priority:0,is_ads:aa,is_holdout:da,section_ref:y};}).bind(this));}).bind(this));return v;},calculateVisibleUnits:function(s,t,u){var v=0,w=this.getUnitPriority(t);w.forEach((function(x){if(t.hasOwnProperty(x)){var y=t[x],z=y.height;if(!y.section_ref.visible)z+=y.section_ref.height;y.height_below=u-z;y.visible=y.height_below>=0&&z>0;if(y.visible){y.section_ref.visible=true;u-=z;v++;}}}).bind(this));return t;},displayUnits:function(s,t){s.forEach((function(u){var v=false,w=true;u.units.forEach((function(x){var y=this.getUnitId(x),z=t[y];if(!z)return;var aa=z.visible,ba=z.height_below,ca=z.is_ads;j.conditionClass(x,'hidden',!aa);if(ca&&aa&&w){var da=m.find(x,'div.ego_unit');j.addClass(da,'ego_unit_no_top_border');w=false;}v=v||aa;this.calcUnitStats(this.units[ca][y],aa,ba);}).bind(this));j.conditionClass(u.root,'hidden',!v);}).bind(this));h.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(s,t){var u=0;s.forEach((function(v){v.units.forEach((function(w){var x=this.getUnitId(w),y=t[x];if(!y||!y.visible)return;u++;}).bind(this));}).bind(this));return u;},getHeightsRequired:function(s,t){var u=0,v=[];s.forEach((function(w){var x=false;w.units.forEach((function(y){var z=this.getUnitId(y),aa=t[z];if(!aa)return;u+=aa.height;if(!x){u+=aa.section_ref.height;x=true;}v.push(u);}).bind(this));}).bind(this));return v;},getUnitPriority:function(s){var t=[],u=0,v=0;for(var w in s){var x=s[w];t.push(w);var y=this.minAds+u+v;if(x.is_ads){if(v<this.minAds)y=v;v++;}else u++;x.priority=y;}t=t.sort((function(z,aa){var ba=s[z],ca=s[aa];return ba.priority-ca.priority;}).bind(this));return t;},updateUnitsStatus:function(){var s=this.availableDimensions.x,t=this.availableDimensions.y,u=this.calculateUnitSizes(this.sections,s);u=this.calculateVisibleUnits(this.sections,u,t);for(var v in u){if(!u.hasOwnProperty(v))continue;var w=u[v];if(!w.is_holdout||!w.visible)continue;var x=this.units[1][v];this.calcUnitStats(x,w.visible,w.height_below);}u=this.calculateUnitSizes(this.sections,s,true);u=this.calculateVisibleUnits(this.sections,u,t);this.displayUnits(this.sections,u);if(this.displayedCallback){var y=this.getUnitsDisplayed(this.sections,u),z=this.getHeightsRequired(this.sections,u);this.displayedCallback(y,z);}},calcUnitStats:function(s,t,u){var v=Date.now();if(s.visible)s.totalTime+=v-s.lastShowTime;if(s.trackingCode!==null&&s.totalTime>=this.UNITS_REGISTER_DELAY){var w=s.trackingCode;s.trackingCode=null;this.registerImpression(w,s.registerUrl);}s.visible=t;s.heightBelow=u;s.lastShowTime=v;},prepareResize:function(){var s=function(t){var u=m.create('div',{className:'inner'}),v=m.create('div',{className:'wrapper'},u);m.replace(t,v);m.setContent(u,t);return v;};this.sections=m.scry(this.root,'div.ego_section').map(function(t){return {root:s(t),units:m.scry(t,'div.ego_unit').map(s)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var s=this.nextRegisterTime();if(s!==Infinity)setTimeout(this.processResize.bind(this),s);},setIsLogAdData:function(s){this.isLogAdData=s;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var s=this.snowlift.getImageId();if(this.isLogAdData&&s){var t=q.getElementDimensions(this.snowlift.getImage()),u=q.getElementDimensions(this.snowlift.getRHCHeader()),v=q.getElementDimensions(this.snowlift.getRHCBody()),w=q.getElementDimensions(this.snowlift.getRHCFooter()),x={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:t.x,image_y:t.y,header_x:u.x,header_y:u.y,body_x:v.x,body_y:v.y,footer_x:w.x,footer_y:w.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(s,x);}},getAdsBelowSpace:function(){var s=[],t=this.units[1];for(var u in t)if(t.hasOwnProperty(u)&&!this.getIsHoldout(this.getAdUnit(u)))s.push(t[u].heightBelow);return s;},getIsAds:function(s){var t=m.scry(s,"div._4u8");return t.length;},getUnitId:function(s){if(this.getIsAds(s)){return this.getAdId(s);}else return this.getEgoId(s);},getEgoId:function(s){var t=m.find(s,'div.ego_unit');return t.getAttribute('data-ego-fbid');},getAdData:function(s){var t=m.find(s,"div._4u8"),u=t.getAttribute('data-ad');return u&&JSON.parse(u)||{};},getAdId:function(s){return this.getAdData(s).adid;},getIsHoldout:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).holdout;},getIsShadow:function(s){return s&&this.getIsAds(s)&&this.getAdData(s).shadow;},getAdUnit:function(s){if(!this.sections)return null;var t=[];this.sections.forEach(function(v){t.push.apply(t,v.units);});for(var u=0;u<t.length;u++)if(this.getIsAds(t[u])&&this.getAdId(t[u])==s)return t[u];return null;},nextRegisterTime:function(){var s=Infinity,t=babelHelpers._extends({},this.units[0],this.units[1]);for(var u in t)if(t.hasOwnProperty(u)){var v=t[u];if(v.trackingCode!==null&&v.visible)s=Math.min(s,this.UNITS_REGISTER_DELAY-v.totalTime);}return s;},getHeight:function(s,t){var u=l.get(s,'height');if(u&&u.x===t)return u.y;return this.cacheHeight(s,t);},cacheHeight:function(s,t){var u={x:t,y:s.offsetHeight};l.set(s,'height',u);return u.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var s=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,s,false,this.snowlift.getOpaqueCursor(s)]},{crossPage:true,bundle:false});},getCursorFBID:function(s){if(s.v!==undefined)return s.v;if(s.fbid!==undefined)return s.fbid;return '0';},unitsLoaded:function(s,t){var u;if(t){u='/ai.php';this.addEvent('adsLoaded',true);}else{u='/ajax/ei.php';this.addEvent('egoLoaded',true);}var v={};for(var w in s)if(s.hasOwnProperty(w))v[w]={trackingCode:s[w],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:u};this.units[t]=v;if(t)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var s=Date.now()-this.lastLoadTime;if(!this.isLoading&&s>r.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(s,t){var u=m.create('iframe',{src:new p(t).addQueryData({aed:s}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});u.setAttribute('aria-hidden','true');m.appendContent(this.root,u);},waitForImages:function(s){var t=m.scry(this.root,'img.img'),u=t.length,v=u;if(v===0)s();var w=function(){v--;if(v===0)setTimeout(s,0);};for(var x=0;x<u;x++){var y=t[x];if(y.complete){w();}else i.listen(y,{load:w,error:w,abort:w});}}};f.exports=r;},null);
__d("SnowliftVideoPivotsCarouselController",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={setPivotsCarousel:function(i,j){this._pivotsCarousel=i;this.adjustCarousel(j);},adjustCarousel:function(i){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(i);},adjustCarouselOnAutoPlay:function(){if(this._pivotsCarousel)this._pivotsCarousel.page();}};f.exports=h;},null);
__d("XPhotosSnowliftProfilePicAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/profilepic\/",{uri:{type:"String",required:true}});},null,{});
__d('PhotoSnowlift',['Arbiter','AsyncRequest','Bootloader','CSS','DataStore','Dialog','DisplaySnowliftProfilePhotoNux','DOM','DOMQuery','DOMControl','Event','fbt','FullScreen','GraphicPhotoWarning','GraphicPhotoWarningMixin','ImageUtils','Input','Keys','Layer','LayerHideOnEscape','LikeConfirmer','LinkController','LitestandStoryInsertionStatus','tickerPhoteSnowLiftOpenStatus','Locale','PageTransitions','Parent','PhotoLogger','PhotoPermalinkURI','PhotosConst','PhotoSessionLog','PhotosetPivotSlide.react','PhotosetSearchPivot.react','PhotosetSearchPivotData','PhotoSnowliftAds','PhotoSnowliftActionsGating','PhotoStreamCache','PhotosUtils','PhotoTagSearchPivotLogger','PhotoViewer','ReactComponentRenderer','Rect','ScriptPath','ScrollableArea','SnowliftVideoPivotsCarouselController','XPhotosSnowliftProfilePicAsyncController','Style','Toggler','Tooltip','UFIFeedbackTargets','UIPagelet','UFIUIEvents','URI','UserAgent_DEPRECATED','Vector','VideoPermalinkURI','VideoPlayerReason','VideoPlayerAbortLoadingExperiment','$','arrayContains','classWithMixins','computeRelativeURI','createArrayFromMixed','csx','cx','emptyFunction','ge','getActiveElement','goURI','invariant','mixin','setTimeoutAcrossTransitions','GraphicPhotoWarningConfig'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac){if(c.__markCompiled)c.__markCompiled();var bc,cc,dc=c('GraphicPhotoWarningConfig').Events,ec=74,fc=75,gc=70,hc=76,ic=315,jc=new RegExp('\\/posts\\/(\\d+)\\/?$');bc=babelHelpers.inherits(kc,pb(ua,zb(v)));cc=bc&&bc.prototype;function kc(){'use strict';cc.constructor.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}kc.prototype.preload=function(lc,mc){'use strict';j.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],(function(oc){this.PhotoTagger=oc;}).bind(this));this.checkProfilePhotoNUX(lc);var nc=this.getImageSrc(new hb(lc).getQueryData());if(nc)if(!this._log(nc))new Image().src=nc;};kc.prototype.checkProfilePhotoNUX=function(lc){'use strict';if(!n.display||!this.root)return;var mc=p.scry(this.root,'#profile_photo_snowlift_nux');if(mc.length>0)k.hide(mc[0]);var nc=ab.getURIBuilder().setString('uri',lc).getURI();new i().setURI(nc).setHandler((function(oc){if(oc&&oc.payload){var pc=p.scry(this.root,'#profile_photo_snowlift_nux');if(pc.length>0)k.show(pc[0]);}}).bind(this)).send();};kc.prototype.bootstrap=function(lc,mc){'use strict';this.preload(lc,mc);this._href=lc;this._elem=mc;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,lc,mc),0);return;}pa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var nc=ha.byAttribute(mc,'data-cursor');if(nc){try{var pc=JSON.parse(nc.getAttribute('data-ft'));this._dataFt={qid:pc.qid,mf_story_key:pc.mf_story_key};}catch(oc){}}else try{nc=ha.byAttribute(mc,'data-ad');var qc=JSON.parse(nc.getAttribute('data-ad'));this._dataFt={ad_id:qc.adid};}catch(oc){}xa.openOverlayView('snowlift');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(mc){k.addClass(this.loading=mc,'loading');var rc=ha.byClass(mc,'uiStreamStory')||ha.byClass(mc,"_5jmm");if(rc){this.storyID=rc.id;}else{var sc=ha.byClass(mc,"_5b9c");if(sc)this.storyID=sc.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(mc);}else this.loading=null;h.inform('PhotoSnowlift.GO',lc,h.BEHAVIOR_STATE);this.loadFrameIfUninitialized();this._setupNextItemUI();};kc.prototype._updateContainerOwnerID=function(){'use strict';if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};kc.prototype.setupFromSnowflake=function(lc,mc){'use strict';this.extraClasses=lc;this.snowflake=true;this.firstInSet=mc;if(this.root){k.addClass(this.root,"snowflake");this.extraClasses.forEach(function(nc){k.addClass(this.root,nc);},this);}};kc.prototype.getCurrentImageServerSizeDimensions=function(){'use strict';var lc=this.stream.getCurrentImageData();return lc.originalDimensions||lc.dimensions;};kc.prototype.getEventPrefix=function(){'use strict';return 'PhotoSnowlift';};kc.prototype.getRoot=function(){'use strict';return this.root;};kc.prototype.getSourceString=function(){'use strict';return 'snowlift';};kc.prototype.getViewerSource=function(){'use strict';return this.source;};kc.prototype.getViewerSet=function(){'use strict';return this.stream.getPhotoSet();};kc.prototype.getVersionConst=function(){'use strict';return ka.VIEWER_SNOWLIFT;};kc.prototype.getImage=function(){'use strict';return this.image;};kc.prototype.getImageId=function(){'use strict';return this.stream.getCursor();};kc.prototype.getRHCHeader=function(){'use strict';return this.rhcHeader;};kc.prototype.getRHCBody=function(){'use strict';return this.ufiForm;};kc.prototype.getRHCFooter=function(){'use strict';return this.rhcFooter;};kc.prototype.getLoadQuery=function(){'use strict';return this.loadQuery;};kc.prototype.getCurrentPhotoInfo=function(){'use strict';var lc=this.stream.getCurrentImageData();if(lc)return lc.info;return null;};kc.prototype.getOwnerId=function(){'use strict';var lc=this.stream.getCurrentImageData();if(lc)return lc.info.owner;return null;};kc.prototype.getThumbAndSize=function(lc){'use strict';this.currentImageSize=null;this.thumbSrc=null;var mc=new hb(lc.getAttribute('ajaxify')).getQueryData();if(!mc.size)return;var nc=jb.deserialize(mc.size);if(!nc.x||!nc.y)return;this.currentImageSize=nc;if(lc.getAttribute('data-cropped'))return;var oc=o.scry(lc,'img')[0],pc=o.scry(lc,'i')[0],qc=ha.byAttribute(lc,'data-size');this.shouldStretch=qc&&this.currentImageSize&&oc&&qc.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=kc.TIMELINE_STRETCH_WIDTH&&oc.offsetWidth===kc.TIMELINE_STRETCH_WIDTH;var rc;if(oc){rc=oc.src;}else if(pc){rc=bb.get(pc,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=rc;};kc.prototype.loadFrameIfUninitialized=function(){'use strict';if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};kc.prototype.init=function(lc,mc){'use strict';this.init=ub;this._shouldLog=mc.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ia(ka.VIEWER_SNOWLIFT_STRING);this._showHover=mc.pivot_hover;this._showMorePhotos=mc.show_more_photos;this._extraSlidePivot=mc.extra_slide_pivot;la.setEndMetrics(mc.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=t.isSupportedWithKeyboardInput();this.showOGVideos=mc.og_videos;this.resizeCommentsForAds=mc.resize_comments_for_ads;this._canSeeGraphicWarning=!!mc.can_see_graphic_warning;this.initGraphicWarningDOM(mc.graphic_warning_markup);this.spotlight=lc;this.spotlight.subscribe('blur',(function(){this.closingAction=la.OUTSIDE;}).bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());pa.init(this.sideAdUnit,this,mc,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){ca.registerHandler(this.handleNavigateAway.bind(this));this.subscription=h.subscribe('PhotoSnowlift.GO',(function(nc,oc){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(oc);}).bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;h.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));h.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)t.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=mc.snowlift_slideshow;this.buttonTruncateGk=mc.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&mc.www_panorama_viewer;this.allowIrrelevantRequests=!!mc.snowlift_allow_irrelevant_requests;if(this.snowflake){k.addClass(this.root,"snowflake");this.extraClasses.forEach(function(nc){k.addClass(this.root,nc);},this);}this._setupNextItemUI();};kc.prototype.onFullScreenChange=function(){'use strict';if(!this.isOpen)return;var lc=t.isFullScreen();k.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',lc);if(lc){this.lastFullscreenEnter=Date.now();if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var mc=this.stream.getCurrentImageData();if(mc&&mc.url&&this.image.src!==mc.url&&this.shouldShowHiRes(mc))this.switchImage(mc.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(ib.chrome()&&this.lastPage>this.lastFullscreenEnter&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);h.inform('reflow');}cb.hide();};kc.prototype.initializeNodes=function(lc){'use strict';this.root=lc;this.container=o.find(lc,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=o.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=o.find(this.snowliftPopup,'div.rhc');this.rhcHeader=o.find(this.rhc,'div.rhcHeader');this.rhcFooter=o.find(this.rhc,'div.rhcFooter');this.taglist=o.find(this.rhc,'span.fbPhotoTagList');this.ufiForm=o.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=o.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=o.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=o.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=o.find(this.snowliftPopup,'div.stageWrapper');this.overlay=o.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=o.find(this.stageWrapper,'div.stageError');this.image=o.find(this.stageWrapper,'img.spotlight');this.stage=o.find(this.stageWrapper,'div.stage');this.showZoomInButton=o.scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=o.scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=o.scry(this.stage,"._10zw").pop();this.outerImageSlider=o.scry(this.stage,"._10zx").pop();this.innerImageSlider=o.scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){k.hide(this.showZoomInButton);k.hide(this.showZoomOutButton);k.hide(this.zoomedImage);k.hide(this.outerImageSlider);}this.videoStage=o.find(this.stageWrapper,'div.videoStage');this.prevPager=o.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=o.find(this.snowliftPopup,'a.snowliftPager.next');this.upPager=o.find(this.container,'a.snowliftPager.up');this.downPager=o.find(this.container,'a.snowliftPager.down');this.stageActions=o.find(lc,'div.stageActions');this.buttonActions=o.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=o.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=o.find(lc,"._5ciw");k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};kc.prototype.getGraphicWarningContainer=function(){'use strict';return this.stageWrapper;};kc.prototype.getGraphicWarningHiddenContent=function(){'use strict';return this.stage;};kc.prototype.initializeScroller=function(){'use strict';this.initializeScroller=ub;k.addClass(this.scroller,"_467y");this.scrollableArea=ya.fromNative(this.scroller,{fade:true,persistent:true});var lc=(function(event){var mc=r.$E(event).getTarget();if(o.contains(this.ufiInputContainer,mc)){var nc=q.getInstance(mc);if(nc){this.scrollableArea.scrollToBottom();var oc=nc.subscribe('resize',(function(){var qc=this.scrollableArea.isScrolledToBottom();this.adjustScroller();qc&&this.scrollableArea.scrollToBottom();}).bind(this)),pc=r.listen(mc,'blur',function(){nc.unsubscribe(oc);pc.remove();});}}if(mc.classList.contains('UFIPagerLink')||mc.classList.contains('UFICommentLink'))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true;}).bind(this);h.subscribe(gb.InputHeightChanged,(function(mc,nc){if(o.contains(this.ufiInputContainer,nc.node))this.adjustScroller();}).bind(this));h.subscribe(gb.Changed,(function(mc,nc){if(this.ufiForm===nc.form)this.adjustScrollerIfNecessary();}).bind(this));h.subscribe(gb.Comment,(function(mc,nc){if(this.ufiForm===nc.form){this.adjustScrollerIfNecessary();if(nc.isinverted){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}).bind(this));r.listen(this.rhc,'click',(function(event){var mc=event.getTarget();if(ha.byTag(mc,'a')||ha.byTag(mc,'button')||o.isNodeOfType(mc,'input'))this.adjustScrollerIfNecessary();}).bind(this));h.subscribe(['reflow',gb.CommentPager],(function(){if(this.isOpen)this.adjustScrollerIfNecessary();}).bind(this));h.subscribe(gb.TranslationRendered,(function(){this.adjustScrollerIfNecessary();}).bind(this));r.listen(this.ufiForm,'focusin',lc);};kc.prototype.openHandler=function(lc){'use strict';if(this.isOpen||!ja.isValid(lc)||this.returningToStart||lc.getQueryData().closeTheater||lc.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(lc);this._uriStack.push(new hb(lc).getQualifiedURI().toString());ga.transitionComplete(true);return true;};kc.prototype.addHaltAutoplaySubscription=function(){'use strict';h.subscribe([gb.Focus],(function(){this.haltAutoplay=true;}).bind(this));h.subscribe([gb.Blur],(function(lc,mc){this.haltAutoplay=mc.hasEnteredText;}).bind(this));};kc.prototype.getImageSrc=function(lc){'use strict';if(lc.smallsrc){if(!lc.size)return lc.smallsrc;var mc=jb.deserialize(lc.size),nc=this.getStageSize(mc);nc=this._adjustStageSizeForPixelRatio(nc);if(nc.x<=kc.STAGE_NORMAL_MAX.x&&nc.y<=kc.STAGE_NORMAL_MAX.y)return lc.smallsrc;}return lc.src;};kc.prototype.open=function(lc){'use strict';var mc=new hb(lc),nc=mc.getQueryData(),oc=ja.parse(mc);if(oc!==null){nc.fbid=oc.photo_id;nc.set=oc.set_token;}var pc=kb.parse(mc);if(pc!==null){nc.v=pc.video_id;nc.set=pc.set_token;}if(!nc.fbid&&!nc.v&&!nc.pid){var qc=jc.exec(mc.getPath());if(qc)nc.v=qc[1];}var rc=this.getImageSrc(nc);if(rc){delete nc.src;delete nc.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){nc.firstLoad=true;this.initialLoad=true;da.registerBlocker((function(){return this.isOpen;}).bind(this));ea.registerOpenChecker((function(){return this.isOpen;}).bind(this));}this.sessionID=Date.now();this.loadQuery=Object.assign(nc,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;k.show(this.nextPager);k.show(this.prevPager);this.source=null;this.saveTagSubscription=h.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new ra();this.stream.init(ka.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,nc.tagSuggestionMode||'everyone');if(!!hb.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(hb.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(kc.STATE_HTML,true);this.rhcCollapsed=false;this._open(lc,rc);j.loadModules(["PhotosButtonTooltips"],function(sc){sc.init();});};kc.prototype._open=function(lc,mc){'use strict';this.createLoader(mc);this.spotlight.show();h.inform('layer_shown',{type:'PhotoSnowlift'});h.inform('PhotoSnowlift.OPEN');this.stageHandlers=[r.listen(window,'resize',this.adjustForResize.bind(this)),r.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),r.listen(this.stageWrapper,'mouseleave',(function(event){var pc=event.getTarget();if(!(ha.byClass(pc,'snowliftOverlay')||ha.byClass(pc,'fbPhotoSnowliftTagApproval')||ha.byClass(pc,'tagPointer')||ha.byClass(pc,'arrow')||ha.byClass(pc,'faceboxSuggestion')||ha.byClass(pc,'typeaheadWrapper')||ha.byClass(pc,'photoTagTypeahead')||ha.byClass(pc,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}).bind(this)),r.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),r.listen(this.root,'mousemove',this.hiliteProductItemPager.bind(this)),r.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),r.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),r.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),r.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),r.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),r.listen(this.root,'focusin',this.hiliteProductItemPager.bind(this)),r.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(r.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(r.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(r.listen(this.container,'click',(function(event){var pc=event.getTarget();if(ha.byClass(pc,'rotateRight')){this.rotate('right');}else if(ha.byClass(pc,'rotateLeft')){this.rotate('left');}else if(ha.byClass(pc,'closeTheater')){if(t.isFullScreen()){t.toggleFullScreen();return;}this.closingAction=la.X;this.spotlight.hide();return false;}else if(ha.byClass(pc,"_32_l")){var qc=ha.byClass(pc,"_32_l"),rc=qc.getAttribute('data-fbid'),sc=this.stream.getCursor(),tc=this.stream.calculateDistance(sc,rc),uc=this.stream.fbidList.indexOf(rc);za.adjustCarousel(uc);this.page(tc,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen();}else if(this.fullscreen)if(ha.byClass(pc,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(ha.byClass(pc,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}).bind(this)));var nc=vb('fbPhotoSnowliftFeedback');if(nc)this.stageHandlers.push(r.listen(nc,'click',(function(event){var pc=event.getTarget();if(ha.byClass(pc,'like_link')||ha.byClass(pc,'UFILikeLink')&&ha.byClass(pc,'UIActionLinks'))this.toggleLikeButton();var qc=ha.byClass(event.getTarget(),'uiUfiCollapsedComment');if(qc)k.addClass(qc,'uiUfiCollapsedCommentToggle');}).bind(this)));var oc=vb('fbPhotoSnowliftOnProfile');if(oc)this.stageHandlers.push(r.listen(oc,'click',(function(event){if(ha.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}).bind(this)));if(this.resetUriStack)this.startingURI=hb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!mc)this.setLoadingState(kc.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){ga.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}la.initLogging(la.SNOWLIFT);if(this.pivots)la.setRelevantCount(this.pivots.relevantCount);};kc.prototype.toggleFullScreen=function(){'use strict';var lc=t.toggleFullScreen(document.documentElement);if(lc){var mc=this.stream.getCurrentImageData();if(mc&&mc.url&&this.image.src!==mc.url&&this.shouldShowHiRes(mc))if(!this._log(mc.url))new Image().src=mc.url;la.logEnterFullScreen(this.stream.getCursor());}};kc.prototype.getStream=function(){'use strict';return this.stream;};kc.prototype.fetchInitialData=function(){'use strict';this.stream.waitForInitData();var lc=this.loadQuery.within_business?this.loadQuery.business_thread_id:this.loadQuery.fbid;fb.loadFromEndpoint('PhotoViewerInitPagelet',vb('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:eb.getActorIDForFeedbackTargetIfExists(lc),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};kc.prototype.toggleCollapse=function(){'use strict';if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};kc.prototype.collapseRHC=function(){'use strict';this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();};kc.prototype.uncollapseRHC=function(){'use strict';this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();};kc.prototype.closeHandler=function(){'use strict';if(!this.isOpen)return;this.closingAction=this.closingAction||la.ESC;if(hb.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};kc.prototype.returnToStartingURI=function(lc,mc){'use strict';if(!lc)if(mc){this.squashNextTransition(xb.bind(null,mc));}else this.squashNextTransition();this.returningToStart=true;var nc=h.subscribe('page_transition',(function(){this.returningToStart=false;nc.unsubscribe();}).bind(this)),oc=lc||isNaN(ib.opera()),pc=this._uriStack.length;if(oc&&pc<window.history.length){window.history.go(-pc);}else{var qc=this.startingURI,rc=new hb(qc).removeQueryData('closeTheater');if(qc.getQueryData().sk=='approve'&&qc.getPath()=='/profile.php'){rc.removeQueryData('highlight');rc.removeQueryData('notif_t');}xb(rc);}};kc.prototype.squashNextTransition=function(lc){'use strict';this.squashNext=true;ga.registerHandler((function mc(){if(this.squashNext){this.squashNext=false;if(lc)setTimeout(lc,0);ga.transitionComplete(true);return true;}return false;}).bind(this),7);};kc.prototype.handleNavigateAway=function(lc){'use strict';var mc=qb(ga.getMostRecentURI().getQualifiedURI(),lc.getAttribute('href'));if(this.isOpen&&mc instanceof hb&&mc.getUnqualifiedURI().toString()!=this.startingURI.toString()&&mc.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=la.NAVIGATE;this.returnToStartingURI(false,mc);this.close();return false;}return true;};kc.prototype.postProcessTaggedPhotos=function(){'use strict';if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var lc=null;if(this.source===kc.COLLECTIONS_UNTAGGED_PHOTOS){lc='/ajax/photos/photo/edit/skiptag/';}else if(this.source===kc.PHOTOS_OF_YOU_SUGGESTIONS||this.source===kc.FRIENDS_IN_PHOTOS_SUGGESTIONS)lc='/ajax/photos/photo/add_to_star_grid/';if(lc)new i().setURI(lc).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};kc.prototype.onTagSaved=function(lc,mc){'use strict';if(this.taggedPhotoIds){if(this.source===kc.PHOTOS_OF_YOU_SUGGESTIONS&&!mc.self_tag)return;this.taggedPhotoIds.push(mc.photo_fbid);}};kc.prototype.clearAlbumBoundaries=function(){'use strict';this._albumBoundaries={start:0,end:0,dir:0};};kc.prototype.close=function(){'use strict';if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)t.disableFullScreen();xa.closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();h.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;ac(this.closeCleanup.bind(this),0);if(this.snowflake){k.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(lc){k.removeClass(this.root,lc);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};kc.prototype.closeCleanup=function(){'use strict';this.closeDirty=false;k.removeClass(this.root,'dataLoading');la.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var lc=this.stream.getCursor();if(mb.canAbort){var mc;for(mc=0;mc<this.stream.getLength();mc++){var nc=this.stream.getImageData(this.stream.getCursorAt(mc));if(nc.video)nc.controller.abortLoading();}}k.removeClass(this.stageWrapper,'showVideo');o.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();o.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var oc=this.closingAction===la.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){ga.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}h.inform('layer_hidden',{type:'PhotoSnowlift'});h.inform('PhotoSnowlift.CLOSE',{is_navigating:oc,fbid:lc});this._setZoomOut();this._previousZoomScrollPercent=null;};kc.prototype.createLoader=function(lc){'use strict';if(this.currentImageSize===null){this.adjustStageSize(kc.STAGE_MIN);}else{var mc=this.getStageSize(this.currentImageSize);mc=new jb(Math.max(mc.x,this.getMinimumStageWidth()),Math.max(mc.y,kc.STAGE_MIN.y));var nc=this.getImageSizeInStage(this.currentImageSize,mc);if(this.thumbSrc===null){this.adjustStageSize(nc);}else this.useImage(o.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:nc.x+'px',height:nc.y+'px'}}),nc,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(lc)setTimeout((function(){var oc=new Image(),pc=(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(lc,this.currentImageSize);this.setLoadingState(kc.STATE_IMAGE_DATA,false);}}).bind(this),qc=r.listen(oc,'load',pc),rc=function(){if(qc){qc.remove();qc=null;}};h.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',rc);h.subscribeOnce('PhotoSnowlift.CLOSE',rc);this._log(lc);oc.src=lc;}).bind(this),0);k.hide(this.stageActions);this.setStagePagersState('disabled');};kc.prototype.initDataFetched=function(lc){'use strict';la.setPhotoSet(this.stream.getPhotoSet());la.setLogFbids(lc.logids);if(lc.eid)la.setEid(lc.eid);this._albumBoundaries.start=this.stream.getCursor();var mc=this.stream.getCurrentImageData();la.addPhotoView(mc.info,this.shouldShowHiRes(mc),this.fullscreen&&t.isFullScreen());var nc=this.stream.getCurrentExtraData();if(this._showHover&&nc)ta.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(nc.tagRects));if(nc&&nc.source!==undefined){this.source=parseInt(nc.source,10);la.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[r.listen(this.root,'click',this.pageListener.bind(this)),r.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=lc.loggedin;this.disableAds=!this.isLoggedInViewer||lc.fromad||lc.withinbusiness||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(mc)){la.addPanoramaImpression();var oc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(oc);}else if(this._hasZoomCapability)k.hide(this.showZoomInButton);};kc.prototype.adjustScrollerIfNecessary=function(){'use strict';clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};kc.prototype.adjustScroller=function(lc){'use strict';clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var mc=jb.getElementDimensions(this.rhc),nc=mc.y;nc-=jb.getElementDimensions(this.rhcHeader).y;nc-=jb.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var oc=jb.getElementDimensions(this.placeInfo);nc-=oc.y;bb.set(this.sideAdUnit,'bottom',oc.y+'px');}if(lc==null)lc=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=lc;nc=Math.max(0,nc);var pc=jb.getElementDimensions(this.scrollerBody).y,qc=Math.max(kc.MIN_UFI_HEIGHT,nc-lc);if(pc>=qc){if(nc>qc){k.removeClass(this.rhc,'pinnedUfi');nc-=qc;}else{k.addClass(this.rhc,'pinnedUfi');nc=0;}bb.set(this.scroller,'height',qc+'px');}else{bb.set(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');nc-=pc;}var rc=jb.getElementDimensions(this.ufiInputContainer).y;bb.set(this.ufiForm,'padding-bottom',rc+'px');pa.resize(new jb(mc.x,nc));this.scrollableArea.adjustGripper();};kc.prototype.adjustForResize=function(){'use strict';this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};kc.prototype.shouldShowHiRes=function(lc){'use strict';if(!lc||!lc.smallurl)return false;var mc=this.getStageSize(lc.dimensions);mc=this._adjustStageSizeForPixelRatio(mc);var nc=this.getImageSizeInStage(lc.dimensions,mc);return (nc.x>kc.STAGE_NORMAL_MAX.x||nc.y>kc.STAGE_NORMAL_MAX.y);};kc.prototype._adjustStageSizeForPixelRatio=function(lc){'use strict';if(window.devicePixelRatio&&window.devicePixelRatio>1)lc=new jb(lc.x*window.devicePixelRatio,lc.y*window.devicePixelRatio);return lc;};kc.prototype.getImageURL=function(lc){'use strict';if(lc.video){return null;}else if(lc.smallurl&&!this.shouldShowHiRes(lc))return lc.smallurl;return lc.url;};kc.prototype.getImageOrVideoDimensions=function(lc){'use strict';if(lc.video){var mc=this.getVideoElement(lc.video);if(mc)return this.getVideoSize(mc);}return this.getImageDimensions(lc);};kc.prototype.getImageDimensions=function(lc){'use strict';if(this._isZoomOn)return lc.originalDimensions;if(lc.smalldims&&(!this.shouldShowHiRes(lc)||this.image.src===lc.smallurl))return lc.smalldims;return lc.dimensions;};kc.prototype.getStageSize=function(lc,mc){'use strict';var nc=jb.getViewportDimensions(),oc=new jb(lc.x,lc.y+this.getExtraVerticalSpace());if(mc)oc=new jb(Math.max(lc.x,mc.x),Math.max(lc.y,mc.y));var pc,qc;if(this.fullscreen&&t.isFullScreen()){qc=screen.height-kc.FULL_SCREEN_PADDING*2;return new jb(this.rhcCollapsed?screen.width:screen.width-kc.SIDEBAR_SIZE_MAX,this._isItemPagerEnabled()?qc-kc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:qc);}else{pc=Math.min(oc.x,nc.x-kc.SIDEBAR_SIZE_MAX-kc.STAGE_CHROME.x);var rc=nc.y-kc.STAGE_CHROME.y;qc=Math.min(oc.y,this._isItemPagerEnabled()?rc-kc.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:rc);}if(pc===0&&qc===0)return new jb(0,0);var sc=pc/qc,tc=oc.x/oc.y;if(sc<tc)return new jb(pc,Math.round(pc/tc));return new jb(Math.round(qc*tc),qc);};kc.prototype.getExtraVerticalSpace=function(){'use strict';if(this.getVideoOnStage())return kc.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};kc.prototype.getComponentsHeight=function(){'use strict';var lc=this.getVideoOnStage();if(lc){var mc=vb(lc);if(mc)return this.getVideoComponentsHeight(mc);}return 0;};kc.prototype.getMinimumStageWidth=function(){'use strict';var lc=kc.STAGE_MIN.x;if(this.getVideoOnStage())return lc;if(qa.ALLOW_MAKE_COVER_PHOTO_BUTTON)lc+=kc.COVER_PHOTO_BUTTON_WIDTH;if(qa.ALLOW_MAKE_PROFILE_PICTURE_BUTTON)lc+=kc.PROFILE_PICTURE_BUTTON_WIDTH;return lc;};kc.prototype.getImageSizeInStage=function(lc,mc){'use strict';var nc=lc.x,oc=lc.y,pc=this.getComponentsHeight(),qc=this.getExtraVerticalSpace();oc-=pc;mc=new jb(mc.x,mc.y-pc-qc);if(nc>=mc.x||oc>=mc.y){var rc=mc.x/mc.y,sc=nc/oc;if(rc<sc){nc=mc.x;oc=Math.round(nc/sc);}else if(rc>sc){oc=mc.y;nc=Math.round(oc*sc);}else{nc=mc.x;oc=mc.y;}}return new jb(nc,oc+pc);};kc.prototype.getStageSizeForZoomedImage=function(lc,mc){'use strict';if(this.fullscreen&&t.isFullScreen()){var nc=this.rhcCollapsed?screen.width:screen.width-kc.SIDEBAR_SIZE_MAX,oc=screen.height-kc.FULL_SCREEN_PADDING*2;return new jb(nc,oc);}var pc=jb.getViewportDimensions();if(mc===null)mc=new jb(0,0);var qc=new jb(Math.max(lc.x,this.getMinimumStageWidth(),mc.x),Math.max(lc.y,kc.STAGE_MIN.y,mc.y)),rc=pc.x-kc.STAGE_CHROME.x;if(!this.rhcCollapsed)rc-=kc.SIDEBAR_SIZE_MAX;nc=Math.min(qc.x,rc);oc=Math.min(qc.y,pc.y-kc.STAGE_CHROME.y);return new jb(nc,oc);};kc.prototype.adjustStageSize=function(lc){'use strict';var mc=this.currentImageSize;if(lc){mc=lc;}else{var nc=this.stream&&this.stream.getCurrentImageData();if(nc)mc=this.getImageOrVideoDimensions(nc);}if(!mc)return;this.currentImageSize=mc;var oc=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&mc.x>mc.y&&mc.x<=kc.TIMELINE_STRETCH_WIDTH&&mc.x>=kc.TIMELINE_STRETCH_MIN){mc.y=Math.round(mc.y*kc.TIMELINE_STRETCH_WIDTH/mc.x);mc.x=kc.TIMELINE_STRETCH_WIDTH;}var pc;if(this._isZoomOn){pc=this.getStageSizeForZoomedImage(mc,this.currentMinSize);}else pc=this.getStageSize(mc,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new jb(0,0);this.currentMinSize=new jb(Math.max(pc.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(pc.y,kc.STAGE_MIN.y,this.currentMinSize.y));var qc=this.getImageSizeInStage(mc,this.currentMinSize),rc=this.currentMinSize.x-qc.x,sc=this.currentMinSize.y-qc.y;if(rc>0&&rc<kc.PADDING_MIN){this.currentMinSize.x-=rc;}else if(sc>0&&sc<kc.PADDING_MIN)this.currentMinSize.y-=sc;var tc=this.currentMinSize.x+kc.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)tc=this.currentMinSize.x;var uc=this.getVideoOnStage()&&this.pivotsCarouselElement,vc=0,wc=this.currentMinSize.y;if(uc){var xc=this.pivotsCarouselElement.clientHeight;vc=Math.ceil(xc/100)*100;wc=wc+vc;}this.snowliftPopup.style.cssText='width:'+tc+'px;'+'height:'+wc+'px;';var yc=this.currentMinSize.y-oc,zc=yc+vc;if(ib.firefox()){var ad=bb.get(this.stageWrapper,'font-size');yc=yc/parseFloat(ad)+'em';zc=zc/parseFloat(ad)+'em';}else{yc=yc+'px';zc=zc+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+yc+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+zc+';';if(this._isZoomOn){var bd=this.currentMinSize.y-oc;if(mc.y>bd){var cd=mc.x/mc.y*bd;bb.apply(this.zoomedImage,{width:cd+"px",height:bd+"px"});}else bb.apply(this.zoomedImage,{width:mc.x+"px",height:mc.y+"px"});}else{qc.y-=this.getComponentsHeight();this.setMediaElementSize(qc);}if(uc)this.setPivotCarouselElementWidth(ad);var dd=this.getTagger();if(dd)dd.repositionTagger();this.adjustScrollerIfNecessary();};kc.prototype.setMediaElementSize=function(lc){'use strict';var mc=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(lc.x,lc.y);}else mc=o.scry(this.videoStage,"._53j5")[0]||mc;mc.style.cssText='width:'+lc.x+'px;'+'height:'+lc.y+'px;';};kc.prototype.setPivotCarouselElementWidth=function(lc){'use strict';var mc=this.videoStage.clientWidth;if(ib.firefox()){mc=mc/parseFloat(lc)+'em';}else mc=mc+'px';this.pivotsCarouselElement.style.width=mc;};kc.prototype.adjustForNewData=function(){'use strict';if(!this.image)return;var lc=o.scry(this.stage,'div.tagsWrapper')[0],mc=jb.getElementDimensions(this.image);if(lc){bb.set(lc,'width',mc.x+'px');bb.set(lc,'height',mc.y+'px');}};kc.prototype.adsDisplayedCallback=function(lc,mc){'use strict';var nc=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&lc<kc.MIN_ADS_VISIBLE&&mc.length>=kc.MIN_ADS_VISIBLE;if(nc){this.inAdsDisplayedCallback=true;var oc=mc[kc.MIN_ADS_VISIBLE-1];this.adjustScroller(oc);this.inAdsDisplayedCallback=false;}};kc.prototype.setLoadingState=function(lc,mc){'use strict';switch(lc){case kc.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',mc);break;case kc.STATE_IMAGE_DATA:this.loadingStates[lc]=mc;k.conditionClass(this.root,'imageLoading',mc);break;case kc.STATE_HTML:this.loadingStates[lc]=mc;k.conditionClass(this.root,'dataLoading',mc);this.rhc.setAttribute('aria-busy',mc?'true':'false');break;}};kc.prototype.destroy=function(){'use strict';this.stageHandlers.forEach(function(lc){lc.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(lc){lc.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};kc.prototype.checkState=function(lc){'use strict';if(lc!=kc.STATE_ERROR&&!this.loadingStates[lc])return;switch(lc){case kc.STATE_IMAGE_DATA:var mc=this.stream.getCurrentImageData();if(mc){var nc=this.getImageURL(mc);if(nc){this.switchImage(nc,null,true);}else if(mc.video)this.switchVideo(mc.video,true);this.setLoadingState(lc,false);}break;case kc.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(lc,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}};kc.prototype.buttonListener=function(event){'use strict';var lc=event.getTarget(),mc=Date.now();if(ha.byClass(lc,"_5qmg")){la.addPanoramaClick();this.switchIntoZoomedImage();return;}if(ha.byClass(lc,"_5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(ha.byClass(lc,'fbPhotoTagApprovalBox'))return;if(mc-this.lastPage<350)return;if(ha.byClass(lc,'fbPhotosPhotoLike')){this.likePhoto();}else if(ha.byClass(lc,'tagApproveIgnore')){this.updateTagBox(event,lc);}else if(ha.byClass(lc,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(ha.byClass(lc,"_5ymu")){if(!this._showingMorePhotos){ta.logShowMorePhotos();var nc=this.stream.getCursor();if(nc)this.showMorePhotos(String(nc));if(this._hasZoomCapability)k.hide(this.showZoomInButton);}else{ta.logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(ha.byClass(lc,"_27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};kc.prototype.toggleSlideshow=function(){'use strict';if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};kc.prototype.startSlideshow=function(){'use strict';this._slideshowToken=window.setInterval(this.page.bind(this,1,ib.chrome()&&t.isFullScreen()),kc.SLIDESHOW_TIME);k.addClass(this.root,'slideshowStarted');k.removeClass(this.root,'slideshowAvailable');};kc.prototype.stopSlideshow=function(){'use strict';this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;k.addClass(this.root,'slideshowAvailable');k.removeClass(this.root,'slideshowStarted');};kc.prototype.likePhoto=function(){'use strict';la.addButtonLike();var lc=nb('fbPhotoSnowliftFeedback'),mc=o.scry(lc,'button.like_link')[0];if(!mc)mc=o.scry(lc,'a.UFILikeLink')[0];var nc=mc.getAttribute('href');if(t.isFullScreen())if(ib.chrome())mc.setAttribute('href','javascript:;');mc.click();mc.setAttribute('href',nc);};kc.prototype.toggleLikeButton=function(){'use strict';var lc=o.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(lc){var mc=o.find(this.root,'.likeCount'),nc=o.find(mc,'.likeCountNum');if(mc)if(k.hasClass(lc,'viewerLikesThis')){o.setContent(nc,parseInt(nc.textContent,10)-1);}else o.setContent(nc,parseInt(nc.textContent,10)+1);k.toggleClass(lc,'viewerLikesThis');k.removeClass(lc,'viewerAlreadyLikedThis');}};kc.prototype.likePhotoWithKey=function(){'use strict';return ba.like(this.likePhoto.bind(this),wb());};kc.prototype.updateTagBox=function(lc,mc){'use strict';this.unhiliteAllTags();var nc=vb(lc);if(!nc)return;k.addClass(nc,'tagBox');k.addClass(nc,'tagBoxPendingResponse');k.removeClass(nc,'tagBoxPending');k.hide(o.find(nc,'span.tagForm'));if(mc){k.show(o.find(nc,'span.tagApproved'));}else k.show(o.find(nc,'span.tagIgnored'));};kc.prototype.rotate=function(lc){'use strict';var mc=this.stream.getCursor();if(this.getVideoOnStage()){var nc=lc=='left'?270:90;!!!this.videoRotateURI?yb(0):undefined;j.loadModules(["VideoRotate"],(function(pc){new pc(mc,this.videoRotateURI).motionRotate(nc);}).bind(this));return;}var oc=babelHelpers._extends({fbid:mc,opaquecursor:this.stream.getOpaqueCursor(mc),cs_ver:ka.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());oc[lc]=1;this.setLoadingState(kc.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(oc).setErrorHandler(this.rotationError.bind(this,mc)).setFinallyHandler(this.rotationComplete.bind(this,mc)).setMethod('POST').setReadOnly(false).send();};kc.prototype.rotationComplete=function(lc,mc){'use strict';if(lc==this.stream.getCursor()){this.setLoadingState(kc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};kc.prototype.rotationError=function(lc,mc){'use strict';if(lc==this.stream.getCursor()){this.setLoadingState(kc.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(["AsyncResponse"],function(nc){nc.defaultErrorHandler(mc);});}};kc.prototype.saveTagsFromPayload=function(lc){'use strict';this.storeFromData(lc);if('data' in lc&&this.stream.getCursor() in lc.data)this.swapData();};kc.prototype.saveEdit=function(){'use strict';if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(["PhotoInlineEditor","Form"],(function(lc,mc){var nc=lc.getInstance(this.getViewerConst());nc&&mc.bootstrap(nc.getForm().controller);}).bind(this));};kc.prototype.mouseLeaveListener=function(event){'use strict';this.unhiliteAllTags();this.reHilitePendingTag();};kc.prototype.hiliteProductItemPager=function(event){'use strict';var lc=jb.getEventPosition(event),mc=jb.getElementDimensions(this.root),nc=mc.y-lc.y;if(nc>kc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE&&lc.y>kc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE){k.conditionClass(this.upPager,'hilightPager',false);k.conditionClass(this.downPager,'hilightPager',false);return;}var oc=nc<kc.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE;k.conditionClass(this.upPager,'hilightPager',!oc);k.conditionClass(this.downPager,'hilightPager',oc);};kc.prototype.hilitePager=function(event){'use strict';var lc=jb.getEventPosition(event),mc=jb.getElementPosition(this.stage),nc=jb.getElementDimensions(this.stage);if(fa.isRTL()){this.stagePagerPrev=nc.x-(lc.x-mc.x)<kc.GOPREV_AREA;}else this.stagePagerPrev=lc.x-mc.x<kc.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var oc,pc=event.getTarget();if(!ha.byClass(pc,'snowliftOverlay')&&!ha.byClass(pc,'bottomBarActions')&&!ha.byClass(pc,'snowliftPager'))oc=kc.PAGER_FADE;this.showPagers(oc);};kc.prototype.showPagers=function(lc){'use strict';clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof lc!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),lc);};kc.prototype.hidePagers=function(){'use strict';var lc=o.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(lc)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};kc.prototype.getTagger=function(){'use strict';return this.PhotoTagger&&this.PhotoTagger.getInstance(ka.VIEWER_SNOWLIFT);};kc.prototype.unhiliteAllTags=function(){'use strict';clearTimeout(this.unhiliteTimer);o.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(mc){k.removeClass(mc,'hover');});o.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(mc){k.removeClass(mc,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var lc=this.getTagger();if(lc){lc.hideTagger();lc.setCurrentFacebox(null);}}};kc.prototype.switchHilitedTags=function(lc,mc){'use strict';if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var nc=vb(lc);if(nc){this.hilitedTag=lc;if(!k.hasClass(this.root,'taggingMode')&&sa.isFacebox(this.hilitedTag)){var oc=this.getTagger();if(oc){k.addClass(nc,'hover');var pc=oc.getFacebox(lc);oc.setCurrentFacebox(pc);if(pc)oc.addTagFromFacebox(pc);}}else k.addClass(nc,'hover');if(k.hasClass(nc,'tagBoxPending')&&!k.hasClass(nc,'showPendingTagName')&&mc===true){o.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(qc){k.removeClass(qc,'showPendingTagName');});k.addClass(nc,'showPendingTagName');}}};kc.prototype.reHilitePendingTag=function(){'use strict';var lc=vb(this.hilitedTag);if(lc&&k.hasClass(lc,'showPendingTagName'))return;var mc=o.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(mc)this.switchHilitedTags(mc.id);};kc.prototype.hiliteTagsOnMouseMove=function(event){'use strict';if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var lc=event.getTarget();if(ha.byClass(lc,'snowliftOverlay')||ha.byClass(lc,'fbPhotoSnowliftTagApproval')||ha.byClass(lc,'tagPointer')||ha.byClass(lc,'arrow')||ha.byClass(lc,'faceboxSuggestion')||ha.byClass(lc,'typeaheadWrapper')||ha.byClass(lc,'photoTagTypeahead'))return;var mc=ha.byClass(lc,'tagBoxPending'),nc=false;if(this.hilitedTag){var oc=vb(this.hilitedTag);nc=oc&&k.hasClass(oc,'tagBoxPending');}var pc=!this.hilitedTag&&mc||!nc&&mc;if(pc){this.switchHilitedTags(mc.id);return;}if(mc&&mc.id==this.hilitedTag)return;var qc=250,rc=15,sc=jb.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=sc;var tc=sa.absoluteToNormalizedPosition(this.image,sc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(sc)<rc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(tc))return;var uc=sa.getNearestBox(this.stream.getCurrentExtraData().tagRects,tc);if(!uc){if(!nc){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var vc=null;if(nc){var wc={};wc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];vc=sa.getNearestBox(wc,tc);}if(vc!==null&&nc)return;if(this.hilitedTag!=uc)if(nc){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,uc),qc);}else{if(this._showHover&&!this._seenTags[uc]){this._seenTags[uc]=true;ta.logPivotImpression('snowlift',uc);}this.switchHilitedTags(uc);}};kc.prototype.currentTagHasPrecedence=function(lc){'use strict';if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var mc=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],nc=new wa(mc.t+mc.h()/2,mc.r,mc.b+(sa.isFacebox(this.hilitedTag)?10:0),mc.l,mc.domain);return nc.contains(lc);};kc.prototype.getVideoOnStage=function(){'use strict';var lc=this.stream&&this.stream.getCurrentImageData();return lc&&lc.video;};kc.prototype.shouldPageOnAction=function(lc,mc){'use strict';if(!this.isOpen||ba.isShowingConfirmation())return false;var nc=o.isNode(mc)&&(ha.byClass(mc,'snowliftPager')||ha.byClass(mc,'stagePagers')||ha.byClass(mc,'pivotPageColumn')),oc=o.isNode(mc)&&ha.byClass(mc,'stage'),pc=k.hasClass(mc,'faceBox'),qc=!k.hasClass(this.root,'taggingMode')&&pc&&!nc;if(qc){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){o.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var rc=oc&&k.hasClass(this.root,'taggingMode')||ha.byClass(mc,'tagBoxPending')||ha.byClass(mc,'tagBoxPendingResponse')||ha.byClass(mc,'fbPhotoTagApprovalBox')||ha.byClass(mc,'tag');if(rc)return false;if(oc&&this._isZoomOn)oc=false;return lc==y.LEFT||lc==y.RIGHT||lc==y.UP||lc==y.DOWN||lc==ec||lc==fc||nc||qc||oc;};kc.prototype.keyHandler=function(lc,event){'use strict';if(event.getModifiers().any||z.getTopmostLayer()!==this.spotlight)return true;switch(r.getKeyCode(event)){case y.LEFT:case y.RIGHT:case y.UP:case y.DOWN:case ec:case fc:this.pageListener(event);return false;case gc:return this.toggleFullScreen();case hc:return this.likePhotoWithKey();case y.SPACE:this.toggleSlideshow();this.showPagers(kc.PAGER_FADE);return false;case y.ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};kc.prototype._isItemPagerEnabled=function(){'use strict';var lc=this._scrapProductItemSnowLiftLinks();return lc!==null&&lc.length>1;};kc.prototype._setupNextItemUI=function(){'use strict';if(!this.upPager||!this.downPager)return;var lc=this._scrapProductItemSnowLiftLinks();if(!lc||lc.length<2){k.hide(this.upPager);k.hide(this.downPager);}else{var mc=jb.getElementDimensions(this.stage),nc=jb.getElementDimensions(this.root),oc=(nc.y-mc.y)/2-kc.PRODUCT_ITEM_PAGER_MARGIN;this.upPager.style.marginTop="-"+oc+"px";this.downPager.style.marginTop=oc-kc.PRODUCT_ITEM_PAGER_HEIGHT+"px";k.show(this.upPager);k.show(this.downPager);}};kc.prototype._scrapProductItemSnowLiftLinks=function(){'use strict';if(!this._elem)return null;var lc=vb('pagelet_group_forsaleposts');if(!lc)lc=vb('group_commerce_cross_group_feed_stories');if(!lc)return null;var mc=o.scry(lc,'a[name="snowlift"]').filter(function(pc){return o.scry(pc,'img').length==1;}),nc=mc.map(function(pc){return pc.href;}),oc=ob(nc,this._elem.href);return oc?mc:[];};kc.prototype._loadNextItem=function(lc){'use strict';var mc=this._scrapProductItemSnowLiftLinks();if(!mc)return;var nc=mc[0];mc.every((function(oc,pc){if(oc.href===this._elem.href){var qc=lc?++pc:--pc;if(qc<0){nc=mc[mc.length-1];}else if(qc<mc.length)nc=mc[qc];return false;}return true;}).bind(this));nc.click();};kc.prototype.shouldHandlePendingTag=function(event){'use strict';var lc=this.getTagger();if(!lc||!lc.tags.length)return false;var mc=sa.absoluteToNormalizedPosition(this.getImage(),jb.getEventPosition(event)),nc=lc.findNearestTag(mc);if(!nc||!k.hasClass(nc.node,'tagBoxPending'))return false;h.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:nc.id,version:this.getVersionConst()});return true;};kc.prototype.pageListener=function(event){'use strict';var lc=r.getKeyCode(event),mc=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(lc,mc))return;if(this.shouldHandlePendingTag(event))return;var nc=0,oc=null,pc=null;if(lc==y.RIGHT||lc==fc){nc=1;la.setPagingAction('key_right');this._disableMouseOver=true;}else if(lc==y.LEFT||lc==ec){nc=-1;la.setPagingAction('key_left');this._disableMouseOver=true;}else if(lc==y.UP){la.setPagingAction('key_up');this._disableMouseOver=true;oc=false;}else if(lc==y.DOWN){la.setPagingAction('key_down');this._disableMouseOver=true;oc=true;}else if(ha.byClass(mc,'next')){nc=1;la.setPagingAction('click_next');}else if(ha.byClass(mc,'prev')){nc=-1;la.setPagingAction('click_prev');}else if(ha.byClass(mc,'down')){oc=true;la.setPagingAction('click_down');}else if(ha.byClass(mc,'up')){oc=false;la.setPagingAction('click_up');}else if(pc=ha.byClass(mc,'seek')){var qc=l.get(pc,'seek-fbid');nc=this.stream.getRelativeMovement(qc);la.setPagingAction('seek');}else if(!this.stagePagerPrev){nc=1;la.setPagingAction('click_stage');}else{nc=-1;la.setPagingAction('click_stage_back');}var rc=o.scry(this.ufiForm,'input.mentionsHidden'),sc=false;for(var tc=0;tc<rc.length;tc++)if(!x.isEmpty(rc[tc])){sc=true;break;}if(sc||k.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,nc));}else{this.page(nc,ib.chrome()&&t.isFullScreen());this._previousZoomScrollPercent=null;}if(null!==oc)this._loadNextItem(oc);};kc.prototype.warnLeavePage=function(lc){'use strict';new m().setTitle(s._("Are You Sure You Want To Leave This Page?")).setBody(s._("You have unsaved changes that will be lost if you leave the page.")).setButtons([{name:'leave_page',label:s._("Leave This Page"),handler:lc},{name:'continue_editing',label:s._("Stay on This Page"),className:'inputaux'}]).setModal(true).show();};kc.prototype.getUsesOpaqueCursor=function(){'use strict';return this.stream.getUsesOpaqueCursor();};kc.prototype.getOpaqueCursor=function(lc){'use strict';return this.stream.getOpaqueCursor(lc);};kc.prototype.setReachedLeftEnd=function(){'use strict';this.stream.setReachedLeftEnd();};kc.prototype.setReachedRightEnd=function(){'use strict';this.stream.setReachedRightEnd();};kc.prototype.page=function(lc,mc,nc){'use strict';if(!this.stream.isValidMovement(lc)||!this.stream.nonCircularPhotoSetCanPage(lc)){this.showPagers(kc.PAGER_FADE);return;}var oc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(lc));if(this.snowflake&&(this.stream.getCursor()==this.firstInSet&&lc<0||this.firstInSet==oc&&lc>0)){this.showPagers(kc.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=lc;var pc=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&pc===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=lc;}else if(pc===-1)oa.fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&oc===this._albumBoundaries.start&&lc===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,mc);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&oc===this._albumBoundaries.end&&lc===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,mc);}else{this.hidePivotSlide();if(lc===-this._albumBoundaries.dir)return;}}var qc=this.getVideoOnStage();if(qc)this.switchVideo(qc,false);if(this.pivots&&this.pivots.page(lc))return;h.inform('PhotoSnowlift.PAGE');cb.hide();this.recacheData();this.stream.moveCursor(lc);k.hide(this.image);if(lc!==0){this.storyID=null;this._updateContainerOwnerID();}if(lc!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(kc.STATE_HTML,true);k.show(this.errorBox);return;}this.movementDelta+=lc;var rc=this.stream.getCurrentImageData();if(rc){var sc=this.getImageURL(rc);if(sc){if(rc.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();u.log(dc.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();u.log(dc.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(sc,null,true);}else if(rc.video)this.switchVideo(rc.video,true,nc);if(!mc){this.replaceUrl=true;xb(rc.info.permalink);}this.setLoadingState(kc.STATE_IMAGE_DATA,false);}else{this.setLoadingState(kc.STATE_IMAGE_PIXELS,true);this.setLoadingState(kc.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(kc.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){k.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)k.addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(pc===-1){oa.fetch(this._albumFBID,this.stream);}else if(pc===0){ta.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}};kc.prototype.showMorePhotos=function(lc,mc){'use strict';if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));k.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new va(na,this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:lc,onclose:this.hideMorePhotos.bind(this),endofalbum:mc||false,withBackground:true});};kc.prototype.hideMorePhotos=function(){'use strict';if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;k.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};kc.prototype.showPivotSlide=function(lc,mc){'use strict';if(this.onExtraSlide)return;this.onExtraSlide=true;k.addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=o.create('div');o.insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=new va(ma,this.pivotSlide);this.pivotSlideComponent.setProps({fbid:lc,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,mc)});};kc.prototype.hidePivotSlide=function(){'use strict';if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});k.removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};kc.prototype.logImpressionDetailsForPhoto=function(){'use strict';var lc=[].concat(o.scry(nb('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),o.scry(nb('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(lc.length===0)return;var mc={};for(var nc=0;nc<lc.length;nc++)mc[lc[nc].name]=lc[nc].value;if(this.getVideoOnStage()){mc.width=0;mc.height=0;}else{var oc=this.getImageDimensions(this.stream.getCurrentImageData());mc.width=oc.x;mc.height=oc.y;}la.addDetailData(this.stream.getCursor(),mc);pa.setIsLogAdData(true);};kc.prototype.loadAds=function(){'use strict';if(this.disableAds)return;pa.loadAdsFromUserActivity();};kc.prototype.transitionHandler=function(lc){'use strict';if(lc.getQueryData().closeTheater||lc.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(lc.getQualifiedURI().toString());ga.transitionComplete(true);return true;}var mc=this._uriStack.length;if(mc>=2&&this._uriStack[mc-2]==lc.getQualifiedURI().toString())this._uriStack.pop();var nc=this.stream.getCursorForURI(lc.getUnqualifiedURI().toString());if(nc){var oc=this.stream.getRelativeMovement(nc);this.page(oc,true);ga.transitionComplete(false);return true;}if(this.isOpen){ga.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};kc.prototype.recacheData=function(){'use strict';if(!this.loadingStates.html){var lc=this.stream.getCurrentHtml();for(var mc in lc){lc[mc]=rb(nb(mc).childNodes);o.empty(nb(mc));}}};kc.prototype.reloadIfTimeout=function(){'use strict';if(!w.hasLoaded(this.image)){var lc=this.makeNewImage(this.image.src,true);r.listen(lc,'load',this.useImage.bind(this,lc,null,true));this._log(lc.src);}};kc.prototype.useImage=function(lc,mc,nc){'use strict';if(nc&&w.hasLoaded(this.image))return;o.replace(this.image,lc);this.image=lc;this.adjustStageSize(mc);};kc.prototype.makeNewImage=function(lc,mc){'use strict';if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!mc)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),kc.LOADING_TIMEOUT);var nc=o.create('img',{className:'spotlight',alt:''});nc.setAttribute('aria-describedby','fbPhotosSnowliftCaption');nc.setAttribute('aria-busy','true');var oc=(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}).bind(this);r.listen(nc,'load',oc);this._log(lc);nc.src=lc;return nc;};kc.prototype.switchImage=function(lc,mc,nc){'use strict';k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var oc=this.stream&&this.stream.getCurrentImageData();if(oc){la.addPhotoView(oc.info,this.shouldShowHiRes(oc),this.fullscreen&&t.isFullScreen());if(this._showHover){var pc=this.stream.getCurrentExtraData();if(pc)ta.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(pc.tagRects));}}this.useImage(this.makeNewImage(lc,false),mc,false);if(nc)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(oc)){la.addPanoramaImpression();var qc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(qc);}else if(this._hasZoomCapability)k.hide(this.showZoomInButton);if(this._isZoomOn)this.switchIntoZoomedImage();h.inform('PhotoSnowlift.SWITCH_IMAGE');};kc.prototype._conditionDisplayZoomInButton=function(){'use strict';if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var lc=new jb(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(lc);}else k.hide(this.showZoomInButton);};kc.prototype._displayZoomInButton=function(lc){'use strict';var mc=parseInt(this.image.style.height,10),nc=(lc.y-mc)/2;if(nc>=kc.ZOOM_BUTTON_TOP_PAD+kc.ZOOM_BUTTON_BOT_PAD+kc.ZOOM_BUTTON_HEIGHT){var oc=nc-kc.ZOOM_BUTTON_HEIGHT-kc.ZOOM_BUTTON_TOP_PAD;bb.set(this.showZoomInButton,'bottom',oc+'px');}else bb.set(this.showZoomInButton,'bottom','60px');k.show(this.showZoomInButton);};kc.prototype._isZoomAvailable=function(lc){'use strict';if(typeof lc==="undefined")lc=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!lc||!lc.originalDimensions)return false;var mc=new jb(this.stage.clientWidth,this.stage.clientHeight),nc=lc.originalDimensions,oc=nc.x/nc.y,pc=Math.min(mc.y*oc,nc.x);if(!isNaN(oc)&&oc>2&&nc.y>kc.MIN_PANORAMA_Y&&mc.x*kc.MIN_PANO_TO_STAGE_RATIO<pc){return true;}else return false;};kc.prototype._setZoomIn=function(){'use strict';this._isZoomOn=true;k.hide(this.showZoomInButton);k.hide(this.stageActions);k.show(this.showZoomOutButton);bb.set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(aa);this.collapseRHC();};kc.prototype._setZoomOut=function(){'use strict';if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(aa);bb.set(this.stage,'overflow','visible');k.hide(this.showZoomInButton);k.hide(this.showZoomOutButton);k.hide(this.zoomedImage);k.hide(this.outerImageSlider);k.show(this.stageActions);this.uncollapseRHC();};kc.prototype.switchIntoZoomedImage=function(lc){'use strict';this._setZoomIn();k.hide(this.zoomedImage);k.hide(this.outerImageSlider);var mc=this.stream.getCurrentImageData(),nc=mc.originalDimensions;this.zoomedImage.src=mc.url;this.adjustStageSize(nc);this._initializeZoomedImagePositions(new jb(parseInt(bb.get(this.zoomedImage,'width'),10),parseInt(bb.get(this.zoomedImage,'height'),10)));k.hide(this.image);};kc.prototype._adjustInnerImageSlider=function(lc){'use strict';var mc=this.stage.clientWidth,nc=Math.min(100,mc/lc.x*100);bb.set(this.innerImageSlider,'width',nc+'%');return nc;};kc.prototype._getSliderSizeForZoomedImage=function(lc){'use strict';var mc=kc.MAX_SLIDER_HEIGHT*this.stage.clientHeight/lc.y,nc=kc.MAX_SLIDER_WIDTH*this.stage.clientWidth/lc.x,oc=Math.min(mc,nc);return new jb(100*lc.x*oc/this.stage.clientWidth,100*lc.y*oc/this.stage.clientHeight);};kc.prototype._initializeZoomedImagePositions=function(lc){'use strict';this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var mc=this._getSliderSizeForZoomedImage(lc);bb.set(this.outerImageSlider,'width',mc.x+'%');bb.set(this.outerImageSlider,'height',mc.y+'%');bb.set(this.outerImageSlider,'left',50-mc.x/2+'%');bb.set(this.showZoomOutButton,'bottom',mc.y*this.stage.clientHeight/100+parseInt(bb.get(this.outerImageSlider,'bottom'),10)+20+'px');k.show(this.zoomedImage);k.show(this.outerImageSlider);};kc.prototype._zoomedImageMouseDown=function(event){'use strict';if(!this._isZoomOn)return;k.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var lc=false,mc=event.getTarget();if(ha.byClass(mc,"_10zv")){this.startSliderMargins=new jb(parseFloat(bb.get(this.innerImageSlider,'marginLeft')),parseFloat(bb.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new jb(event.clientX,event.clientY);}else if(ha.byClass(mc,"_10zx")){this.startSliderMargins=new jb(parseInt(bb.get(this.innerImageSlider,'marginLeft'),10),parseInt(bb.get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var nc=parseInt(bb.get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new jb(this.innerImageSlider.getBoundingClientRect().left+nc/2,event.clientY);lc=true;}else if(ha.byClass(mc,"_10zw")){this.startImageMargins=new jb(parseInt(bb.get(this.zoomedImage,'marginLeft'),10),parseInt(bb.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new jb(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=r.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(lc){this._zoomedImagePan(event);}else event.kill();};kc.prototype._zoomedImageMouseUp=function(event){'use strict';if(this._zoomedImageMouseMoveHandle){k.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var lc=parseFloat(bb.get(this.zoomedImage,'marginLeft')),mc=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=lc/mc;}};kc.prototype._zoomedImagePan=function(event){'use strict';var lc;if(this.startSliderMargins){lc=event.clientX-this.mouseDownStartPosition.x;var mc=parseFloat(bb.get(this.outerImageSlider,'width')),nc=parseFloat(bb.get(this.innerImageSlider,'width')),oc=Math.max(0,Math.min(mc-nc,this.startSliderMargins.x+lc))/mc;bb.set(this.innerImageSlider,'marginLeft',100*oc+"%");bb.set(this.zoomedImage,'marginLeft',-1*oc*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){lc=1.75*(this.mouseDownStartPosition.x-event.clientX);var pc=Math.min(0,Math.max(this.startImageMargins.x-lc,-this.zoomedImage.width+this.stage.clientWidth));bb.set(this.zoomedImage,'marginLeft',pc+'px');bb.set(this.innerImageSlider,'marginLeft',-pc/this.zoomedImage.width*100+"%");event.kill();}};kc.prototype._scrollZoomedImageToPercent=function(lc){'use strict';if(lc===undefined||lc===null)lc=.5;var mc=new jb(parseInt(bb.get(this.zoomedImage,'width'),10),parseInt(bb.get(this.zoomedImage,'height'),10));bb.set(this.innerImageSlider,'marginLeft',(100-this._adjustInnerImageSlider(mc))*lc+'%');bb.set(this.zoomedImage,'marginLeft',(this.stage.clientWidth-mc.x)*lc+'px');};kc.prototype._preloadNextVideo=function(){'use strict';var lc=this.stream.calculatePositionForMovement(1),mc=this.stream.getCursorAt(lc),nc=this.stream.getImageData(mc);if(nc&&nc.video)nc.controller.preload();};kc.prototype.switchVideo=function(lc,mc,nc){'use strict';this._pauseVideoIfNeeded();var oc='swf_'+lc;o.empty(this.videoStage);if(mc){this._preloadNextVideo();k.addClass(this.stageWrapper,'showVideo');var pc=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){k.hide(this.nextPager);k.hide(this.prevPager);}var qc=pc.video_element;o.scry(qc,"._ox1")[0].style.cssText='';var rc=null;if(this.pivotsCarouselElement)rc=p.scry(this.pivotsCarouselElement,"._32_l");if(rc)rc.forEach((function(vc){var wc=vc.getAttribute('data-fbid'),xc=this.stream.getCursor(),yc=o.find(vc,"._1pqn");if(wc===xc){k.show(yc);}else k.hide(yc);}).bind(this));k.addClass(qc,'videoStageContainer');o.appendContent(this.videoStage,qc);o.appendContent(this.videoStage,this.pivotsCarouselElement);if(window[oc]&&!vb(oc))window[oc].write(lc);var sc='video_warning_'+lc,tc=vb(lc);if(!this.videoWarnings)this.videoWarnings=[];if(tc&&this.videoWarnings[sc])o.setContent(tc,this.videoWarnings[sc]);this._videoPlayerStateManager=pc.controller;this._videoPlayerStateManager.reset();this._videoPlayerStateManager.collectFeedTrackingData();if(this._autoplayVideos){var uc=nc||lb.USER;this._videoPlayerStateManager.play(uc);}if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',(function(){var vc=pc.info.fbid.toString();if(this.haltAutoplay&&vc!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var wc=this.autoplayOptionScreenConfig.controller;wc.registerCallbacks(qc,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,pc));}}else this.handleAutoplay(pc);}).bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,lc),0);}else{window[oc]&&window[oc].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);k.removeClass(this.stageWrapper,'showVideo');}};kc.prototype.removeAutoplayOptionScreen=function(){'use strict';if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf();};kc.prototype.chooseToReplayVideo=function(lc){'use strict';lc.play(lb.USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false;};kc.prototype.handleAutoplay=function(lc){'use strict';var mc=lc.info.fbid.toString();if(mc===this.stream.getCursor()&&mc!==this.stream.fbidList[this.stream.fbidList.length-1]){za.adjustCarouselOnAutoPlay();this.page(1,false,lb.AUTOPLAY);}this.removeAutoplayOptionScreen();this.haltAutoplay=false;};kc.prototype.checkVideoStatus=function(lc){'use strict';if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var mc=this.getVideoOnStage();if(!mc){return;}else{if(mc!==lc)return;this.adjustStageSizeForVideo(lc);}};kc.prototype.getVideoSize=function(lc){'use strict';return new jb(lc.getAttribute('data-video-width'),+lc.getAttribute('data-video-height')+this.getVideoComponentsHeight(lc));};kc.prototype.getVideoElement=function(lc){'use strict';return o.scry(this.videoStage,"._ox1")[0];};kc.prototype.getVideoComponentsHeight=function(lc){'use strict';var mc=0,nc=ha.byClass(lc,"_1c_u");if(!nc)return 0;var oc=o.scry(nc,"._2i84");if(oc.length){var pc=oc[0].getBoundingClientRect();mc=pc.bottom-pc.top;}return mc;};kc.prototype.adjustStageSizeForVideo=function(lc){'use strict';var mc=this.getVideoElement(lc);if(!mc){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,lc),200);}else this.adjustStageSize(this.getVideoSize(mc));};kc.prototype.handleServerError=function(lc,mc){'use strict';o.setContent(this.errorBox,lc);this.storeFromData(mc);};kc.prototype.fixButtonText=function(lc){'use strict';if(!this.buttonTruncateGk)return;var mc=o.scry(lc,".photosTruncatingUIButton"),nc=parseInt(bb.get(lc,'width'),10);if(nc>ic){var oc={tagPhoto:s._("Tag Photo"),doneTagPhoto:s._("Done Tagging"),addLocation:s._("Add Location"),editPhoto:s._("Edit")};for(var pc=0;pc<mc.length;pc++){var qc=mc[pc];k.addClass(qc,"_2n0k");db.set(qc,oc[qc.getAttribute('data-buttonname')],'below','center');}}};kc.prototype.swapData=function(){'use strict';var lc,mc=this.stream.getCurrentHtml();if(mc){this.setLoadingState(kc.STATE_HTML,false);for(var nc in mc){lc=vb(nc);lc&&o.setContent(lc,mc[nc]);}var oc=vb('photosTruncatingUIButtonGroup');oc&&this.fixButtonText(oc);h.inform('PhotoSnowlift.DATA_CHANGE',Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),h.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())h.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),h.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};kc.prototype.updateTotalCount=function(lc,mc,nc){'use strict';var oc=this.stream.getCurrentHtml();if(oc){var pc=nb('fbPhotoSnowliftPositionAndCount');o.replace(pc,nc);pc=nc;k.show(pc);var qc='fbPhotoSnowliftPositionAndCount';oc[qc]=rb(pc.childNodes);}this.stream.setTotalCount(lc);this.stream.setFirstCursorIndex(mc);};kc.prototype.addPhotoFbids=function(lc,mc,nc,oc){'use strict';if(oc&&this.sessionID&&oc!=this.sessionID)return;var pc=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(lc,mc,nc);if(nc&&pc)this.page(0,true);if(this.pivots&&nc)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;k.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var qc=this.stream.getCursor(),rc=this.stream.calculateDistance(qc,this._mediaFBID);this.stream.moveCursor(rc);}};kc.prototype.attachTagger=function(lc,mc){'use strict';o.appendContent(this.stageActions,lc);if(mc)mc.setTokenarea(this.taglist);};kc.prototype.storeFromData=function(lc){'use strict';if(!this.isOpen)return;if(lc.pivots)this.pivotsCarouselElement=lc.pivots;if(lc.autoplay_option_screen_config){this.autoplayOptionScreenConfig=lc.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription();}this.shouldRenderVideoPivots=lc.should_render_pivots;if(lc.ssid&&this.sessionID&&this.sessionID!=lc.ssid)return;var mc=this.stream.storeToCache(lc);if('error' in mc){this.checkState(kc.STATE_ERROR);return;}if('init' in lc){if(this.shouldRenderVideoPivots)this._videoSameAsSource=lc.init.videoSameAsSource;this._mediaFBID=lc.init.fbid;this._albumFBID=lc.init.album_fbid;this._isAlbum=lc.init.is_album;this._albumOwnerName=lc.init.album_owner_name;this._autoplayVideos=lc.init.autoplay_videos;this._autoplayNextVideo=lc.init.autoplay_next_video;}else this._preloadNextVideo();if('init' in mc){this.initDataFetched(mc.init);if(this.openExplicitly){this.replaceUrl=true;xb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();}if('image' in mc)this.checkState(kc.STATE_IMAGE_DATA);if('data' in mc)this.checkState(kc.STATE_HTML);};kc.prototype.setLeftAndRightPagersState=function(){'use strict';if(this.stream.isNonCircularPhotoSet()){k.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));k.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){k.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var lc=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));k.conditionClass(this.root,'disableRight',lc==this.firstInSet);}};kc.prototype.setStagePagersState=function(lc){'use strict';switch(lc){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this._setupNextItemUI();return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}};kc.prototype.deletePhoto=function(lc){'use strict';this.closeRefresh();};kc.prototype.closeRefresh=function(){'use strict';this.refreshOnClose=true;this.spotlight.hide();};kc.prototype.onHiliteTag=function(lc,mc){'use strict';if(mc.version!=ka.VIEWER_SNOWLIFT)return;var nc=mc.tag;if(nc)this.switchHilitedTags(nc,true);};kc.prototype.onUpdateTagBox=function(lc,mc){'use strict';if(mc.version==ka.VIEWER_SNOWLIFT)this.updateTagBox(mc.id,mc.approve);};kc.prototype._log=function(lc){'use strict';if(this._shouldLog){this._logger&&this._logger.log(lc);return true;}return false;};kc.prototype._enableMouseOver=function(){'use strict';this._disableMouseOver=false;};kc.prototype._interceptMouseOver=function(event){'use strict';if(this._disableMouseOver)event.kill();};kc.prototype.isReturningToStart=function(){'use strict';return !!this.returningToStart;};kc.prototype._pauseVideoIfNeeded=function(){'use strict';if(this._videoPlayerStateManager){this._videoPlayerStateManager.pause('unloaded');if(mb.canAbort)this._videoPlayerStateManager.abortLoading();}};kc.getInstance=function(){'use strict';if(!kc._instance)kc._instance=new kc();return kc._instance;};kc.initWithSpotlight=function(lc,mc){'use strict';kc.getInstance().init(lc,mc);};kc.addPhotoFbids=function(lc,mc,nc,oc){'use strict';kc.getInstance().addPhotoFbids(lc,mc,nc,oc);};kc.setReachedLeftEnd=function(){'use strict';kc.getInstance().setReachedLeftEnd();};kc.setReachedRightEnd=function(){'use strict';kc.getInstance().setReachedRightEnd();};kc.attachFollowFlyout=function(lc){'use strict';o.insertAfter(nb('fbPhotoSnowliftSubscribe'),lc);};kc.attachSubscribeFlyout=function(lc){'use strict';o.insertAfter(nb('fbPhotoSnowliftSubscribe'),lc);};kc.attachTagger=function(lc,mc){'use strict';kc.getInstance().attachTagger(lc,mc);};kc.preload=function(lc,mc){'use strict';kc.getInstance().preload(lc,mc);};kc.bootstrap=function(lc,mc){'use strict';var nc=lc&&new hb(lc).getQueryData();if(nc&&nc.hasOwnProperty('share_id')){j.loadModules(["SpotlightShareViewer"],function(oc){oc.bootstrap(lc,mc);});return;}kc.getInstance().bootstrap(lc,mc);};kc.closeRefresh=function(){'use strict';kc.getInstance().closeRefresh();};kc.deletePhoto=function(lc){'use strict';kc.getInstance().deletePhoto(lc);};kc.getImage=function(){'use strict';return kc.getInstance().getImage();};kc.getImageId=function(){'use strict';return kc.getInstance().getImageId();};kc.getLoadQuery=function(){'use strict';return kc.getInstance().getLoadQuery();};kc.getRHCBody=function(){'use strict';return kc.getInstance().getRHCBody();};kc.getRHCFooter=function(){'use strict';return kc.getInstance().getRHCFooter();};kc.getRHCHeader=function(){'use strict';return kc.getInstance().getRHCHeader();};kc.getRoot=function(){'use strict';return kc.getInstance().getRoot();};kc.likePhotoSkipConfirmation=function(lc){'use strict';kc.getInstance().likePhotoSkipConfirmation(lc);};kc.saveTagsFromPayload=function(lc){'use strict';kc.getInstance().saveTagsFromPayload(lc);};kc.saveTagsFromPayloadDelayed=function(lc){'use strict';setTimeout(kc.saveTagsFromPayload.bind(null,lc),2000);};kc.handleServerError=function(lc,mc){'use strict';kc.getInstance().handleServerError(lc,mc);};kc.setVideoWarning=function(lc,mc){'use strict';var nc=kc.getInstance(),oc='video_warning_'+lc;if(!nc.videoWarnings)nc.videoWarnings=[];nc.videoWarnings[oc]=mc;};kc.storeFromData=function(lc){'use strict';kc.getInstance().storeFromData(lc);};kc.swapData=function(){'use strict';kc.getInstance().swapData();};kc.updateTotalCount=function(lc,mc,nc){'use strict';kc.getInstance().updateTotalCount(lc,mc,nc);};kc.setVideoRotateURI=function(lc){'use strict';kc.getInstance().videoRotateURI=lc;};Object.assign(kc,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},COVER_PHOTO_BUTTON_WIDTH:130,PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:ub,touchMarkup:ub,PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE:100,PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:70,PRODUCT_ITEM_PAGER_HEIGHT:21,PRODUCT_ITEM_PAGER_MARGIN:20});Object.assign(kc.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:kc.STAGE_NORMAL_MAX,stageChrome:kc.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});f.exports=kc;},null);
__d("XPhotosSnowliftProfilePicXOutAsyncController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/profilepic\/xout\/",{});},null,{});