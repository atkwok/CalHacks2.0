/*!CK:58535038!*//*1444314399,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rH0qu"]); }

__d('InteractionLogger',['Arbiter','Banzai','Event','PageEvents'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m,n){n=n||{};this.profiler={};this.log={};this.lastInteraction=Date.now();this.interactionTime=0;this.eventSequence=[];this.projectName=m;if(n.trackInteractionTime)j.listen(document.body,'mousemove',this._pingActive.bind(this));if(n.submitOnLeave||n.submitOnLeave===undefined)this.arbiterToken=h.subscribe(k.AJAXPIPE_ONUNLOAD,(function(){this.submit();this.arbiterToken.unsubscribe();}).bind(this));}Object.assign(l,{IDLE_LIMIT:20000});Object.assign(l.prototype,{set:function(m,n){this.log[m]=n;},tap:function(m){this.eventSequence.push(m);},bump:function(m,n){if(n===undefined)n=1;this.log[m]=(this.log[m]||0)+n;},bumpTap:function(m,n){this.tap(m);this.bump(m,n);},startRun:function(m){if(!this.profiler[m])this.profiler[m]={average:0,count:0};this.profiler[m].start=+new Date();},endRun:function(m){if(!this.profiler[m]||!this.profiler[m].start)return;this._recordRun(m,new Date()-this.profiler[m].start);this.profiler[m].start=null;},getLog:function(){this._updateLog();return this.log;},submit:function(){this._updateLog();i.post(this.projectName,this.log);},_pingActive:function(){var m=Date.now(),n=m-this.lastInteraction;if(n<l.IDLE_LIMIT)this.interactionTime+=n;this.lastInteraction=m;},_updateLog:function(){for(var m in this.profiler){this.log[m+'-count']=this.profiler[m].count;this.log[m+'-average']=this.profiler[m].average;}if(this.interactionTime)this.log['interaction-time']=this.interactionTime;if(this.eventSequence.length)this.log['event-sequence']=this.eventSequence;},_recordRun:function(m,n){var o=this.profiler[m];o.average=(o.average*o.count+n)/(o.count+1);o.count++;}});f.exports=l;},null);
__d('MapPager',['ArbiterMixin','Event','mixin'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;k=babelHelpers.inherits(m,j(h));l=k&&k.prototype;function m(n,o){'use strict';l.constructor.call(this);i.listen(n,'click',this.inform.bind(this,'previous'));i.listen(o,'click',this.inform.bind(this,'next'));}f.exports=m;},null);
__d('TimelineMapFilter',['Arbiter','CSS','DOM','Event','NumberFormatConfig','PageTransitions','ProfileTabConst','StickyPlaceholderInput','TimelineURI','$','cx','ads-lib-formatters','ge','tidyEvent'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v='pagelet_timeline_medley_map';function w(y){return p.getTabKeyFromURI(y)===n.MAP;}function x(){}Object.assign(x.prototype,{init:function(y,z,aa,ba,ca){this._classes={count:"_3d0",filter:"_3c_",selected:"_3s-",text:"_3sz"};this.catNames=[];this.catIndex=0;this.categoryButtons=[];this.mapController=y;this.stickies=z||[];this.tagUnit=t('fbTimelineMapTagUnit');this.tagUnitInited=false;this.mapID=aa;this.pluralMap=ba;this.initialCatName=ca;var da={},ea,fa;for(ea=0;ea<this.stickies.length;ea++){fa=this.stickies[ea].name[2];da[fa]=this.stickies[ea].countOnlyUnique;this.categoryButtons[ea]=this.stickies[ea].buttonID&&t(this.stickies[ea].buttonID);if(this.categoryButtons[ea])k.listen(this.categoryButtons[ea],'click',this.handleTabClick.bind(this,ea));}this.mapController.setCategoryCountUnique(da);u([h.subscribe('TimelineMap/updateCategories',this.updateCategories.bind(this))]);},setCategory:function(y){this.mapController.setCategory(this.catNames[y]);var z=q(v),aa=j.scry(z,'.fbTimelineStickyHeaderPlaceComposer input.skiptowant')[0];if(aa)aa.setAttribute('value',this.stickies[y].name.skip_to_want);var ba=j.scry(z,'.fbTimelineStickyHeaderPlaceComposer div.uiStickyPlaceholderInput')[0];if(ba)o.setPlaceholderText(ba,this.stickies[y].name.placeholder);var ca=j.scry(z,'div.'+"_4_zv")[0];if(ca)j.setContent(ca,this.stickies[y].name.section_title);},handleTabClick:function(y,z){var aa=m.getCurrentURI().getUnqualifiedURI();z&&!z.isDefaultRequested()&&z.prevent();if(w(aa)&&this.stickies[y].uri)m.rewriteCurrentURI(aa,this.stickies[y].uri);this.setCategory(y);this.mapController.zoomToVisible();},setFilter:function(y,z,aa,ba,ca){var da=this.categoryButtons[y];if(!da)return;var ea=aa||0;if(ea>=200)ea=ea%100+100;ea=z[this.pluralMap[ea]];this.catNames[y]=z[2];j.setContent(j.find(da,'.'+this._classes.text),ea);if(aa){j.setContent(j.find(da,'.'+this._classes.count),s.formatNumber(aa,0,l.numberDelimiter,''));}else j.empty(j.find(da,'.'+this._classes.count));i.conditionClass(da.firstChild,ba,!!ba);if(ca)da.setAttribute('href',ca);i.show(da);},updateCategories:function(y,z){if(z._instanceid!==this.mapID)return;var aa=this.mapController.getCategories(),ba=this.catNames[this.catIndex]||this.initialCatName;this.catNames=[];var ca=0;for(var da=0;da<this.stickies.length;da++){var ea=this.stickies[da],fa=ea.name,ga=0,ha=ea.domClass,ia=fa[2];if(aa[ia]){ga=aa[ia].count;delete aa[ia];}if(ea.showWhenZero||ga!==0){this.setFilter(ca,fa,ga,ha,ea.uri);ca++;}}var ja=[];for(var ka in aa)ja.push(aa[ka]);ja=ja.sort(function(oa,pa){return pa.count-oa.count;});for(var la=0;la<this.categoryButtons.length-ca;la++){var ma=ja[la];if(ma){this.setFilter(la+ca,ma.name,ma.count);}else i.hide(this.filters[la+ca]);}if(ba){this.initialCatName=null;var na=this.catNames.indexOf(ba);if(na!=-1){this.setCategory(na);}else this.setCategory(0);}}});Object.assign(x,{init:function(){var y=new x();y.init.apply(y,arguments);}});f.exports=x;},null);
__d('TimelineMapStickyHeaderComposer',['Arbiter','AsyncRequest','Bootloader','CSS','$','bind','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(){h.subscribe('TimelineMapStickyHeaderComposer/showPhotoTagUnit',this.showPhotoTagUnit.bind(this));h.subscribe('TimelineMapStickyHeaderComposer/hidePhotoTagUnit',this.hidePhotoTagUnit.bind(this));}Object.assign(o.prototype,{initPlaceTypeahead:function(p){p.subscribe('focus',(function(){j.loadModules(["TimelineMLE"],function(q){q.hideFlyout();});h.inform('TimelineMapStickyHeaderComposer/typeaheadFocus');}).bind(this));p.subscribe('blur',(function(){h.inform('TimelineMapStickyHeaderComposer/typeaheadBlur');}).bind(this));p.subscribe('select',(function(){h.inform('TimelineMapStickyHeaderComposer/typeaheadSelect');}).bind(this));},showPhotoTagUnit:function(p,q){this.tagUnit=l('fbTimelineMapTagUnit');k.show(this.tagUnit);var r=n('mainContainer');r&&k.addClass(r,'photoTaggingMode');if(!this.tagUnitInited){this.tagUnitInited=true;this.indicator=l('fbTimelineMapAddPhotoLoading');k.show(this.indicator);var s=q?q.sid:null;new i().setURI('/ajax/timeline/map/photo_strip.php').setData({div_id:'fbTimelineMapTagUnit',sid:s}).setReadOnly(true).setHandler(m(this,'_onLoadPhotoStrip')).send();}else this._onLoadPhotoStrip();},hidePhotoTagUnit:function(){this.tagUnit=l('fbTimelineMapTagUnit');k.hide(this.tagUnit);var p=n('mainContainer');p&&k.removeClass(p,'photoTaggingMode');},_onLoadPhotoStrip:function(){k.hide(this.indicator);}});f.exports=o;},null);
__d('legacy:TimelineMapStickyHeaderComposer',['TimelineMapStickyHeaderComposer'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.TimelineMapStickyHeaderComposer=c('TimelineMapStickyHeaderComposer');},3);
__d('TypeaheadTimelineHighlightMapPlace',['Arbiter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){this._typeahead=j;}Object.assign(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['reset','select','highlight'],function(j,k){if(j==='highlight'&&k.index!==-1&&k.selected.type!='freeform'&&k.selected.latitude&&k.selected.longitude&&!k.selected.changeCity&&k.index!=this.lastDataIdx){var l=k.selected.place_type=='city'?10:15;h.inform('TimelineMap/highlightMapPlace',{placeID:k.selected.uid,center:{latitude:k.selected.latitude,longitude:k.selected.longitude},zoom:l});}else if(j==='highlight'&&k.index==-1){h.inform('TimelineMap/highlightMapPlace',{dismiss:true});}else if(j==='select'){h.inform('TimelineMap/highlightMapPlace',{selected:true});}else if(j==='reset')h.inform('TimelineMap/highlightMapPlace',{dismiss:true});this.lastDataIdx=k&&k.index;});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});f.exports=i;},null);
__d('TypeaheadTimelineShowThrobberOnSelect',['Arbiter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){this._typeahead=j;}Object.assign(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['select'],function(j,k){h.inform('TimelineMap/highlightMapPlace',{showThrobber:true});});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});f.exports=i;},null);
__d('legacy:TimelineMapPlaceTypeaheadBehaviors',['TypeaheadTimelineHighlightMapPlace','TypeaheadTimelineShowThrobberOnSelect'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();if(!b.TypeaheadBehaviors)b.TypeaheadBehaviors={};b.TypeaheadBehaviors.highlightMapPlace=function(j){j.enableBehavior(h);};b.TypeaheadBehaviors.showThrobberOnSelect=function(j){j.enableBehavior(i);};},3);
__d('PlacesAppAddPlacesCuration',['Arbiter','TimelineAppSectionCuration'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={registerContent:function(k){i.register(k,function(l,m,n){h.inform('TimelineMapStickyHeaderComposer/showPhotoTagUnit');n.unsubscribe();});}};f.exports=j;},null);
__d('TimelineLifeEventPhotoPreviewGrid',['ActorURI','AsyncUploadRequest','AsyncRequest','Bootloader','CSS','DOM','FileInputUploader','Parent','ProgressBar','SortableGroup','TimelineLifeEventPhotoConfig','fbt','Button','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=1,w=2,x=3,y=[null,'mleOnePhoto','mleTwoPhotos','mleManyPhotos'];function z(da,ea,fa,ga){'use strict';this._container=da;this._containerID=da.id;this._grid=ea;this._photoLimit=fa;this._profileID=ga;this._progressBarMarkup=r.progressBarMarkup;this._loadingIndicators=[];this._pendingPhotoRequests=0;this._photoDisplayType=0;this._tempPhotoRef=[];this._saveButton=m.find(this._container,"._5mlk");if(!r.enableDrag)return;this._sortableGroup=new q().setGrabCallback(ba).setDropCallback(ca);var ha=m.scry(ea,'.mlePhotoPreviewThumb');for(var ia=0;ia<ha.length;ia++)this._bindPhoto(ha[ia]);this._updatePhotoDisplayType(ha.length);}z.prototype.destroy=function(){'use strict';this._sortableGroup&&this._sortableGroup.destroy();};z.prototype._getNumPhotos=function(){'use strict';return m.scry(this._grid,'.mlePhotoPreviewThumb').length+m.scry(this._grid,'.mlePhotoPlaceholder').length;};z.prototype._getPhotoType=function(da){'use strict';switch(da){case 0:case 1:return v;case 2:return w;default:if(da<0||da>this._photoLimit)throw new Error('invalid number of photos');return x;}};z.prototype._updatePhotoDisplayType=function(da){'use strict';var ea=y[this._photoDisplayType];ea&&l.removeClass(this._container,ea);this._photoDisplayType=this._getPhotoType(da);l.addClass(this._container,y[this._photoDisplayType]);};z.prototype._updateAddMorePhotosClass=function(){'use strict';if(this._pendingPhotoRequests>0){l.addClass(m.find(this._container,'.mleAddMorePhotoButtons'),'disabled');}else l.removeClass(m.find(this._container,'.mleAddMorePhotoButtons'),'disabled');};z.prototype._updatePhotos=function(da,ea){'use strict';var fa=ea,ga=[],ha=this._photoDisplayType;this._updatePhotoDisplayType(da);if(this._photoDisplayType!==ha){var ia=m.scry(this._grid,'.mlePhotoPreviewThumb');for(var ja=0;ja<ia.length;ja++){var ka=m.find(ia[ja],'.mlePhotoPreviewInput').value;ga.push(ka);if(this._photoDisplayType===x||ha===x){this._unbindPhoto(ia[ja]);m.remove(ia[ja]);this.createPlaceholder(ka);}else{l.addClass(ia[ja],'photoLoading');l.hide(m.find(ia[ja],'.detachPhotoIcon'));l.show(m.find(ia[ja],'.photoLoadingSpinner'));this._unbindPhoto(ia[ja]);this._tempPhotoRef[ka]=ia[ja];}}}var la=fa.concat(ga);if(la.length>0){this._pendingPhotoRequests+=la.length;if(this._photoDisplayType!==x)this._updateAddMorePhotosClass();var ma=h.create('/ajax/timeline/mle_photo_select.php',this._profileID);new j().setURI(ma).setData({display_elem:this._containerID,existing_image_ids:ga,field_name:'photos',image_ids:fa,profile_id:this._profileID,total_photos:da}).setMethod('POST').send();}};z.prototype._bindPhoto=function(da){'use strict';this._sortableGroup&&this._sortableGroup.addSortable(m.find(da,'input').getAttribute('value'),da);};z.prototype._unbindPhoto=function(da){'use strict';this._sortableGroup&&this._sortableGroup.removeSortable(m.find(da,'input').getAttribute('value'));};z.prototype.filterPhotoClick=function(event){'use strict';if(this._pendingPhotoRequests>0&&this._photoDisplayType!=x)event.kill();};z.prototype.attachPhoto=function(da,ea){'use strict';if(!this._loadingIndicators[ea]&&!this._tempPhotoRef[ea])return;if(this._tempPhotoRef[ea]){m.replace(this._tempPhotoRef[ea],da);this._bindPhoto(da);delete this._tempPhotoRef[ea];}else{var fa=this._loadingIndicators[ea].getRoot();if(o.byTag(fa,'body')){m.replace(fa,da);this._bindPhoto(da);}delete this._loadingIndicators[ea];}if(--this._pendingPhotoRequests===0)this._updateAddMorePhotosClass();};z.prototype.detachPhoto=function(da){'use strict';if(this._pendingPhotoRequests>0)return;this._unbindPhoto(da);m.remove(da);var ea=this._getNumPhotos();this._updatePhotos(ea,[]);if(ea===0){l.show(m.find(this._container,'.mlePhotoButtons'));l.hide(m.find(this._container,'.mleAddMorePhotoButtons'));}else if(ea===this._photoLimit-1)l.show(m.find(this._container,'.mleAddMorePhotoButtons'));};z.prototype.createPlaceholder=function(da){'use strict';var ea=this._progressBarMarkup.cloneNode(true);ea=m.appendContent(this._grid,ea)[0];this._loadingIndicators[da]=new p(ea);return ea;};z.prototype.addPhotos=function(da){'use strict';var ea=this._getNumPhotos(),fa=da.length,ga=ea+fa;if(ga>this._photoLimit){var ha=s._("The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again.",[s.param('limit',this._photoLimit)]);k.loadModules(["Dialog"],(function(ka){new ka().setTitle(s._("Too Many Photos")).setBody(ha).setButtons(ka.OK).setCausalElement(this._container).show();}).bind(this));return;}if(ga===this._photoLimit)l.hide(m.find(this._container,'.mleAddMorePhotoButtons'));var ia=da.slice(0,fa);this._updatePhotos(ga,ia);for(var ja=0;ja<fa;ja++)this.createPlaceholder(da[ja]);};z.prototype.destroyPlaceholder=function(da){'use strict';if(!this._loadingIndicators[da])return;m.remove(this._loadingIndicators[da].getRoot());delete this._loadingIndicators[da];};z.prototype.initUploader=function(da,ea){'use strict';var fa=da.getInput();fa.multiple=i.isSupported();da.subscribe('change',this._uploadPhotos.bind(this,fa,ea));};z.prototype._setSaveButtonEnabled=function(da){'use strict';t.setEnabled(this._saveButton,da);};z.prototype._uploadPhotos=function(da,ea){'use strict';l.hide(m.find(this._container,'.mlePhotoButtons'));l.show(m.find(this._container,'.mleAddMorePhotoButtons'));var fa=this._getNumPhotos(),ga=da.files?da.files.length:1,ha=fa+ga;if(ha>this._photoLimit){var ia=s._({"*":"The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again."},[s.param('limit',this._photoLimit,[0])]);k.loadModules(["Dialog"],(function(na){new na().setTitle(s._("Too Many Photos")).setBody(ia).setButtons(na.OK).setCausalElement(this._container).show();}).bind(this));aa(da);return;}var ja,ka;for(var la=0;la<ga;la++){ka=da.files?da.files[la].name:da.value.split('\\').pop();ja=this.createPlaceholder(ka);}this._updatePhotos(ha,[]);ea.uploadData.total_photos=ha;if(this._photoDisplayType!=x)this._pendingPhotoRequests+=ga;var ma=new n(da).setURI(ea.uploadURI).setData(ea.uploadData).setAllowCrossOrigin(true).setUploadInParallel(true);ma.subscribe('progress',this._onProgress.bind(this));ma.subscribe('success',this._onSuccess.bind(this));ma.subscribe('failure',this._onFailure.bind(this,ka));ma.send();this._setSaveButtonEnabled(false);aa(da);};z.prototype._onProgress=function(da,ea){'use strict';var event=ea.event,fa=this._loadingIndicators[ea.upload.getFile().name];l.hide(m.find(fa.getRoot(),'.mlePhotoLoadingIndicator'));l.show(m.find(fa.getRoot(),'.mlePhotoProgressBar'));if(event.loaded==event.total){fa.setPosition(50);fa.setTarget(100,2000);}else fa.setPosition(50*event.loaded/event.total);};z.prototype._onSuccess=function(da,ea){'use strict';this._setSaveButtonEnabled(true);};z.prototype._onFailure=function(da){'use strict';this.destroyPlaceholder(da);this._setSaveButtonEnabled(true);};function aa(da){da.value='';da.files=null;}function ba(da){l.addClass(da,'dragging');}function ca(da,ea){l.removeClass(ea,'dragging');}f.exports=z;},null);
__d('RelationshipStatusConst',['fbt'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();f.exports={UNDEFINED:0,SINGLE:1,IN_A_RELATIONSHIP:2,OPEN_RELATIONSHIP:3,MARRIED:4,ENGAGED:5,COMPLICATED:6,WIDOWED:7,SEPARATED:8,DIVORCED:9,CIVIL_UNION:10,DOMESTIC_PATNERSHIP:11,isUnilateralStatus:function(i){return (i==this.UNDEFINED||i==this.SINGLE||i==this.SEPARATED);},isSuppressedStatus:function(i){return (i==this.WIDOWED||i==this.SEPARATED||i==this.DIVORCED);},getAnniversaryText:function(i){switch(i){case this.IN_A_RELATIONSHIP:case this.OPEN_RELATIONSHIP:case this.MARRIED:case this.CIVIL_UNION:case this.DOMESTIC_PARTNERSHIP:return h._("Anniversary");case this.DIVORCED:case this.ENGAGED:case this.COMPLICATED:case this.WIDOWED:return h._("Since");default:throw new Error('Relationship status doesn\'t support anniversaries');}},willCreateLifeEvent:function(i,j,k,l){if(this.isUnilateralStatus(j))return false;if(this.isSuppressedStatus(j))return false;if(j==this.COMPLICATED&&!this.isUnilateralStatus(i))return false;if(j!=i)return true;if(k>0&&l>0&&k!=l)return true;return false;}};},null);
__d('TimelineMLEPhotoPreview',['Event','CSS','Dialog','DOM','Layer','Parent','TimelineLifeEventPhotoPreviewGrid','$'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=[],q={initPreviewGrid:function(r,s,t){var u=m.byClass(r,'mleContainer');q.destroyPreviewGrid(u);p[u.id]=new n(u,r,s,t);h.listen(k.find(u,'.mleAddMorePhotoButtons'),'click',function(event){p[u.id].filterPhotoClick(event);});},destroyPreviewGrid:function(r){if(p[r.id]){p[r.id].destroy();delete p[r.id];}},initUploader:function(r,s,t){if(p[s])p[s].initUploader(r,t);},attachPhoto:function(r,s,t){if(p[r])p[r].attachPhoto(s,t);},listenForDetach:function(r,s){var t=p[s];h.listen(k.find(r,'.detachPhotoIcon'),'click',t.detachPhoto.bind(t,r));},listenForPhotoSelect:function(r,s){var t=o(s.display_elem),u=false;h.listen(r,'click',function(){if(u)return;u=true;i.hide(k.find(t,'.mlePhotoButtons'));i.show(k.find(t,'.mleAddMorePhotoButtons'));var v=j.getCurrent();if(v)v.hide();var w=p[t.id];if(w)w.addPhotos([s.photo_fbid]);});},listenForSubmit:function(r,s,t){var u=o(t);r.subscribe('confirm',function(){var v=k.scry(r.getContentRoot(),'input[name="'+s+'"]'),w=[];for(var x=0;x<v.length;x++){var y=v[x];if(y.checked===true)w.push(y.value);}i.hide(k.find(u,'.mlePhotoButtons'));i.show(k.find(u,'.mleAddMorePhotoButtons'));var z;if(z=j.getCurrent())z.hide();if(z=l.getTopmostLayer())z.hide();if(p[u.id])p[u.id].addPhotos(w);});}};f.exports=q;},null);
__d("XFamilyNonUserCreationFormController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/family\/create\/form\/",{show_intro:{type:"Bool",defaultValue:false},name:{type:"String"},relation:{type:"Int"},existing_relationship_id:{type:"Int"},prefilled_data:{type:"StringToStringMap"},source:{type:"String",defaultValue:"unknown"},waterfall_id:{type:"String"},birth_month:{type:"Int"},birth_day:{type:"Int"},birth_year:{type:"Int"},privacy_row:{type:"StringToIntMap"},__asyncDialog:{type:"Int"}});},null,{});
__d('TimelineMLE',['Animation','Arbiter','AsyncRequest','Bootloader','ComposerXController','CSS','DOM','DOMScroll','Event','Form','Parent','ProgressiveDatepicker','ReactComposerActions','ReactComposerIDGenerator','RelationshipStatusConst','TimelineComposerUtilities','TimelineContentLoader','TimelineMLEPhotoPreview','XFamilyNonUserCreationFormController','$','areJSONRepresentationsEqual','cssVar','csx','cx','fbt','ge','tidyEvent'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha){if(c.__markCompiled)c.__markCompiled();var ia=0,ja={},ka=null,la=null,ma=50;function na(za){return r.byClass(za,'mleFlyoutForm');}function oa(za){var ab=r.byClass(za.getContext(),'fbTimelineCapsule');if(ab)return ab;return x.capsuleForCurrentSection();}function pa(za){var ab=q.serialize(za);ra(za,ab);qa(za,ab);if(!ba(ab,ja.state)){sa(za);new j().setData(ab).setURI('/ajax/timeline/mle_header.php').setRelativeTo(za).setFinallyHandler(i.inform.bind(i,'TimelineMLE/mleHeaderUpdated')).send();}}function qa(za,ab){var bb=n.scry(za,"._594n")[0];if(!bb)return;var cb=ab.hasOwnProperty('name')?ab.name:ab.text_with&&ab.text_with[0];if(cb)n.setContent(bb,fa._("{name} will be added to the Family section on your profile.",[fa.param('name',cb)]));m.conditionClass(bb,'hidden_elem',!cb);}function ra(za,ab){var bb=parseInt(ab.type,10),cb=ab['with'],db=n.scry(za,'input.updateRelationshipStatus')[0];if(!db)return;var eb=n.scry(za,'li.relationshipConfirmation')[0];if(!eb)return;var fb=n.find(za,'li.relationshipTooManyPartners');if(cb&&cb.length>1){m.hide(eb);m.show(fb);db.checked=false;db.disabled=true;return;}m.hide(fb);db.disabled=false;var gb=cb&&cb[0],hb=n.find(za,'input.relationshipCurrentPartnerID').value,ib=n.find(za,'input.relationshipCurrentStatus').value,jb=v.isUnilateralStatus(bb),kb=db.checked&&!jb&&gb&&(hb!=gb||ib!=bb);if(gb){var lb=ab.text_with[0],mb=n.find(za,'span.relationshipPartnerName');n.setContent(mb,lb);}m.conditionClass(eb,'hidden_elem',!kb);}function sa(za){za=za||ja.element;if(!za)return;ja={element:za,state:q.serialize(za)};}function ta(event){var za=event.getTarget(),ab=za.options[za.selectedIndex];i.inform('TimelineMLE/mleSelectUpdated',za);var bb=r.byClass(ab,'mleFormContainer');pa(bb);var cb=n.scry(bb,'.mleOtherLabel'),db=n.scry(bb,'.mleOtherField');if(cb.length)cb=cb[0];if(db.length)db=db[0];if(m.hasClass(ab,'mleOther')){m.show(cb);m.show(db);var eb=n.find(db,'.inputOuter').firstChild;eb.focus();}else{m.hide(cb);m.hide(db);}}function ua(){if(!ka)return;var za=ka,ab=n.scry(za.getInnerContent(),'.mleContainer')[0];ab&&y.destroyPreviewGrid(ab);za.hide();ja={};ka=null;i.inform('TimelineMLE/mleFlyoutHidden');}function va(za,ab){n.replace(aa(za),ab);}function wa(za){if(za)p.listen(za,'change',ta);}function xa(za,ab){new h(za).to('background',ab).duration(ma).go();}var ya={addRequiredValidationToField:function(za){var ab=fa._("This field is required."),bb=za.placeholder;p.listen(za,'blur',function(cb){if(za.value===null||za.value.length===0){za.placeholder=ab;var db="#ffbaba";xa(za,db);}});p.listen(za,'focus',function(cb){if(za.placeholder===ab){za.placeholder=bb;xa(za,"#ffffff");}});},cancel:function(za){if(na(za)){ya.hideFlyout();}else{var ab=r.byClass(za,'mleContainer');ab&&y.destroyPreviewGrid(ab);var bb=r.byClass(za,'fbTimelineNewMLE');if(bb){n.remove(bb);}else{bb=r.byClass(za,'fbTimelineEditMLE');m.removeClass(bb,'fbTimelineEditMLE');n.remove(n.scry(bb,'.timelineUnitContainer')[0]);m.show(n.scry(bb,'.timelineUnitContainer')[0]);}if(m.hasClass(bb,'fbTimelineNotStarred')){m.removeClass(bb,'fbTimelineNotStarred');k.loadModules(["TimelineStar"],function(cb){cb.unstarUnit(bb.childNodes[0],null,true);});}i.inform('TimelineMap/resizeCallout');}ja={};return false;},registerButtons:function(za,ab,bb,cb){ha(p.listen(ab,'mousedown',function(){za.standalone?ka.setStackable(false):n.setContent(n.find(cb,'.mleInlineErrorMsg'),'');}));if(bb)ha(p.listen(bb,'click',function(db){db.prevent();if(za.location==='map')i.inform('TimelineMap/cancelCreation');za.standalone?ya.hideFlyout():ya.cancel(bb);}));},registerStickyPrivacyFlyout:function(za){i.subscribe('TimelineMLE/mleFlyoutHidden',za.hide.bind(za));i.subscribe('TimelineMLE/mleHeaderUpdated',za.updatePosition.bind(za));},replace:function(za,ab){var bb=r.byClass(za,'mleContainer');bb&&y.destroyPreviewGrid(bb);if(na(za)){var cb=r.byClass(za,'fbTimelineEditMLEFlyout');if(cb){za=r.byClass(aa(ab.relativeElementID),'fbTimelineEditMLE');ya.hideFlyout();n.replace(za,ab.streamStory);za=aa(ab.streamStory);}else{var db=function(fb){var gb=ga(ab.relativeElementID);if(u.isComposerID(gb.id)){t.reset(gb.id);}else gb&&l.reset(gb);fb.publish(ab,ab.streamStory);ya.hideFlyout();};if(ab.isFinch){k.loadModules(["PagesStoryPublisher"],db);}else k.loadModules(["TimelineStoryPublisher"],db);za=aa(ab.streamStory);}}var eb=n.scry(za,'div.keepStarred')[0];if(eb)k.loadModules(["TimelineStar"],function(fb){fb.starUnit(eb,null,true);});return false;},startEdit:function(za,ab){ya.hideFlyout();var bb=n.scry(za,'div.timelineUnitContainer')[0];m.hide(bb);m.addClass(za,'fbTimelineEditMLE');if(!ab)m.addClass(za,'fbTimelineNotStarred');},showFlyout:function(za,ab,bb){ya.hideFlyout();ka=za;ia=0;i.subscribe('TimelineMLE/mleSelectUpdated',function(gb,hb){var ib=r.byClass(hb,'mleFormOuterContainer'),jb=n.scry(ib,'.registrationLink');if(!jb.length)return;var kb=hb.selectedIndex;m.hide(jb[ia]);m.show(jb[kb]);ia=kb;});za.show();if(ab==='edit'){var cb=aa(bb),db=r.byClass(cb,"_5jmm")||r.byClass(cb,'lifeEventContainer');m.addClass(db,'fbTimelineEditMLE');var eb=n.find(za.getInnerContent(),'.timelineUnitContainer');m.addClass(eb,'fbTimelineEditMLEFlyout');o.ensureVisible(eb,null,100);}if(ab!='map'){var fb=n.scry(za.getInnerContent(),'.mleSelect');if(fb.length)wa(fb[0]);}if(ab!=='edit')ya.setEstimatedDate(za);i.inform('TimelineMLE/mleFlyoutShown',za);},showPrivacyNotice:function(za,ab){if(!ab||!za)return;var bb=n.find(za.getInnerContent(),'.audienceSelector');ab.setContext(bb).show();la=ab;p.listen(bb,'click',ab.hide.bind(ab));p.listen(n.find(ab.getContent(),'input'),'click',ab.hide.bind(ab));i.subscribe('TimelineMLE/mleFlyoutHidden',ab.hide.bind(ab));},hideFlyout:ua,getFlyout:function(){return ka;},listenForEditChanges:function(za){var ab=n.find(za,'form.mleFormContainer'),bb=ab.elements;for(var cb=0;cb<bb.length;++cb){if(r.byClass(bb[cb],'uiTypeahead')||r.byClass(bb[cb],'uiTokenizer')||m.hasClass(bb[cb],'mleSelect'))continue;if(m.hasClass(bb[cb],'inputradio')){p.listen(bb[cb],'click',pa.bind(null,ab));}else if(r.byClass(bb[cb],'mleDatepicker')){p.listen(bb[cb],'change',pa.bind(null,ab));}else p.listen(bb[cb],'blur',pa.bind(null,ab));}ja={element:ab,state:q.serialize(ab)};var db=n.scry(za,'input.updateRelationshipStatus')[0];if(db)ha(p.listen(db,'change',function(){var eb=q.serialize(ab);ra(ab,eb);}));},updateHeader:function(za){pa(r.byClass(za,'mleFormContainer'));},setEstimatedDate:function(za){var ab=n.scry(za.getContentRoot(),'.fbTimelineComposerUnit')[0];if(!ab){var bb=s.getInstance(n.scry(za.getInnerContent(),'.uiProgressiveDatepicker')[0]);if(bb)w.setEstimatedDate(bb,oa(za));}},updatePrivacyNoticePosition:function(){la&&la.updatePosition();},registerOptionHandler:function(za){var ab=n.scry(za,'.lifeEventContainer')[0],bb=n.scry(ab,'.mleSelect');if(bb.length)wa(bb[0]);},subscribeToTypeahead:function(za,ab){za.subscribe(['select','reset','blur'],ya.updateHeader.bind(null,ab));},subscribeToTokenizer:function(za,ab){za.subscribe(['addToken','removeToken'],ya.updateHeader.bind(null,ab));},replaceYearlySummary:function(za){va('pagelet_yearly',za);ua();},replaceHometown:function(za){va('pagelet_hometown',za);ua();},showScrapbookPopover:function(za){var ab=z.getURIBuilder().getURI();new j().setURI(ab).setData({experience_id:za.experience_id,existing_relationship_id:za.existing_relationship_id,name:za.name,relation:za.relation,source:za.source,birth_month:za.birth_month,birth_day:za.birth_day,birth_year:za.birth_year,privacy_row:za.privacy_row}).send();}};f.exports=b.TimelineMLE||ya;},null);