/*!CK:3713368275!*//*1444253682,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oGZW7"]); }

__d('AdwareScaner',['AsyncSignal','URI','createArrayFromMixed','ge','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={max_scan_count:2,scan_count:0,scan_timeout:10000,scan_depth:2,fb_domains:null,extern_src_res:[],adware_elements:[],malware_functions:[],selective_scan_elements:[],adwares_found:[],malwares_found:[],selective_scan_results:[],browser_extensions:[],extensions_found:{},init:function(n,o,p,q,r,s){setTimeout(m.runScan.bind(m),1000);this.fb_domains=j(n);this.adware_elements=o;this.malware_functions=p;this.selective_scan_elements=q;this.max_scan_count=r.max_scan_count||this.max_scan_count;this.scan_timeout=r.scan_timeout||this.scan_timeout;this.scan_depth=r.scan_depth||this.scan_depth;this.browser_extensions=s;},runScan:function(){this.scan_count++;this.checkAdwareElements(this.adware_elements);this.checkMalwareFunctions(this.malware_functions);if(this.fb_domains.length>0)if(!l(this.selective_scan_elements)){this.selectiveDOMScan(this.selective_scan_elements,this.scan_depth);}else this.scanDOM();if(!l(this.browser_extensions))this.lookup_extensions(this.browser_extensions);this.pingBack(this.extern_src_res,this.adwares_found,this.malwares_found,this.selective_scan_results,this.extensions_found);if(this.scan_count<this.max_scan_count)setTimeout(m.runScan.bind(m),this.scan_timeout*this.scan_count);this.extern_src_res=[];this.adwares_found=[];this.malwares_found=[];},lookup_extensions:function(n){for(var o in n){var p=n[o];for(var q=0;q<p.length;q++)this.check_resource(o,p[q],function(r){m.extensions_found[r]=1;},function(r){});}},check_resource:function(n,o,p,q){var r=document.createElement('script');r.onload=function(){p(n);};r.onerror=function(){q(n);};document.body.appendChild(r);r.src=o;},selectiveDOMScan:function(n,o){for(var p in n){var q=n[p];for(var r=0;r<q.length;r++){var s={},t=k(q[r]),u=this.recursiveSelectiveDOMScan(t,0);if(u){s.adware_id=p;s.node_id=q[r];s.extern_src=u.src;s.tag_name=u.tag_name;m.selective_scan_results.push(s);break;}}}},recursiveSelectiveDOMScan:function(n,o){if(o==this.scan_depth||n==null)return null;if(n.src&&this.checkSource(n.src)){return {tag_name:n.tagName,src:n.src};}else for(var p=0;p<n.childNodes.length;p++){var q=n.childNodes[p],r=this.recursiveSelectiveDOMScan(q,o+1);if(r)return r;}return null;},scanDOM:function(){var n=document.documentElement.getElementsByTagName('*');for(var o=0;o<n.length;o++){var p=n[o];if(p.src&&this.checkSource(p.src))this.extern_src_res.push(p.src);}},checkSource:function(n){var o=new i(n);for(var p=0;p<this.fb_domains.length;p++){var q=new RegExp(this.fb_domains[p],'i');if(q.test(o.getDomain()))return false;}return true;},checkAdwareElements:function(n){for(var o in n){var p=n[o];for(var q=0;q<p.length;q++)if(k(p[q])){m.adwares_found.push(o);break;}}},checkMalwareFunctions:function(n){for(var o in n){var p=n[o];for(var q=0;q<p.length;q++)if(p[q] in window){m.malwares_found.push(o);break;}}},pingBack:function(n,o,p,q,r){var s={};if(n.length)s.external_src=n;if(o.length)s.adwares_found=o;if(p.length)s.malwares_found=p;if(q.length)s.selective_scan_results=q;if(!l(r)){var t=[];for(var u in r)t.push(u);s.browser_extensions=t;}if(!l(s)){var v=JSON.stringify(s),w=new i('/si/ajax/a_crane_wanders').getQualifiedURI().toString();new h(w,{p:v}).send();}}};f.exports=m;},null);