/*!CK:826226061!*//*1444325900,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["rBihR"]); }

__d('legacy:AggregatedMap',['AggregatedMap','AggregatedMapCalloutOrientation'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.AggregatedMap=c('AggregatedMap');b.AggregatedMapCalloutOrientation=c('AggregatedMapCalloutOrientation');},3);
__d('TilesDynamicMap',['Arbiter','ArbiterMixin','DataStore','DOM','Event','GeoCoordinates','leaflet','LeafletUtils','LeafletView','MapsReporterLogger','Parent','TilesMapConfig','TilesMapUtils','csx','cx','mod','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y,z;y=babelHelpers.inherits(aa,x(i));z=y&&y.prototype;function aa(ca,da,ea,fa,ga,ha,ia){'use strict';z.constructor.call(this);this.map=n.map(ca,{center:[fa.latitude,fa.longitude],zoom:fa.zoom||1,layers:[n.tileLayer(fa.urlTemplate||t.getTileURLTemplate(fa.language),{minZoom:1,maxZoom:18})],zoomControl:fa.zoomControl,scrollWheelZoom:fa.enableZoom,touchZoom:fa.enableZoom,doubleClickZoom:fa.enableZoom,boxZoom:fa.enableZoom,keyboardZoomOffset:fa.enableZoom?1:0,attributionControl:false,dragging:fa.dragging,fadeAnimation:fa.enableFadeAnimation}).on({click:(function(eb){this.inform('DynamicMap/mapClick',{lat:eb.latlng.lat,lng:eb.latlng.lng},h.BEHAVIOR_PERSISTENT);}).bind(this)});var ja=s.OSM_RECTS_RAW;this.osmBounds=ja.map(function(eb){return (n.latLngBounds([eb[2],eb[1]],[eb[0],eb[3]]));});this.osmZoomThreshold=s.OSM_ZOOM_THRESHOLD;var ka=[];for(var la=0;la<ga.length;la++){var ma=ga[la],na=n.icon({iconUrl:ma.iconUrl,iconRetinaUrl:ma.iconRetinaUrl,iconSize:ma.iconSize,iconAnchor:ma.iconAnchor,popupAnchor:ma.popupAnchor}),oa=n.marker([ma.latitude,ma.longitude],{draggable:ma.draggable,icon:na}).on('drag',function(eb){var fb=eb.target.getLatLng();h.inform('DynamicMap/pinDrag',{pin_id:la,latitude:fb.lat,longitude:fb.lng},h.BEHAVIOR_PERSISTENT);});ka.push(oa);if(ma.popupContent!=null){var pa={};if(ma.popupMaxWidth!=null)pa.maxWidth=ma.popupMaxWidth;if(ma.popupMaxHeight!=null)pa.maxHeight=ma.popupMaxHeight;oa.bindPopup(n.popup(pa).setContent(ma.popupContent));}oa.addTo(this.map);}this.markers=ka;this.polys={};for(la=0;la<ha.length;la++){var qa=ha[la].points.map(function(eb){return [parseFloat(eb.latitude),parseFloat(eb.longitude)];}),ra={stroke:ha[la].weight>0?true:false,weight:ha[la].weight,color:ha[la].color,opacity:ha[la].opacity,fillColor:ha[la].fillColor,fillOpacity:ha[la].fillOpacity},sa=null;if(ha[la].type=='polyline'){sa=n.polyline(qa,ra);}else if(ha[la].type=='polygon'){var ta=[qa];for(var ua=0;ua<ha[la].innerRings.length;ua++)ta.push(ha[la].innerRings[ua].map(function(eb){return [parseFloat(eb.latitude),parseFloat(eb.longitude)];}));sa=n.polygon(ta,ra);}if(ha[la].activeFillColor){var va=ha[la].fillColor,wa=ha[la].fillOpacity,xa=ha[la].activeFillColor,ya=ha[la].activeFillOpacity;sa.on({mouseover:(function(eb){eb.target.setStyle({fillColor:xa,fillOpacity:ya});}).bind(this),mouseout:(function(eb){eb.target.setStyle({fillColor:va,fillOpacity:wa});}).bind(this)});}if('id' in ha[la]){sa.id=ha[la].id;this.polys[sa.id]=sa;}sa.on({mouseover:(function(eb){this.inform('DynamicMap/polyMouseOver',{target:eb.target},h.BEHAVIOR_PERSISTENT);}).bind(this),mouseout:(function(eb){this.inform('DynamicMap/polyMouseOut',{target:eb.target},h.BEHAVIOR_PERSISTENT);}).bind(this),click:(function(eb){this.inform('DynamicMap/polyClick',{target:eb.target},h.BEHAVIOR_PERSISTENT);}).bind(this)});sa.addTo(this.map);}this.circles={};for(la=0;la<ia.length;la++){var za=n.circle([ia[la].latitude,ia[la].longitude],ia[la].radius,{color:ia[la].color,weight:ia[la].weight,opacity:ia[la].opacity,fillColor:ia[la].fillColor,fillOpacity:ia[la].fillOpacity}).addTo(this.map),ab='id' in ia[la]?'id:'+ia[la].id:la;this.circles[ab]=za;}this.subscribe('DynamicMap/setRadius',(function(eb,fb){var gb=null;if('id' in fb){gb=this.circles['id:'+fb.id];}else{var hb=Object.keys(this.circles);if(hb.length==1)gb=this.circles[hb[0]];}if(gb){gb.setRadius(fb.radius);if(fb.center)this.map.fitBounds(gb.getBounds());}}).bind(this));var bb=this,cb=n.Control.extend({options:{position:'bottomleft'},initialize:function(eb){n.Util.setOptions(this,eb);},onAdd:function(eb){var fb=n.DomUtil.create('div',null,this.$TilesDynamicMap1);this.hereLogo=n.DomUtil.create('img',null,fb);this.osmCopyright=n.DomUtil.create('span',"_3q1-",fb);k.setContent(this.osmCopyright,'\u00A9 OpenStreetMap');var gb=s.LOGO;this.hereLogo.src=gb.url;this.hereLogo.width=gb.width;this.hereLogo.height=gb.height;eb.on('resize',function(hb){bb.$TilesDynamicMap2(hb.newSize,this);},this);bb.$TilesDynamicMap2({newSize:eb.getSize()},this);return fb;}}),db=new cb();this.map.on('moveend',function(){this.$TilesDynamicMap2(this.map.getSize(),db);},this);this.map.addControl(db);if(s.IS_REPORT_BUTTON_ENABLED&&fa.showReportButton)this.$TilesDynamicMap3(da,ea);j.set(ca,'TilesDynamicMap',this);this.inform('DynamicMap/onInit',{},h.BEHAVIOR_PERSISTENT);}aa.prototype.on=function(ca,da){'use strict';this.map.on(ca,da);};aa.prototype.off=function(ca,da){'use strict';this.map.off(ca,da);};aa.prototype.fitBounds=function(ca){'use strict';this.map.fitBounds(ca);};aa.prototype.getCenter=function(){'use strict';var ca=this.map.getCenter();return {latitude:ca.lat,longitude:ca.lng};};aa.prototype.getZoom=function(){'use strict';return this.map.getZoom();};aa.prototype.setZoom=function(ca){'use strict';this.setView({center:this.map.getCenter(),zoom:ca,animate:false});};aa.prototype.getWidth=function(){'use strict';return this.map.getSize().x;};aa.prototype.getHeight=function(){'use strict';return this.map.getSize().y;};aa.prototype.invalidateSize=function(){'use strict';this.map.invalidateSize(false);};aa.prototype.setView=function(ca){'use strict';if(ca.centerOffset){var da=this.map.project(ca.center,ca.zoom);da=da.subtract(ca.centerOffset);ca.center=this.map.unproject(da,ca.zoom);}this.map.setView(ca.center,ca.zoom,{animate:ca.animate});this.map.fireEvent('movestart');this.map.fireEvent('moveend');};aa.prototype.poly=function(ca){'use strict';return this.polys[ca];};aa.prototype.onInit=function(ca){'use strict';ca();};aa.prototype.getMicrosoftMaps=function(){'use strict';return new ba(this);};aa.prototype.getMap=function(){'use strict';return this;};aa.prototype.mapToPixel=function(ca){'use strict';var da=this.map.getPixelBounds().min;return ca.sub(da.x,da.y);};aa.prototype.pixelToMap=function(ca){'use strict';var da=this.map.getPixelBounds().min,ea=ca.add(da.x,da.y);ea.x=w(ea.x,this.$TilesDynamicMap4());return ea;};aa.prototype.tryPixelToLocation=function(ca){'use strict';return this.map.containerPointToLatLng(ca);};aa.prototype.$TilesDynamicMap4=function(){'use strict';return 512*Math.pow(2,this.map.getZoom()-1);};aa.prototype.$TilesDynamicMap2=function(ca,da){'use strict';if(ca.x<s.MIN_SIZE_FOR_ATTRIBUTION||ca.y<s.MIN_SIZE_FOR_ATTRIBUTION){da.hereLogo.hidden=true;da.osmCopyright.hidden=true;}else{da.hereLogo.hidden=this.$TilesDynamicMap5();da.osmCopyright.hidden=!da.hereLogo.hidden;}};aa.prototype.$TilesDynamicMap5=function(){'use strict';if(this.map.getZoom()<this.osmZoomThreshold)return false;var ca=this.map.getSize();return o.isViewInBounds(new p({center:o.fromLatLng(this.map.getCenter()),zoom:this.map.getZoom()}),{width:ca.x,height:ca.y},this.osmBounds);};aa.prototype.$TilesDynamicMap3=function(ca,da){'use strict';var ea=n.Control.extend({options:{position:'bottomright'},reportButton:ca,initialize:function(ga){n.Util.setOptions(this,ga);},onAdd:function(ga){da.subscribe('cancel',function(){q.logConfirmDialogClick(q.ACTION_DIALOG_CANCEL,q.MAP_RENDERER_TYPE_DYNAMIC_MAP);});da.subscribe('button',function(){var ha=ga.getCenter(),ia=new p({center:new m(ha.lat,ha.lng),zoom:ga.getZoom()}),ja=t.getMapProviderForReportButton(ia);q.logConfirmDialogClick(q.ACTION_DIALOG_OPEN_MAPS_REPORTER,q.MAP_RENDERER_TYPE_DYNAMIC_MAP);window.open(t.getReporterToolUrl(ja,ia),'_blank');da.hide();});l.listen(this.reportButton,'click',function(){q.logReportButtonClick(q.ACTION_OPEN_CONFIRM_DIALOG,q.MAP_RENDERER_TYPE_DYNAMIC_MAP);da.show();});return this.reportButton;}}),fa=new ea();this.map.addControl(fa);};aa.getInstance=function(ca){'use strict';var da=r.byClass(ca,"_49nx");if(!da){var ea=k.scry(ca,"._49nx");da=ea.length>0?ea[0]:null;}return da?j.get(da,'TilesDynamicMap'):null;};aa.poke=function(ca){'use strict';var da=aa.getInstance(ca);da&&da.invalidateSize();};function ba(ca){'use strict';this.map=ca;this.Events={addHandler:function(da,ea,fa){if(ea==='viewchange'){ea='movestart move';}else if(ea==='viewchangeend')ea='moveend';var ga=function(ha){fa({getX:function(){return ha.containerPoint.x;},getY:function(){return ha.containerPoint.y;}});};da.on(ea,ga);return {map:da,evt:ea,fn:ga};},removeHandler:function(da){da.map.off(da.evt,da.fn);}};this.Point=n.point;this.Location=n.LatLng;this.PixelReference={control:null};}f.exports=aa;},null);